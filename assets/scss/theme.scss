/*! Theme: Exhibit v1.12.3 */
// ================================================================ */
// Libraries / External Imports

/* scss-combine:../../node_modules/normalize.scss/normalize */
/*! normalize.scss v0.1.0 | MIT License | based on git.io/normalize */

/**
 * 1. Set default font family to sans-serif.
 * 2. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
  font-family: sans-serif; /* 1 */
  -ms-text-size-adjust: 100%; /* 2 */
  -webkit-text-size-adjust: 100%; /* 2 */
}

/**
 * Remove default margin.
 */

body {
  margin: 0;
}

/* HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined for any HTML5 element in IE 8/9.
 * Correct `block` display not defined for `details` or `summary` in IE 10/11
 * and Firefox.
 * Correct `block` display not defined for `main` in IE 11.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
  display: block;
}

/**
 * 1. Correct `inline-block` display not defined in IE 8/9.
 * 2. Normalize vertical alignment of `progress` in Chrome, Firefox, and Opera.
 */

audio,
canvas,
progress,
video {
  display: inline-block; /* 1 */
  vertical-align: baseline; /* 2 */
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
  display: none;
  height: 0;
}

/**
 * Address `[hidden]` styling not present in IE 8/9/10.
 * Hide the `template` element in IE 8/9/11, Safari, and Firefox < 22.
 */

[hidden],
template {
  display: none;
}

/* Links
   ========================================================================== */

/**
 * Remove the gray background color from active links in IE 10.
 */

a {
  background-color: transparent;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
  outline: 0;
}

/* Text-level semantics
   ========================================================================== */

/**
 * Address styling not present in IE 8/9/10/11, Safari, and Chrome.
 */

abbr[title] {
  border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 4+, Safari, and Chrome.
 */

b,
strong {
  font-weight: bold;
}

/**
 * Address styling not present in Safari and Chrome.
 */

dfn {
  font-style: italic;
}

/**
 * Address variable `h1` font-size and margin within `section` and `article`
 * contexts in Firefox 4+, Safari, and Chrome.
 */

h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

/**
 * Address styling not present in IE 8/9.
 */

mark {
  background: #ff0;
  color: #000;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
  font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sup {
  top: -0.5em;
}

sub {
  bottom: -0.25em;
}

/* Embedded content
   ========================================================================== */

/**
 * Remove border when inside `a` element in IE 8/9/10.
 */

img {
  border: 0;
}

/**
 * Correct overflow not hidden in IE 9/10/11.
 */

svg:not(:root) {
  overflow: hidden;
}

/* Grouping content
   ========================================================================== */

/**
 * Address margin not present in IE 8/9 and Safari.
 */

figure {
  margin: 1em 40px;
}

/**
 * Address differences between Firefox and other browsers.
 */

hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

/**
 * Contain overflow in all browsers.
 */

pre {
  overflow: auto;
}

/**
 * Address odd `em`-unit font size rendering in all browsers.
 */

code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

/* Forms
   ========================================================================== */

/**
 * Known limitation: by default, Chrome and Safari on OS X allow very limited
 * styling of `select`, unless a `border` property is set.
 */

/**
 * 1. Correct color not being inherited.
 *    Known issue: affects color of disabled elements.
 * 2. Correct font properties not being inherited.
 * 3. Address margins set differently in Firefox 4+, Safari, and Chrome.
 */

button,
input,
optgroup,
select,
textarea {
  color: inherit; /* 1 */
  font: inherit; /* 2 */
  margin: 0; /* 3 */
}

/**
 * Address `overflow` set to `hidden` in IE 8/9/10/11.
 */

button {
  overflow: visible;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Firefox, IE 8/9/10/11, and Opera.
 * Correct `select` style inheritance in Firefox.
 */

button,
select {
  text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button; /* 2 */
  cursor: pointer; /* 3 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
  cursor: default;
}

/**
 * Remove inner padding and border in Firefox 4+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}

/**
 * Address Firefox 4+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

input {
  line-height: normal;
}

/**
 * It's recommended that you don't attempt to style these elements.
 * Firefox's implementation doesn't respect box-sizing, padding, or width.
 *
 * 1. Address box sizing set to `content-box` in IE 8/9/10.
 * 2. Remove excess padding in IE 8/9/10.
 */

input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}

/**
 * Fix the cursor style for Chrome's increment/decrement buttons. For certain
 * `font-size` values of the `input`, it causes the cursor style of the
 * decrement button to change from `default` to `text`.
 */

input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box; /* 2 */
  box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari and Chrome on OS X.
 * Safari (but not Chrome) clips the cancel button when the search input has
 * padding (and `textfield` appearance).
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct `color` not being inherited in IE 8/9/10/11.
 * 2. Remove padding so people aren't caught out if they zero out fieldsets.
 */

legend {
  border: 0; /* 1 */
  padding: 0; /* 2 */
}

/**
 * Remove default vertical scrollbar in IE 8/9/10/11.
 */

textarea {
  overflow: auto;
}

/**
 * Don't inherit the `font-weight` (applied by a rule above).
 * NOTE: the default cannot safely be changed in Chrome and Safari on OS X.
 */

optgroup {
  font-weight: bold;
}

/* Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
  border-collapse: collapse;
  border-spacing: 0;
}

td,
th {
  padding: 0;
}

/* scss-combine:../../node_modules/susy/sass/susy */
// Susy
// ====

/* scss-combine:susy/language/susy */
// Susy Next Syntax
// ================

$susy-version: 2.1;

/* scss-combine:../su */
// Su
// ==

/* scss-combine:su/utilities */
// Map Functions
// =============


// Truncate List
// -------------
// - Return a list, truncated to a given length
@function _susy-truncate-list(
  $list,
  $length
) {
  $_return: ();

  @for $i from 1 through length($list) {
    $_return: if($i <= $length, append($_return, nth($list, $i)), $_return);
  }

  @return $_return;
}


// Deep Get
// --------
// - Return a value deep in nested maps
@function _susy-deep-get(
  $map,
  $keys...
) {
  $_return: $map;

  @each $key in $keys {
    @if type-of($_return) == map {
      $_return: map-get($_return, $key);
    }
  }

  @return $_return;
}


// Deep Set
// --------
// - Set a value deep in nested maps
@function _susy-deep-set(
  $map,
  $keys-value...
) {
  $_value: nth($keys-value, -1);
  $_keys: _susy-truncate-list($keys-value, length($keys-value) - 1);
  $_length: length($_keys);
  $_return: ();

  @for $i from 1 through $_length {
    $_n: 0 - $i;
    $_level: _susy-truncate-list($_keys, $_length + $_n);
    $_level: _susy-deep-get($map, $_level...);
    $_merge: nth($_keys, $_n);
    $_merge: ($_merge: $_value);
    $_return: if($_level, map-merge($_level, $_merge), $_merge);
    $_value: $_return;
  }

  @return $_return;
}


// Deep Merge
// ----------
// Return 2 objects of any depth, merged
@function _susy-deep-merge(
  $map1,
  $map2
) {

  @if type-of($map1) != map or type-of($map2) != map {
    $map1: $map2;
  } @else {
    @each $key, $value in $map2 {
      $_new: ($key: _susy_deep-merge(map-get($map1, $key), $value));
      $map1: map-merge($map1, $_new);
    }
  }

  @return $map1;
}


// Deep Has-Key
// ------------
// - Return true if a deep key exists
@function _susy-deep-has-key(
  $map,
  $keys...
) {
  $_return: null;
  $_stop: false;

  @each $key in $keys {
    @if not($_stop) {
      $_return: map-has-key($map, $key);
    }

    @if $_return {
      $map: map-get($map, $key);
    } @else {
      $_stop: true;
    }
  }

  @return $_return;
}

/* scss-combine:su/settings */
// Settings
// ========

// Version
// -------
$su-version: 1.1;


// Default Settings
// ----------------
// PRIVATE: The basic settings
$susy-defaults: (
  columns: 4,
  gutters: .25,
);


// User Settings
// -------------
// - Define the $susy variable with a map of your own settings.
// - Set EITHER $column-width OR $container
// - Use $column-width for static layouts
$susy: () !default;


// Susy Defaults
// -------------
// PRIVATE: Add defaults to Susy
@mixin susy-defaults(
  $defaults
) {
  $susy-defaults: map-merge($susy-defaults, $defaults) !global;
}


// Susy Set
// --------
// Change one setting
// - $key   : setting name
// - $value : setting value
@mixin susy-set(
  $key-value...
) {
  $susy: _susy-deep-set($susy, $key-value...) !global;
}


// Susy Get
// --------
// Return one setting from a grid
// - $key     : <keyword>
// - $layout  : <settings>
@function susy-get(
  $key,
  $layout: map-merge($susy-defaults, $susy)
) {
  $layout: parse-grid($layout);
  $_options: $layout $susy $susy-defaults;
  $_break: false;
  $_return: null;

  @each $opt in $_options {
    @if type-of($opt) == map and not($_break) {
      $_keyset: _susy-deep-has-key($opt, $key...);
      @if $_keyset {
        $_return: _susy-deep-get($opt, $key...);
        $_break: true;
      }
    }
  }

  @return $_return;
}

/* scss-combine:su/validation */
// Math Validation
// ===============


// Valid Columns
// -------------
// Check that a column setting is valid.
@function valid-columns(
  $columns,
  $silent: false
) {
  $type: type-of($columns);
  $return: null;

  @if $type == number and unitless($columns) {
    $return: $columns;
  } @else if $type == list {
    $fail: null;
    @each $col in $columns {
      @if type-of($col) == number {
        $fail: $fail or if(unitless($col), null, true);
      } @else {
        $fail: true;
      }
    }
    $return: if($fail, $return, $columns);
  }

  @if $return != $columns and not($silent) {
    $return: null;
    $warn: '$columns must be a unitless number or list of unitless numbers.';
    @warn $warn + ' Current value [#{$type}]: #{$columns}';
  }

  @return $return;
}


// Valid Gutters
// -------------
// Check that a gutter setting is valid.
@function valid-gutters(
  $gutters,
  $silent: false
) {
  $type: type-of($gutters);
  $return: null;

  @if $type == number and unitless($gutters) {
    $return: $gutters;
  } @else if not($silent) {
    $warn: '$gutters must be a unitless number.';
    @warn $warn + ' Current value [#{$type}]: #{$gutters}';
  }

  @return $return;
}

/* scss-combine:su/grid */
// Column math
// ===========


// Is Symmetrical
// --------------
// Returns true if a grid is symmetrical.
// - [$columns]   : <number> | <list>
@function is-symmetrical(
  $columns: susy-get(columns)
) {
  $columns: valid-columns($columns);
  @return if(type-of($columns) == number, $columns, null);
}


// Susy Count
// ----------
// Find the number of columns in a given layout
// - [$columns]   : <number> | <list>
@function susy-count(
  $columns: susy-get(columns)
) {
  $columns: valid-columns($columns);
  @return is-symmetrical($columns) or length($columns);
}


// Susy Sum
// --------
// Find the total sum of column-units in a layout
// - [$columns]   : <number> | <list>
// - [$gutters]   : <ratio>
// - [$spread]    : false/narrow | wide | wider
@function susy-sum(
  $columns  : susy-get(columns),
  $gutters  : susy-get(gutters),
  $spread   : false
) {
  $columns: valid-columns($columns);
  $gutters: valid-gutters($gutters);

  $spread: if($spread == wide, 0, if($spread == wider, 1, -1));
  $gutter-sum: (susy-count($columns) + $spread) * $gutters;
  $column-sum: is-symmetrical($columns);

  @if not($column-sum) {
    @each $column in $columns {
      $column-sum: ($column-sum or 0) + $column;
    }
  }

  @return $column-sum + $gutter-sum;
}


// Susy Slice
// ----------
// Return a subset of columns at a given location.
// - $span        : <number>
// - $location    : <number>
// - [$columns]   : <number> | <list>
@function susy-slice(
  $span,
  $location,
  $columns: susy-get(columns)
) {
  $columns: valid-columns($columns);
  $sub-columns: $span;

  @if not(is-symmetrical($columns)) {
    $location: $location or 1;
    $sub-columns: ();
    @for $i from $location to ($location + $span) {
      $sub-columns: append($sub-columns, nth($columns, $i));
    }
  }

  @return $sub-columns;
}


// Susy
// ----
// Find the sum of a column-span.
// - $span        : <number>
// - $location    : <number>
// - [$columns]   : <number> | <list>
// - [$gutters]   : <ratio>
// - [$spread]    : false/narrow | wide | wider
@function susy(
  $span,
  $location     : false,
  $columns      : susy-get(columns),
  $gutters      : susy-get(gutters),
  $spread       : false
) {
  $columns: valid-columns($columns);
  $gutters: valid-gutters($gutters);
  $span: susy-slice($span, $location, $columns);

  @return susy-sum($span, $gutters, $spread);
}


/* scss-combine:../output/float */
// Float API
// =========

/* scss-combine:shared */
// Shared API
// ==========

/* scss-combine:support */
// Susy Browser Support
// ====================

/* scss-combine:support/support */
// Browser Support
// ===============

// Susy Support Defaults
// ---------------------
@include susy-defaults((
  use-custom: (
    clearfix: false,
    background-image: true,
    background-options: false,
    breakpoint: true,
    box-sizing: true,
    rem: true,
  ),
));


// Susy Support [mixin]
// --------------------
// Send property-value pairs to the proper support modules.
// - $prop  : <css property>
// - $val   : <css value>
@mixin susy-support(
  $prop,
  $val
) {
  // Background Support
  @if $prop == background-image {
    @include susy-background-image($val);
  } @else if $prop == background-size {
    @include susy-background-size($val);
  } @else if $prop == background-origin {
    @include susy-background-origin($val);
  } @else if $prop == background-clip {
    @include susy-background-clip($val);
  }

  // Box-Sizing Support
  @else if $prop == box-sizing {
    @include susy-box-sizing($val);
  }

  // Rem Support
  @else {
    @include susy-rem($prop, $val);
  }
}


// Susy Support [function]
// -----------------------
// Check for support of a feature.
// - $feature       : <string>
//                    - e.g "rem" or "box-sizing"
// - $requirements  : <map>
//                    - e.g (variable: rem-with-px-fallback, mixin: rem)
// - $warn          : <bool>
@function susy-support(
  $feature,
  $requirements: (),
  $warn: true
) {
  $_support: susy-get(use-custom $feature);

  @if $_support {
    $_fail: false;

    @each $_type, $_req in $requirements {
      @each $_i in $_req {
        $_pass: call(unquote("#{$_type}-exists"), $_i);

        @if not($_pass) {
          $_fail: true;
          @if $warn {
            @warn "You requested custom support of #{$feature}, but the #{$_i} #{$_type} is not available.";
          }
        }
      }
    }

    $_support: if($_fail, false, $_support);
  }

  @return $_support;
}

/* scss-combine:support/prefix */
// Susy Prefix
// ===========

// Prefix
// ------
// Output simple prefixed properties.
// - $prop      : <css property>
// - $val       : <css value>
// - [$prefix]  : <browser prefix list>
@mixin susy-prefix(
  $prop,
  $val,
  $prefix: official
) {
  @each $fix in $prefix {
    $fix: if($fix == official or not($fix), $prop, '-#{$fix}-#{$prop}');
    @include susy-rem($fix, $val);
  }
}

/* scss-combine:support/background */
// Background Properties
// =====================

// Susy Background Image
// ---------------------
// Check for an existing support mixin, or provide a simple fallback.
// - $image: <background-image>
@mixin susy-background-image(
  $image
) {
  @if susy-support(background-image, (mixin: background-image), $warn: false) {
    @include background-image($image...);
  } @else {
    background-image: $image;
  }
}

// Susy Background Size
// ---------------------
// Check for an existing support mixin, or provide a simple fallback.
// - $image: <background-size>
@mixin susy-background-size(
  $size
) {
  @if susy-support(background-options, (mixin: background-size)) {
    @include background-size($size);
  } @else {
    background-size: $size;
  }
}

// Susy Background Origin
// ----------------------
// Check for an existing support mixin, or provide a simple fallback.
// - $image: <background-origin>
@mixin susy-background-origin(
  $origin
) {
  @if susy-support(background-options, (mixin: background-origin)) {
    @include background-origin($origin);
  } @else {
    background-origin: $origin;
  }
}

// Susy Background Clip
// --------------------
// Check for an existing support mixin, or provide a simple fallback.
// - $image: <background-clip>
@mixin susy-background-clip(
  $clip
) {
  @if susy-support(background-options, (mixin: background-clip)) {
    @include background-clip($clip);
  } @else {
    background-clip: $clip;
  }
}

/* scss-combine:support/box-sizing */
// Box Sizing
// ==========

// Box Sizing
// ----------
// Check for an existing support mixin, or provide a simple fallback.
// - $model: <box-sizing>
@mixin susy-box-sizing(
  $model: content-box
) {
  @if $model {
    @if susy-support(box-sizing, (mixin: box-sizing), $warn: false) {
      @include box-sizing($model);
    } @else {
      $prefix: (moz, webkit, official);
      @include susy-prefix(box-sizing, $model, $prefix);
    }
  }
}

/* scss-combine:support/rem */
// rem Support
// ===========

// rem
// ---
// Check for an existing support mixin, or output directly.
// - $prop  : <css property>
// - $val   : <css value>
@mixin susy-rem(
  $prop,
  $val
) {
  $_reqs: (
    variable: rhythm-unit rem-with-px-fallback,
    mixin: rem,
  );
  @if susy-support(rem, $_reqs, $warn: false) and $rhythm-unit == rem {
    @include rem($prop, $val);
  } @else {
    #{$prop}: $val;
  }
}

/* scss-combine:support/clearfix */
// Susy Fallback Clearfix
// ======================


// Clearfix
// --------
// Check for an existing support mixin, or provide a simple fallback.
@mixin susy-clearfix {
  @if susy-support(clearfix, (mixin: clearfix)) {
    @include clearfix;
  } @else {
    &:after {
      content: " ";
      display: block;
      clear: both;
    }
  }
}



/* scss-combine:shared/inspect */
// Debugging
// =========

// Susy Inspect
// ------------
// Output arguments passed to a inspect.
// - $mixin  : <susy mixin>
// - $inspec   : <mixin arguments>

@mixin susy-inspect(
  $mixin,
  $inspect
) {
  $show: false;

  @each $item in $inspect {
    @if index($item, inspect) {
      $show: true;
    }
  }

  @if $show or susy-get(debug inspect) {
    -susy-#{$mixin}: inspect($inspect);
  }
}

/* scss-combine:shared/output */
// Output
// ======

// Output
// ------
// Output CSS with proper browser support.
// - $styles  : <map of css property-value pairs>
@mixin output(
  $styles
) {
  @each $prop, $val in $styles {
    @include susy-support($prop, $val);
  }
}

/* scss-combine:shared/direction */
// Direction Helpers
// =================

// Susy Flow Defaults
// ------------------
// - PRIVATE
@include susy-defaults((
  flow: ltr,
));

// Get Direction
// -------------
// Return the 'from' or 'to' direction of a ltr or rtl flow.
// - [$flow]  : ltr | rtl
// - [$key]   : from | to
@function get-direction(
  $flow: map-get($susy-defaults, flow),
  $key: from
) {
  $return: if($flow == rtl, (from: right, to: left), (from: left, to: right));
  @return map-get($return, $key);
}

// To
// --
// Return the 'to' direction of a flow
// - [$flow]  : ltr | rtl
@function to(
  $flow: map-get($susy-defaults, flow)
) {
  @return get-direction($flow, to);
}

// From
// ----
// Return the 'from' direction of a flow
// - [$flow]  : ltr | rtl
@function from(
  $flow: map-get($susy-defaults, flow)
) {
  @return get-direction($flow, from);
}

/* scss-combine:shared/background */
// Grid Background API
// ===================
// - Sub-pixel rounding can lead to several pixels variation between browsers.

// Grid Background Output
// ----------------------
// - $image: background-image
// - $size: background-size
// - $clip: background-clip
// - [$flow]: ltr | rtl
@mixin background-grid-output (
  $image,
  $size: null,
  $clip: null,
  $flow: map-get($susy-defaults, flow)
) {
  $output: (
    background-image: $image,
    background-size: $size,
    background-origin: $clip,
    background-clip: $clip,
    background-position: from($flow) top,
  );

  @include output($output);
}

/* scss-combine:shared/container */
// Shared Container API
// ====================

// Container Output
// ----------------
// - [$width]         : <length>
// - [$justify]       : left | center | right
// - [$math]          : fluid | static
@mixin container-output(
  $width,
  $justify: auto auto,
  $property: max-width
) {
  $output: (
    #{$property}: $width or 100%,
    margin-left: nth($justify, 1),
    margin-right: nth($justify, 2),
  );

  @include output($output);
}

/* scss-combine:shared/margins */
// Margins API
// ===========

// Margin Output
// -------------
// - $before  : <length>
// - $after   : <length>
// - [$flow]  : ltr | rtl
@mixin margin-output(
  $before,
  $after,
  $flow: map-get($susy-defaults, flow)
) {
  $to: to($flow);
  $from: from($flow);

  $output: (
    margin-#{$from}: $before,
    margin-#{$to}: $after,
  );

  @include output($output);
}

/* scss-combine:shared/padding */
// Padding API
// ===========

// Padding Output
// --------------
// - $before  : <length>
// - $after   : <length>
// - [$flow]  : ltr | rtl
@mixin padding-output(
  $before,
  $after,
  $flow: map-get($susy-defaults, flow)
) {
  $to: to($flow);
  $from: from($flow);

  $output: (
    padding-#{$from}: $before,
    padding-#{$to}: $after,
  );

  @include output($output);
}






/* scss-combine:float/container */
// Float Container API
// ===================

// Float Container
// ---------------
// - [$width]         : <length>
// - [$justify]       : left | center | right
// - [$math]   : fluid | static
@mixin float-container(
  $width,
  $justify: auto auto,
  $property: max-width
) {
  @include susy-clearfix;
  @include container-output($width, $justify, $property);
}

/* scss-combine:float/span */
// Float Span API
// ==============

// Float Span Output
// -----------------
// - $width             : <length>
// - [$float]           : from | to
// - [$margin-before]   : <length>
// - [$margin-after]    : <length>
// - [$padding-before]  : <length>
// - [$padding-after]   : <length>
// - [$flow]            : ltr | rtl
@mixin float-span-output(
  $width,
  $float            : from,
  $margin-before    : null,
  $margin-after     : null,
  $padding-before   : null,
  $padding-after    : null,
  $flow             : map-get($susy-defaults, flow)
) {
  $to     : to($flow);
  $from   : from($flow);

  $output: (
    width: $width,
    float: if($float == to, $to, null) or if($float == from, $from, null),
    margin-#{$from}: $margin-before,
    margin-#{$to}: $margin-after,
    padding-#{$from}: $padding-before,
    padding-#{$to}: $padding-after,
  );

  @include output($output);
}

/* scss-combine:float/end */
// Float Ends API
// ==============

// Susy End Defaults
// -----------------
// - PRIVATE
@include susy-defaults((
  last-flow: to,
));

// Float Last
// ----------
// - [$flow]  : ltr | rtl
@mixin float-last(
  $flow: map-get($susy-defaults, flow),
  $last-flow: map-get($susy-defaults, last-flow),
  $margin: 0
) {
  $to: to($flow);

  $output: (
    float: if($last-flow == to, $to, null),
    margin-#{$to}: $margin,
  );

  @include output($output);
}

// Float First
// -----------
// - [$flow]  : ltr | rtl
@mixin float-first(
  $flow: map-get($susy-defaults, flow)
) {
  $output: (
    margin-#{from($flow)}: 0,
  );

  @include output($output);
}

/* scss-combine:float/isolate */
// Float Isolation API
// ===================

// Isolate Output
// --------------
// - $push    : <length>
// - [$flow]  : ltr | rtl
@mixin isolate-output(
  $push,
  $flow: map-get($susy-defaults, flow)
) {
  $to: to($flow);
  $from: from($flow);

  $output: (
    float: $from,
    margin-#{$from}: $push,
    margin-#{$to}: -100%,
  );

  @include output($output);
}



/* scss-combine:susy/settings */
// Susy Settings
// =============

// Susy Language Defaults
// ----------------------
// - PRIVATE
@include susy-defaults((
  container: auto,
  math: fluid,
  output: float,
  container-position: center,
  gutter-position: after,
  global-box-sizing: content-box,
  debug: (
    image: hide,
    color: rgba(#66f, .25),
    output: background,
    toggle: top right,
  ),
));


// Valid Keyword Values
// --------------------
// - PRIVATE: DONT'T TOUCH
$susy-keywords: (
  container: auto,
  math: static fluid,
  output: isolate float,
  container-position: left center right,
  flow: ltr rtl,
  gutter-position: before after split inside inside-static,
  box-sizing: border-box content-box,
  span: full,
  edge: first alpha last omega full,
  spread: narrow wide wider,
  gutter-override: no-gutters no-gutter,
  role: nest,
  clear: break nobreak,
  debug image: show hide show-columns show-baseline,
  debug output: background overlay,
);


// Parse Susy Keywords and Maps
// ----------------------------
@function parse-settings(
  $short: $susy
) {
  $_return: ();

  @if type-of($short) == map {
    $_return: $short;
  } @else {
    @each $item in $short {
      // strings
      @if type-of($item) == string {
        @each $key, $value in $susy-keywords {
          @if index($value, $item) {
            $_key-value: append($key, $item);
            $_return: _susy-deep-set($_return, $_key-value...);
          }
        }
      // maps
      } @else if type-of($item) == map {
        $_return: map-merge($_return, $item);
      }
    }
  }

  @return $_return;
}


// Parse Columns & Gutters
// -----------------------
@function parse-layout(
  $short
) {
  $_return: ();
  $_columns: ();
  $_gutters: null;

  @if not(unitless(nth(nth($short, 1), 1))) {
    $_gutters: nth($short, 1);
  } @else {
    $_columns: (columns: nth($short, 1));
    $_gutters: if(length($short) > 1, nth($short, 2), $_gutters);
  }

  @if type-of($_gutters) == list and length($_gutters) > 0 {
    $_gutters: (
      gutters: nth($_gutters, 2) / nth($_gutters, 1),
      column-width: nth($_gutters, 1),
    );
  } @else {
    $_gutters: if($_gutters, (gutters: $_gutters), ());
  }

  $_return: map-merge($_return, $_columns);
  $_return: map-merge($_return, $_gutters);

  @return $_return;
}


// Parse Grid/Context
// ------------------
@function parse-grid(
  $short: $susy
) {
  $_return: parse-settings($short);
  $_layout: ();

  @if type-of($short) == map {
    $_return: $short;
  } @else {
    @each $item in $short {
      // number or list
      @if type-of($item) == number or type-of($item) == list {
        @if type-of($item) == list or unitless($item) {
          $_layout: append($_layout, $item);
        } @else {
          $_return: map-merge($_return, (container: $item));
        }
      }
    }

    $_layout: if(length($_layout) > 0, parse-layout($_layout), $_layout);
  }

  @return map-merge($_return, $_layout);
}


// Parse Span
// ----------
@function parse-span(
  $short,
  $key: span
) {
  $_return: ();

  @if type-of($short) == map {
    $_return: $short;
  } @else {
    $_at: index($short, at);

    @if $_at {
      $_loci: $_at + 1;
      $_location: nth($short, $_loci);
      $_return: map-merge($_return, (location: $_location));
      $short: set-nth($short, $_at, null);
      $short: set-nth($short, $_loci, null);
    }

    $_i: 1;
    $_span: ();

    @while $_i <= length($short) {
      $_this: nth($short, $_i);

      @if type-of($_this) == number {
        $_span: append($_span, $_this);
        $short: set-nth($short, $_i, null);
      } @else if $_this == of {
        $short: set-nth($short, $_i, null);
        $_i: length($short) + 1;
      }

      $_i: $_i + 1;
    }

    @if length($_span) > 0 {
      $_span: if(length($_span) == 1, nth($_span, 1), $_span);
      $_return: map-merge($_return, ($key: $_span));
    }

    $_return: map-merge($_return, parse-grid($short));
  }

  @return $_return;
}


// Parse Gutters
// -------------
@function parse-gutters(
  $short: $susy
) {
  $_gutters: parse-span($short, gutter-override);
  $_span: susy-get(gutter-override, $_gutters);

  @if $_span and not(map-get($_gutters, columns)) {
    $_context: ();
    $_new: ();

    @each $item in $_span {
      @if type-of($item) == number and unitless($item) {
        $_context: append($_context, $item);
      } @else {
        $_new: append($_new, $item);
      }
    }

    $_context: parse-grid($_context);
    $_new: if(length($_new) == 0, null, $_new);
    $_new: if(length($_new) == 1, nth($_new, 1), $_new);
    $_new: (gutter-override: if($_new != $_span, $_new, $_span));

    $_gutters: map-merge($_gutters, $_new);
    $_gutters: map-merge($_gutters, $_context);
  }

  @return $_gutters;
}

/* scss-combine:susy/validation */
// Validation
// ==========


// Validate Column Math
// --------------------
@function valid-column-math(
  $math,
  $column-width
) {
  @if $math == static and not($column-width) {
    @error 'Static math requires a valid column-width setting.';
  }

  @return $column-width;
}

/* scss-combine:susy/grids */
// Grid Syntax
// ===========


// Layout
// ------
// Set a new layout using a shorthand
// - $layout: <settings>
// - $clean: boolean
@mixin layout(
  $layout,
  $clean: false
) {
  $inspect  : $layout;
  $susy     : _get-layout($layout, $clean) !global;

  @include susy-inspect(layout, $inspect);
}


// Use Grid
// --------
// Use an arbitrary layout for a section of code
// - $layout: <settings>
// - $clean: boolean
@mixin with-layout(
  $layout,
  $clean: false
) {
  $inspect  : $layout;
  $old      : $susy;
  $susy     : _get-layout($layout, $clean) !global;

  @include susy-inspect(with-layout, $inspect);

  @content;

  $susy: $old !global;
}


// Layout
// ------
// Return a parsed layout map based on shorthand syntax
// - $layout: <settings>
@function layout(
  $layout: $susy
) {
  @return parse-grid($layout);
}


// Get Layout
// ----------
// Return a new layout based on current and given settings
// - $layout: <settings>
// - $clean: boolean
@function _get-layout(
  $layout,
  $clean: false
) {
  $layout: layout($layout);
  @return if($clean, $layout, _susy-deep-merge($susy, $layout));
}

/* scss-combine:susy/box-sizing */
// Susy Box Sizing
// =================

// Global Box Sizing
// -----------------
// Set a box model globally on all elements.
// - [$box]: border-box | content-box
// - [$inherit]: true | false
@mixin global-box-sizing(
  $box: susy-get(global-box-sizing),
  $inherit: false
) {
  $inspect: $box;

  @if $inherit {
    @at-root {
       html { @include output((box-sizing: $box)); }
       *, *:before, *:after { box-sizing: inherit; }
     }
  } @else {
    *, *:before, *:after { @include output((box-sizing: $box)); }
  }

  @include susy-inspect(global-box-sizing, $inspect);
  @include update-box-model($box);
}

// Border Box Sizing
// -----------------
// A legacy shortcut...
// - [$inherit]: true | false
@mixin border-box-sizing(
  $inherit: false
) {
  @include global-box-sizing(border-box, $inherit);
}

// Update Box Model
// ----------------
// PRIVATE: Updates global box model setting
@mixin update-box-model(
  $box
) {
  @if $box != susy-get(global-box-sizing) {
  @include susy-set(global-box-sizing, $box);
  }
}

/* scss-combine:susy/context */
// Context Syntax
// ==============

// Nested [function]
// -----------------
// Return a subset grid for nested context.
// - $context   : <span>
@function nested(
  $context
) {
  $context    : parse-span($context);
  $span       : susy-get(span, $context);
  $location   : get-location($context);
  $columns    : susy-get(columns, $context);

  @return susy-slice($span, $location, $columns);
}

// Nested [mixin]
// --------------
// Use a subset grid for a nested context
// - $context   : <span>
// - @content   : <content>
@mixin nested(
  $context
) {
  $inspect  : $context;
  $context  : parse-span($context);
  $old      : susy-get(columns);
  $susy     : map-merge($susy, (columns: nested($context))) !global;

  @include susy-inspect(nested, $inspect);
  @content;

  $susy     : map-merge($susy, (columns: $old)) !global;
}

/* scss-combine:susy/background */
// Background Grid Syntax
// ======================

$susy-overlay-grid-head-exists: false;


// Show Grid/s
// -----------
// Show grid on any element using either background or overlay.
// - [$grid]  : <settings>
@mixin show-grid(
  $grid: $susy
) {
  $inspect: $grid;
  $_output: debug-get(output, $grid);

  @include susy-inspect(show-grid, $inspect);
  @if $_output == overlay and susy-get(debug image, $grid) != hide {
    @include overlay-grid($grid);
  } @else {
    @include background-grid($grid);
  }
}

@mixin show-grids(
  $grid: $susy
) {
  @include show-grid($grid);
}

// Background Grid
// ---------------
// Show a grid background on any element.
// - [$grid]  : <settings>
@mixin background-grid(
  $grid: $susy
) {
  $inspect  : $grid;
  $_output  : get-background($grid);

  @if length($_output) > 0 {
    $_flow: susy-get(flow, $grid);

    $_image: ();
    @each $name, $layer in map-get($_output, image) {
      $_direction: if($name == baseline, to bottom, to to($_flow));
      $_image: append($_image, linear-gradient($_direction, $layer), comma);
    }
    $_output: map-merge($_output, (image: $_image));

    @include background-grid-output($_output...);
    @include susy-inspect(background-grid, $inspect);
  }
}


// Overlay Grid
// ------------
// Generate an icon to trigger grid-overlays on any given elements.
// $grids...  : <selector> [<settings>] [, <selector>]*
@mixin overlay-grid (
  $grid: $susy
) {
  @if not($susy-overlay-grid-head-exists) {
    @at-root head { @include overlay-head($grid); }
    @at-root head:before { @include overlay-trigger; }
    @at-root head:hover { @include overlay-trigger-hover; }
    $susy-overlay-grid-head-exists: true !global;
  }

  head:hover ~ &,
  head:hover ~ body & {
    position: relative;
    &:before {
      @include grid-overlay-base;
      @include background-grid($grid);
    }
  }
}


// [Private] Overlay Trigger
// -------------------------
@mixin overlay-trigger {
  content: "|||";
  display: block;
  padding: 5px 10px;
  font: {
    family: sans-serif;
    size: 16px;
    weight: bold;
  }
}


// [Private] Overlay Trigger Hover
// -------------------------------
@mixin overlay-trigger-hover {
  background: rgba(white, .5);
  color: red;
}


// [Private] Overlay Head
// ----------------------
// <head> styles to create grid overlay toggle
@mixin overlay-head (
  $grid: $susy
) {
  $_toggle: debug-get(toggle, $grid);
  $_horz: null;
  $_vert: null;

  @each $side in $_toggle {
    $_horz: if($side == left or $side == right, $side, $_horz);
    $_vert: if($side == top or $side == bottom, $side, $_vert);
  }

  display: block;
  position: fixed;
  #{$_horz}: 10px;
  #{$_vert}: 10px;
  z-index: 999;
  color: #333;
  background: rgba(white, .25);
}


// [Private] Grid Overlay Base
// ---------------------------
// Base styles for generating a grid overlay
@mixin grid-overlay-base() {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  content: " ";
  z-index: 998;
}


// Get Symmetrical Background
// --------------------------
// - $grid: <map>
@function get-background-sym(
  $grid
) {
  $grid           : parse-grid($grid);
  $_gutters       : susy-get(gutters, $grid);
  $_column-width  : susy-get(column-width, $grid);
  $_math          : susy-get(math, $grid);

  $_color         : debug-get(color);
  $_trans         : transparent;
  $_light         : lighten($_color, 15%);

  $_end           : 1 + $_gutters;
  $_after         : percentage(1/$_end);
  $_stops         : ();
  $_size          : span(1 $grid wide);

  @if is-inside($grid) {
    $_stops: $_color, $_light;
  } @else if is-split($grid) {
    $_split: $_gutters/2;
    $_before: percentage($_split/$_end);
    $_after: percentage((1 + $_split)/$_end);
    $_stops: $_trans $_before, $_color $_before, $_light $_after, $_trans $_after;
  } @else {
    $_stops: $_color, $_light $_after, $_trans $_after;
  }

  @if $_math == static {
    $_size: valid-column-math($_math, $_column-width) * $_end;
  }

  $_output: (
    image: (columns: $_stops),
    size: $_size,
  );

  @return $_output;
}


// Get Asymmetrical Inside
// -----------------------
// - $grid: <settings>
@function get-asym-inside(
  $grid
) {
  $grid     : parse-grid($grid);
  $_columns : susy-get(columns, $grid);

  $_color   : debug-get(color);
  $_light   : lighten($_color, 15%);
  $_stops   : ();

  @for $location from 1 through susy-count($_columns) {
    $this-stop: ();

    @if $location == 1 {
      $this-stop: append($this-stop, $_color, comma);
    } @else {
      $start: parse-span(1 at $location $grid);
      $start: get-isolation($start);
      $this-stop: append($this-stop, $_color $start, comma);
    }

    @if $location == susy-count($_columns) {
      $this-stop: append($this-stop, $_light, comma);
    } @else {
      $_end: parse-span(1 at ($location + 1) $grid);
      $_end: get-isolation($_end);
      $this-stop: append($this-stop, $_light $_end, comma);
    }

    $_stops: join($_stops, $this-stop, comma);
  }

  @return $_stops;
}


// Get Asymmetrical Split
// ----------------------
// - $grid: <settings>
@function get-asym-split(
  $grid
) {
  $grid     : parse-grid($grid);
  $_columns : susy-get(columns, $grid);

  $_color   : debug-get(color);
  $_light   : lighten($_color, 15%);
  $_stops   : ();

  @for $location from 1 through susy-count($_columns) {
    $this-stop: ();

    $start: parse-span(1 at $location $grid);
    $start: get-isolation($start);
    $this-stop: append($this-stop, transparent $start, comma);
    $this-stop: append($this-stop, $_color $start, comma);

    $_end: $start + span(1 at $location $grid);
    $this-stop: append($this-stop, $_light $_end, comma);
    $this-stop: append($this-stop, transparent $_end, comma);

    $_stops: join($_stops, $this-stop, comma);
  }

  @return $_stops;
}


// Get Asymmetrical Outside
// ------------------------
// - $grid: <settings>
@function get-asym-outside(
  $grid
) {
  $grid     : parse-grid($grid);
  $_columns : susy-get(columns, $grid);

  $_color   : debug-get(color);
  $_light   : lighten($_color, 15%);
  $_trans   : transparent;
  $_stops   : ();

  @for $location from 1 through susy-count($_columns) {
    $this-stop: ();

    @if $location == 1 {
      $this-stop: append($this-stop, $_color, comma);
    } @else {
      $start: parse-span(1 at $location $grid);
      $start: get-isolation($start);
      $this-stop: append($this-stop, $_color $start, comma);
    }

    @if $location == susy-count($_columns) {
      $this-stop: append($this-stop, $_light, comma);
    } @else {
      $gutter: get-span-width(first $location $grid);

      $_end: parse-span(1 at ($location + 1) $grid);
      $_end: get-isolation($_end);

      $gutter: $_light $gutter, $_trans $gutter, $_trans $_end;
      $this-stop: join($this-stop, $gutter, comma);
    }

    $_stops: join($_stops, $this-stop, comma);
  }

  @return $_stops;
}


// Get Asymmetrical Background
// ---------------------------
// - $grid: <settings>
@function get-background-asym(
  $grid
) {
  $_stops: ();

  @if is-inside($grid) {
    $_stops: get-asym-inside($grid);
  } @else if is-split($grid) {
    $_stops: get-asym-split($grid);
  } @else {
    $_stops: get-asym-outside($grid);
  }

  @return (image: (columns: $_stops));
}


// Get Background
// --------------
// - $grid: <settings>
@function get-background(
  $grid
) {
  $grid     : parse-grid($grid);
  $_show    : susy-get(debug image, $grid);
  $_return  : ();

  @if $_show and $_show != 'hide' {
    $_columns: susy-get(columns, $grid);

    @if $_show != 'show-baseline' {
      $_sym: is-symmetrical($_columns);
      $_return: if($_sym, get-background-sym($grid), get-background-asym($grid));
      $_return: map-merge($_return, (clip: content-box));
    }

    @if $_show != 'show-columns'
      and global-variable-exists(base-line-height)
      and type-of($base-line-height) == 'number'
      and not unitless($base-line-height) {
      $_color: variable-exists('grid-background-baseline-color');
      $_color: if($_color, $grid-background-baseline-color, #000);

      $_image: map-get($_return, image);
      $_size: map-get($_return, size);
      $_baseline: (baseline: ($_color 1px, transparent 1px));
      $_baseline-size: 100% $base-line-height;

      $_return: map-merge($_return, (
        image: if($_image, map-merge($_image, $_baseline), $_baseline),
        size: if($_size, ($_size, $_baseline-size), $_baseline-size),
      ));

      @if $_show == 'show' {
        $_clip: map-get($_return, clip);
        $_return: map-merge($_return, (clip: join($_clip, border-box, comma)));
      }
    } @else if $_show == 'show-baseline' {
      @warn 'Please provide a $base-line-height with the desired height and units';
    }
  }

  @if map-get($_return, image) {
    $_return: map-merge($_return, (flow: susy-get(flow, $grid)));
  }

  @return $_return;
}


// Get Debug
// ---------
// Return the value of a debug setting
// - $key: <setting>
@function debug-get(
  $key,
  $grid: $susy
) {
  $key: join(debug, $key, space);
  @return susy-get($key, $grid);
}

/* scss-combine:susy/container */
// Container Syntax
// ================

// Container [mixin]
// -----------------
// Set a container element
// - [$layout]  : <settings>
@mixin container(
  $layout: $susy
) {
  $inspect    : $layout;
  $layout     : parse-grid($layout);

  $_width     : get-container-width($layout);
  $_justify   : parse-container-position(susy-get(container-position, $layout));
  $_property  : if(susy-get(math, $layout) == static, width, max-width);

  $_box       : susy-get(box-sizing, $layout);

  @if $_box {
    @include output((box-sizing: $_box));
  }

  @include susy-inspect(container, $inspect);
  @include float-container($_width, $_justify, $_property);
  @include show-grid($layout);
}

// Container [function]
// --------------------
// Return container width
// - [$layout]  : <settings>
@function container(
  $layout: $susy
) {
  $layout: parse-grid($layout);
  @return get-container-width($layout);
}

// Get Container Width
// -------------------
// Calculate the container width
// - [$layout]: <settings>
@function get-container-width(
  $layout: $susy
) {
  $layout         : parse-grid($layout);
  $_width         : susy-get(container, $layout);
  $_column-width  : susy-get(column-width, $layout);
  $_math          : susy-get(math, $layout);

  @if not($_width) or $_width == auto {
    @if valid-column-math($_math, $_column-width) {
      $_columns   : susy-get(columns, $layout);
      $_gutters   : susy-get(gutters, $layout);
      $_spread    : if(is-split($layout), wide, narrow);
      $_width     : susy-sum($_columns, $_gutters, $_spread) * $_column-width;
    } @else {
      $_width: 100%;
    }
  }

  @return $_width;
}

// Parse Container Position
// ------------------------
// Parse the $container-position into margin values.
// - [$justify]   : left | center | right | <length> [<length>]
@function parse-container-position(
  $justify: map-get($susy-defaults, container-position)
) {
  $_return: if($justify == left, 0, auto) if($justify == right, 0, auto);

  @if not(index(left right center, $justify)) {
    $_return: nth($justify, 1);
    $_return: $_return if(length($justify) > 1, nth($justify, 2), $_return);
  }

  @return $_return;
}

/* scss-combine:susy/span */
// Span Syntax
// ===========

// Span [mixin]
// ------------
// Set a spanning element using shorthand syntax.
// - $span  : <span>
@mixin span(
  $span
) {
  $inspect: $span;
  $span: parse-span($span);
  $output: span-math($span);
  $nesting: susy-get(span, $span);
  $clear: susy-get(clear, $span);

  $box: susy-get(box-sizing, $span);
  $content-box: if(susy-get(global-box-sizing) != 'border-box', true, false);
  $box: $box or if(is-inside($span) and $content-box, border-box, null);

  @if $clear == break {
    @include break;
  } @else if $clear == nobreak {
    @include nobreak;
  }

  @include susy-inspect(span, $inspect);
  @include output((box-sizing: $box));
  @include float-span-output($output...);

  @if valid-columns($nesting, silent) {
    @include nested($span) { @content; }
  } @else {
    @content;
  }
}

// Span [function]
// ---------------
// Return the width of a span.
// - $span  : <span>
@function span(
  $span
) {
  @return get-span-width($span);
}

// Span Math
// ---------
// Get all the span results.
// - $span: <map>
@function span-math(
  $span
) {
  $nest             : if(susy-get(role, $span) == nest, true, false);
  $split-nest       : if(is-split($span) and $nest, true, false);
  $edge             : get-edge($span);
  $location         : get-location($span);

  $float            : from;
  $padding-before   : null;
  $padding-after    : null;
  $margin-before    : null;
  $margin-after     : null;

  // calculate widths
  $spread: index(map-values($span), spread);
  $span: if($split-nest and not($spread), map-merge($span, (spread: wide)), $span);
  $width: get-span-width($span);
  $gutters: get-gutters($span);

  // apply gutters
  @if is-inside($span) {
    @if not(susy-get(role, $span)) {
      $padding-before: map-get($gutters, before);
      $padding-after: map-get($gutters, after);
    }
  } @else {
    @if not($split-nest) {
      $margin-before: map-get($gutters, before);
      $margin-after: map-get($gutters, after);
    }
  }

  // special margin handling
  @if susy-get(output, $span) == isolate and $location {
    $margin-before: get-isolation($span);
    $margin-after: -100%;
  } @else if $edge {
    $is-split: is-split($span);
    $pos: susy-get(gutter-position, $span);

    @if $edge == last {
      $float: susy-get(last-flow, $span);
    }

    @if not($is-split) {
      @if $edge == full or ($edge == first and $pos == before) {
        $margin-before: 0;
      }
      @if $edge == full or ($edge == last and $pos == after) {
        $margin-after: 0;
      }
    }

  }

  @return (
    width           : $width,
    float           : $float,
    margin-before   : $margin-before,
    margin-after    : $margin-after,
    padding-before  : $padding-before,
    padding-after   : $padding-after,
    flow            : susy-get(flow, $span),
  );
}

// Get Span Width
// --------------
// Return span width.
// - $span: <map>
@function get-span-width(
  $span
) {
  $span     : parse-span($span);

  $n        : susy-get(span, $span);
  $location : get-location($span);
  $columns  : susy-get(columns, $span);
  $gutters  : susy-get(gutters, $span);
  $spread   : susy-get(spread, $span);

  $context  : null;
  $span-sum : null;
  $width    : null;

  @if $n == 'full' {
    $pos: susy-get(gutter-position, $span);
    $role: susy-get(role, $span);
    $n: if($pos == split and $role != nest, susy-count($columns), 100%);
  }

  @if type-of($n) != number {
    @warn "(#{type-of($n)}) #{$n} is not a valid span.";
  } @else if unitless($n) {
    $context: susy-sum($columns, $gutters, if(is-split($span), wide, narrow));
    $spread: if(is-inside($span), $spread or wide, $spread);
    $span-sum: susy($n, $location, $columns, $gutters, $spread);

    $_math: susy-get(math, $span);
    $_column-width: susy-get(column-width, $span);
    @if $_math == static {
      $width: $span-sum * valid-column-math($_math, $_column-width);
    } @else {
      $width: percentage($span-sum / $context);
    }
  } @else {
    $width: $n;
  }

  @return $width;
}

/* scss-combine:susy/gutters */
// Gutter Syntax
// =============


// Gutters
// -------
// Set gutters on an element.
// - [$span]   : <settings>
@mixin gutters(
  $span: $susy
) {
  $inspect  : $span;
  $span     : parse-gutters($span);
  $_gutters : get-gutters($span);

  $_output: (
    before: map-get($_gutters, before),
    after: map-get($_gutters, after),
    flow: susy-get(flow, $span),
  );

  @include susy-inspect(gutters, $inspect);

  @if is-inside($span) {
    @include padding-output($_output...);
  } @else {
    @include margin-output($_output...);
  }
}

@mixin gutter(
  $span: $susy
) {
  @include gutters($span);
}


// Gutter
// ------
// Return the width of a gutter.
// - [$span]   : <settings>
@function gutter(
  $span: $susy
) {
  $span: parse-gutters($span);

  $_gutters: get-gutters($span);
  $_gutters: map-get($_gutters, before) or map-get($_gutters, after);

  @return $_gutters;
}

@function gutters(
  $span: $susy
) {
  @return gutter($span);
}


// Get Gutter Width
// ----------------
// Return gutter width.
// - [$context]: <context>
@function get-gutter-width(
  $context: $susy
) {
  $context  : parse-gutters($context);

  $_gutters : susy-get(gutters, $context);
  $_gutter  : susy-get(gutter-override, $context);

  @if $_gutters and ($_gutters > 0) and not($_gutter) {
    $_column-width: susy-get(column-width, $context);
    $_math: gutter-math($context);
    @if $_math == static {
      $_gutter: $_gutters * valid-column-math($_math, $_column-width);
    } @else {
      $_columns : susy-get(columns, $context);
      $_spread  : if(is-split($context), wide, susy-get(spread, $context));
      $_gutter  : percentage($_gutters / susy-sum($_columns, $_gutters, $_spread));
    }
  }

  $_gutter: if($_gutter == 'no-gutters' or $_gutter == 'no-gutter', null, $_gutter);

  @return $_gutter;
}


// Get Gutters
// -----------
// Return before and after gutter values.
// - [$context]: <context>
@function get-gutters(
  $context: $susy
) {
  $context            : parse-gutters($context);

  $_gutter-position   : susy-get(gutter-position, $context);
  $_gutter            : get-gutter-width($context);

  $_return            : (before: null, after: null);

  @if is-split($context) and $_gutter {
    $_gutter: $_gutter / 2;
    $_return: map-merge($_return, (before: $_gutter, after: $_gutter));
  } @else {
    $_return: map-merge($_return, ($_gutter-position: $_gutter));
  }

  @return $_return;
}


// Is Inside
// ---------
// Returns true if gutters are inside.
// $context: <context>
@function is-inside(
  $context
) {
  $_inside: inside inside-static;
  $_gutter-position: susy-get(gutter-position, $context);

  @return if(index($_inside, $_gutter-position), true, false);
}


// Is Split
// --------
// Returns true if gutters are split.
// $context: <context>
@function is-split(
  $context
) {
  $_split: split inside inside-static;
  $_gutter-position: susy-get(gutter-position, $context);

  @return if(index($_split, $_gutter-position), true, false);
}


// Gutter Math
// -----------
// Return the math to use for gutter calculations
// $context: <context>
@function gutter-math(
  $context: $susy
) {
  $_return  : susy-get(math, $context);
  $_return  : if(susy-get(gutter-position, $context) == inside-static, static, $_return);

  @return $_return;
}

/* scss-combine:susy/isolate */
// Isolation Syntax
// ================


// Isolate [Mixin]
// ---------------
// Set isolation as an override.
// - $location: <span>
@mixin isolate(
  $isolate: 1
) {
  $inspect: $isolate;

  $output: (
    push: isolate($isolate),
    flow: susy-get(flow, $isolate),
  );

  @include susy-inspect(isolate, $inspect);
  @include isolate-output($output...);
}


// Isolate [function]
// ------------------
// Return an isolation offset width.
// - $location: <span>
@function isolate(
  $isolate: 1
) {
  $isolate: parse-span($isolate);
  $isolation: susy-get(span, $isolate);

  @if $isolation and not(get-location($isolate)) {
    $new: (
      span: null,
      location: $isolation,
    );
    $isolate: map-merge($isolate, $new);
  }

  @return get-isolation($isolate);
}


// Get Isolation
// -------------
// Return the isolation offset width
// - $input: <map>
@function get-isolation(
  $input
) {
  $location   : get-location($input);
  $columns    : susy-get(columns, $input);
  $width      : null;

  @if type-of($location) == number and not(unitless($location)) {
    $width: $location;
  } @else if $location {
    $push: $location - 1;
    @if $push > 0 {
      $push: map-merge($input, (
        span: $push,
        location: 1,
        spread: wide,
      ));
      $width: get-span-width($push);
    }
  }

  @if susy-get(gutter-position, $input) == split
      and susy-get(gutters, $input) > 0 {
    $width: if($width == null, gutters($input), $width + gutters($input));
  }

  @return $width or 0;
}

/* scss-combine:susy/gallery */
// Gallery Syntax
// ==============

// Gallery
// -------
// Create an isolated gallery
// - $span        : <span>
// - [$selector]  : child | of-type
@mixin gallery(
  $span,
  $selector: child
) {
  $inspect    : $span;
  $span       : parse-span($span);
  $span       : map-merge($span, (location: 1));

  $n            : susy-get(span, $span);
  $columns      : susy-get(columns, $span);
  $context      : susy-count($columns);
  $flow         : susy-get(flow, $span);

  $inside       : is-inside($span);
  $from         : from($flow);
  $line         : floor($context / $n);
  $symmetrical  : is-symmetrical($columns);

  $output: (
    width             : null,
    float             : from,
    margin-before     : null,
    margin-after      : null,
    padding-before    : null,
    padding-after     : null,
    flow              : $flow,
  );

  @if $inside {
    $gutters: get-gutters($span);
    $output: map-merge($output, (
      padding-before: map-get($gutters, before),
      padding-after: map-get($gutters, after),
    ));
  }

  @if $symmetrical {
    $output: map-merge($output, (width: get-span-width($span)));
  }

  $box          : susy-get(box-sizing, $span);
  $global-box   : if(susy-get(global-box-sizing) == 'border-box', true, false);

  @include susy-inspect(gallery, $inspect);

  // Collective Output
  @if $box == border-box or ($inside and not($box) and not($global-box)) {
    @include output((box-sizing: border-box));
  } @else if $box == content-box {
    @include output((box-sizing: content-box));
  }

  @include float-span-output($output...);

  // Individual Loop
  @for $item from 1 through $line {
    $nth: '#{$line}n + #{$item}';
    &:nth-#{$selector}(#{$nth}) {
      // Individual Prep
      $output: (
        width             : if($symmetrical, null, get-span-width($span)),
        float             : null,
        margin-before     : get-isolation($span),
        margin-after      : -100%,
        padding-before    : null,
        padding-after     : null,
        flow              : $flow,
      );

      // Individual Output
      @include float-span-output($output...);

      @if get-edge($span) == first {
        @include break;
        @include first($span);
      } @else {
        @include nobreak;
      }

      // Individual Location Increment
      $location: get-location($span) + $n;
      $location: if($location > $context, 1, $location);
      $span: map-merge($span, (location: $location));
    }
  }
}

/* scss-combine:susy/rows */
// Row Start & End
// ===============

// Break
// -----
// Apply to any element that should force a line break.
@mixin break {
  @include output((clear: both));
}


// NoBreak
// -------
// Cancel the break() effect, e.g. when using media queries.
@mixin nobreak {
  @include output((clear: none));
}


// Full
// ----
// - [$context]: <layout shorthand>
@mixin full(
  $context: $susy
) {
  $inspect : $context;
  @include susy-inspect(full, $inspect);
  @include span(full of parse-grid($context) break);
}


// First
// -----
// - [$context]: <settings>
@mixin first(
  $context: $susy
) {
  $inspect  : $context;
  $context  : parse-grid($context);
  $flow     : susy-get(flow, $context);

  @include susy-inspect(first, $inspect);
  @if not(is-split($context)) {
    @include float-first($flow);
  }
}

@mixin alpha(
  $context: $susy
) {
  @include first($context);
}


// Last
// ----
// - [$context]: <settings>
@mixin last(
  $context: $susy
) {
  $inspect  : $context;
  $context  : parse-grid($context);

  @include susy-inspect(last, $inspect);

  $output: (
    flow: susy-get(flow, $context),
    last-flow: susy-get(last-flow, $context),
    margin: if(is-split($context), null, 0),
  );

  @include float-last($output...);
}

@mixin omega(
  $context: $susy
) {
  @include last($context);
}


// Get Edge
// --------
// Calculate edge value based on location, if possible
@function get-edge(
  $span
) {
  $span       : parse-span($span);
  $edge       : susy-get(edge, $span);

  @if not($edge) {
    $count: susy-count(susy-get(columns, $span));
    $location: susy-get(location, $span);
    $n: susy-get(span, $span);

    $number: if(type-of($location) == number, true, false);
    $index: if($number and unitless($location), true, false);

    @if $n == $count {
      $edge: full;
    } @else if $location and $n and $index {
      @if $location == 1 {
        $edge: if($n == $count, full, first);
      } @else if $location + $n - 1 == $count {
        $edge: last;
      }
    }
  }

  @if $edge == alpha or $edge == omega {
    $edge: if($edge == alpha, first, last);
  }

  @return $edge;
}


// Get Location
// ------------
// Calculate location value based on edge, if possible
@function get-location(
  $span
) {
  $span       : parse-span($span);
  $location   : susy-get(location, $span);
  $edge       : get-edge($span);
  $n          : susy-get(span, $span);

  @if $edge and not($location) and type-of($n) == number and unitless($n) {
    @if $edge == first {
      $location: 1;
    } @else if $edge == last {
      $location: susy-count(susy-get(columns, $span)) - $n + 1;
    }
  }

  @return $location
}

/* scss-combine:susy/margins */
// Margin Syntax
// =============

// Pre
// ---
// Add spanning-margins before an element.
// - $span  : <span>
@mixin pre(
  $span
) {
  $inspect: $span;
  $span   : map-merge((spread: wide), parse-span($span));
  $flow   : susy-get(flow, $span);
  $split  : if(susy-get(gutter-position, $span) == split, true, false);
  $gutter : gutter($span);
  $span   : span($span);
  $width  : if($split and $gutter, $span + $gutter, $span);

  @include susy-inspect(pre, $inspect);
  @include margin-output($width, null, $flow);
}

// Post
// ----
// Add spanning-margins after an element.
// - $span  : <span>
@mixin post(
  $span
) {
  $inspect  : $span;
  $span     : map-merge((spread: wide), parse-span($span));
  $flow     : susy-get(flow, $span);
  $split    : if(susy-get(gutter-position, $span) == split, true, false);
  $width    : if($split, span($span) + gutter($span), span($span));

  @include susy-inspect(post, $inspect);
  @include margin-output(null, $width, $flow);
}

// Push
// ----
// Simple synonymn for pre.
// - $span  : <span>
@mixin push(
  $span
) {
  @include pre($span);
}

// Pull
// ----
// Add negative spanning-margins before an element.
// - $span  : <span>
@mixin pull(
  $span
) {
  $inspect  : $span;
  $span     : map-merge((spread: wide), parse-span($span));
  $flow     : susy-get(flow, $span);
  $split    : if(susy-get(gutter-position, $span) == split, true, false);
  $width    : if($split, 0 - span($span) + gutter($span), 0 - span($span));

  @include susy-inspect(pull, $inspect);
  @include margin-output($width, null, $flow);
}

// Squish
// ------
// Add spanning-margins before and after an element.
// - $pre     : <span>
// - [$post]  : <span>
@mixin squish(
  $pre,
  $post: false
) {
  $inspect      : ($pre, $post);
  $pre          : map-merge((spread: wide), parse-span($pre));

  @if $post {
    $post: map-merge((spread: wide), parse-span($post));
  } @else {
    $span: susy-get(span, $pre);
    @if length($span) > 1 {
      $pre: map-merge($pre, (span: nth($span, 1)));
      $post: map-merge($pre, (span: nth($span, 2)));
    } @else {
      $post: $pre;
    }
  }

  @include susy-inspect(squish, $inspect);
  @include pre($pre);
  @include post($post);
}

/* scss-combine:susy/padding */
// Padding Syntax
// ==============

// Prefix
// ------
// Add spanning-padding before an element.
// - $span  : <span>
@mixin prefix(
  $span
) {
  $inspect  : $span;
  $span     : map-merge((spread: wide), parse-span($span));
  $flow     : susy-get(flow, $span);
  $width    : span($span);

  @if is-inside($span) {
    $gutter: gutter($span);
    $width: if($gutter and comparable($width, $gutter), $width + $gutter, $width);
  }

  @include susy-inspect(prefix, $inspect);
  @include padding-output($width, null, $flow);
}

// Suffix
// ------
// Add spanning-padding after an element.
// - $span  : <span>
@mixin suffix(
  $span
) {
  $inspect  : $span;
  $span     : map-merge((spread: wide), parse-span($span));
  $flow     : susy-get(flow, $span);
  $width    : span($span);

  @if is-inside($span) {
    $gutter: gutter($span);
    $width: if($gutter and comparable($width, $gutter), $width + $gutter, $width);
  }

  @include susy-inspect(suffix, $inspect);
  @include padding-output(null, $width, $flow);
}

// Pad
// ---
// Add spanning-padding before and after an element.
// - $pre     : <span>
// - [$post]  : <span>
@mixin pad(
  $pre,
  $post: false
) {
  $inspect  : ($pre, $post);
  $pre      : map-merge((spread: wide), parse-span($pre));

  @if $post {
    $post: map-merge((spread: wide), parse-span($post));
  } @else {
    $span: susy-get(span, $pre);
    @if length($span) > 1 {
      $pre: map-merge($pre, (span: nth($span, 1)));
      $post: map-merge($pre, (span: nth($span, 2)));
    } @else {
      $post: $pre;
    }
  }

  @include susy-inspect(pad, $inspect);
  @include prefix($pre);
  @include suffix($post);

}

/* scss-combine:susy/bleed */
// Bleed Syntax
// ============

// Bleed
// -----
// Add negative margins, and equal positive padding to create bleed.
// - $bleed  : <span>
@mixin bleed(
  $bleed: 0 gutter()
) {
  $inspect  : $bleed;
  $output   : get-bleed($bleed);

  @if susy-get(global-box-sizing) != content-box {
    $output: map-merge((box-sizing: content-box), $output);
  }

  @include susy-inspect(bleed, $inspect);
  @include output($output);
}


// Bleed-x
// -------
// Shortcut for horizontal bleed.
// - $bleed  : <span>
@mixin bleed-x(
  $bleed: gutter()
) {
  $bleed  : parse-span($bleed);
  $trbl   : susy-get(span, $bleed);

  @if length($trbl) == 1 {
    $bleed: map-merge($bleed, (span: 0 nth($trbl, 1)));
  } @else if length($trbl) == 2 {
    $bleed: map-merge($bleed, (span: 0 nth($trbl, 2) 0 nth($trbl, 1)));
  } @else {
    @warn 'bleed-x only takes 2 lengths, but #{length($trbl)} were passed.';
  }

  @include bleed($bleed);
}


// Bleed-y
// -------
// Shortcut for vertical bleed.
// - $bleed  : <span>
@mixin bleed-y(
  $bleed: if(function-exists(rhythm), rhythm(1), 1em)
) {
  $bleed  : parse-span($bleed);
  $trbl   : susy-get(span, $bleed);

  @if length($trbl) == 1 {
    $bleed: map-merge($bleed, (span: nth($trbl, 1) 0));
  } @else if length($trbl) == 2 {
    $bleed: map-merge($bleed, (span: nth($trbl, 1) 0 nth($trbl, 2) 0));
  } @else {
    @warn 'bleed-y only takes 2 lengths, but #{length($trbl)} were passed.';
  }

  @include bleed($bleed);
}


// Get Bleed
// ---------
// Return bleed output values
// - $bleed: <span>
@function get-bleed(
  $bleed
) {
  $bleed    : map-merge((spread: wide), parse-span($bleed));
  $trbl     : susy-get(span, $bleed);
  $short    : null;
  $output   : ();

  @for $i from 1 through length($trbl) {
    $this: nth($trbl, $i);
    $new: ();
    $margin: null;
    $padding: null;
    $padding-x: null;

    @if $this > 0 {
      $this: map-merge($bleed, (span: $this));
      $margin: span($this);
      $padding: $margin;
      $padding-x: $padding;
    }

    @if $margin and $margin > 0 {
      $margin: - $margin;

      @if is-inside($this) {
        $gutter: gutter($this);
        $join: if($gutter and comparable($padding, $gutter), true, false);
        $padding-x: if($join and $padding > 0, $padding + $gutter, $padding);
      }
    }

    @if $i == 1 {
      $new: (
        margin-top: $margin,
        padding-top: $padding,
        margin-right: $margin,
        padding-right: $padding-x,
        margin-bottom: $margin,
        padding-bottom: $padding,
        margin-left: $margin,
        padding-left: $padding-x,
      );
    } @else if $i == 2 {
      $new: (
        margin-right: $margin,
        padding-right: $padding-x,
        margin-left: $margin,
        padding-left: $padding-x,
      );
    } @else if $i == 3 {
      $new: (
        margin-bottom: $margin,
        padding-bottom: $padding,
      );
    } @else if $i == 4 {
      $new: (
        margin-left: $margin,
        padding-left: $padding-x,
      );
    }

    $output: map-merge($output, $new);
  }

  @each $prop, $value in $output {
    $output: if($value == 0, map-merge($output, ($prop: null)), $output);
  }

  @return bleed-shorthand($output);
}

// Bleed Shorthand
// ---------------
// Convert bleed output into shorthand when possible.
// - $bleed: <output map>
@function bleed-shorthand(
  $bleed
) {
  $margin: ();
  $padding: ();
  $return: ();

  @each $key, $value in $bleed {
    @if str-index($key, margin) {
      $margin: map-merge($margin, ($key: $value));
    } @else if str-index($key, padding) > 0 {
      $padding: map-merge($padding, ($key: $value));
    }
  }

  $props: (
    margin: $margin,
    padding: $padding,
  );

  @each $name, $map in $props {
    $four: if(length(map-keys($map)) == 4, true, false);
    $null: if(index(map-values($map), null), true, false);

    @if $four and not($null) {
      $top: map-get($map, '#{$name}-top');
      $right: map-get($map, '#{$name}-right');
      $bottom: map-get($map, '#{$name}-bottom');
      $left: map-get($map, '#{$name}-left');

      $tb: if($top == $bottom, $top, null);
      $rl: if($right == $left, $right, null);
      $all: if($tb == $rl, $tb, null);

      $new: if($all, $all, null);

      @if not($new) {
        @if $tb and $rl {
          $new: $tb $rl;
        } @else if $rl {
          $new: $top $rl $bottom;
        } @else {
          $new: $top $right $bottom $left;
        }
      }

      $return: map-merge($return, ($name: $new));
    } @else {
      $return: map-merge($return, $map);
    }
  }

  @return $return;
}

/* scss-combine:susy/breakpoint-plugin */
// Breakpoint Integration
// ======================

$susy-media: () !default;
$susy-media-fallback: false !default;

$_susy-media-context: ();


// Susy Breakpoint
// ---------------
// Change grids at different media query breakpoints.
// - $query     : <min-width> [<max-width>] | <property> <value> | <map>
// - $layout    : <settings>
// - $no-query  : <boolean> | <selector>
@mixin susy-breakpoint(
  $query,
  $layout: false,
  $no-query: $susy-media-fallback
) {
  @include susy-media-router($query, $no-query) {
    @if $layout {
      @include with-layout($layout) {
        @content;
      }
    } @else {
      @content;
    }
  }
}


// Susy Media
// ----------
// - $query: <min-width> [<max-width>] | <property> <value>
// - $no-query: <boolean> | <selector>
@mixin susy-media(
  $query,
  $no-query: $susy-media-fallback
) {
  $old-context: $_susy-media-context;
  $name: if(map-has-key($susy-media, $query), $query, null);
  $query: susy-get-media($query);
  $query: susy-parse-media($query);

  @include susy-media-context($query, $name);

  @if $no-query and type-of($no-query) != string {
    @content;
  } @else {
    @media #{susy-render-media($query)} {
      @content;
    }

    @if type-of($no-query) == string {
      #{$no-query} & {
        @content;
      }
    }
  }

  @include susy-media-context($old-context, $clean: true);
}


// Media Router
// ------------
// Rout media arguments to the correct mixin.
@mixin susy-media-router(
  $query,
  $no-query: $susy-media-fallback
) {
  @if susy-support(breakpoint, (mixin: breakpoint), $warn: false) {
    @include breakpoint($query, $no-query) {
      @content;
    }
  } @else {
    @include susy-media($query, $no-query) {
      @content;
    }
  }
}


// Update Context
// -------------
// Set the new media context
@mixin susy-media-context(
  $query,
  $name: null,
  $clean: false
) {
  $query: map-merge((name: $name), $query);

  @if $clean {
    $_susy-media-context: $query !global;
  } @else {
    $_susy-media-context: map-merge($_susy-media-context, $query) !global;
  }
}


// Media Context
// -------------
// Return the full media context, or a single media property (e.g. min-width)
@function susy-media-context(
  $property: false
) {
  @if $property {
    @return map-get($_susy-media-context, $property);
  } @else {
    @return $_susy-media-context;
  }
}


// Get Media
// ---------
// Return a named media-query from $susy-media.
// - $name: <key>
@function susy-get-media(
  $name
) {
  @if map-has-key($susy-media, $name) {
    $map-value: map-get($susy-media, $name);
    @if ($name == $map-value) {
      $name: $map-value;
    } @else {
      $name: susy-get-media($map-value);
    }
  }

  @return $name;
}


// Render Media
// ------------
// Build a media-query string from various media settings
@function susy-render-media(
  $query
) {
  $output: null;
  @each $property, $value in $query {
    $string: null;

    @if $property == media {
      $string: $value;
    } @else {
      $string: '(#{$property}: #{$value})';
    }

    $output: if($output, '#{$output} and #{$string}', $string);
  }

  @return $output;
}


// Parse Media
// -----------
// Return parsed media-query settings based on shorthand
@function susy-parse-media(
  $query
) {
  $mq: null;
  @if type-of($query) == map {
    $mq: $query;
  } @else if type-of($query) == number {
    $mq: (min-width: $query);
  } @else if type-of($query) == list and length($query) == 2 {
    @if type-of(nth($query, 1)) == number {
      $mq: (
        min-width: min($query...),
        max-width: max($query...),
      );
    } @else {
      $mq: (nth($query, 1): nth($query, 2));
    }
  } @else {
    $mq: (media: '#{$query}');
  }

  @return $mq;
}



/* scss-combine:../../node_modules/breakpoint-sass/stylesheets/breakpoint */
//////////////////////////////
// Default Variables
//////////////////////////////
$Breakpoint-Settings: (
  'default media': all,
  'default feature': min-width,
  'default pair': width,

  'force all media type': false,
  'to ems': false,
  'transform resolutions': true,

  'no queries': false,
  'no query fallbacks': false,

  'base font size': 16px,

  'legacy syntax': false
);

$breakpoint: () !default;

//////////////////////////////
// Imports
//////////////////////////////
/* scss-combine:breakpoint/settings */
//////////////////////////////
// Has Setting
//////////////////////////////
@function breakpoint-has($setting) {
  @if map-has-key($breakpoint, $setting) {
    @return true;
  }
  @else {
    @return false;
  }
}

//////////////////////////////
// Get Settings
//////////////////////////////
@function breakpoint-get($setting) {
  @if breakpoint-has($setting) {
    @return map-get($breakpoint, $setting);
  }
  @else {
    @return map-get($Breakpoint-Settings, $setting);
  }
}

//////////////////////////////
// Set Settings
//////////////////////////////
@function breakpoint-set($setting, $value) {
  @if (str-index($setting, '-') or str-index($setting, '_')) and str-index($setting, ' ') == null {
    @warn "Words in Breakpoint settings should be separated by spaces, not dashes or underscores. Please replace dashes and underscores between words with spaces. Settings will not work as expected until changed.";
  }
  $breakpoint: map-merge($breakpoint, ($setting: $value)) !global;
  @return true;
}

@mixin breakpoint-change($setting, $value) {
  $breakpoint-change: breakpoint-set($setting, $value);
}

@mixin breakpoint-set($setting, $value) {
  @include breakpoint-change($setting, $value);
}

@mixin bkpt-change($setting, $value) {
  @include breakpoint-change($setting, $value);
}
@mixin bkpt-set($setting, $value) {
  @include breakpoint-change($setting, $value);
}

//////////////////////////////
// Remove Setting
//////////////////////////////
@function breakpoint-reset($settings...) {
  @if length($settings) == 1 {
    $settings: nth($settings, 1);
  }

  @each $setting in $settings {
    $breakpoint: map-remove($breakpoint, $setting) !global;
  }
  @return true;
}

@mixin breakpoint-reset($settings...) {
  $breakpoint-reset: breakpoint-reset($settings);
}

@mixin bkpt-reset($settings...) {
  $breakpoint-reset: breakpoint-reset($settings);
}
/* scss-combine:breakpoint/context */
//////////////////////////////
// Private Breakpoint Variables
//////////////////////////////
$private-breakpoint-context-holder: ();
$private-breakpoint-query-count: 0 !default;

//////////////////////////////
// Breakpoint Has Context
// Returns whether or not you are inside a Breakpoint query
//////////////////////////////
@function breakpoint-has-context() {
  @if length($private-breakpoint-query-count) {
    @return true;
  }
  @else {
    @return false;
  }
}

//////////////////////////////
// Breakpoint Get Context
// $feature: Input feature to get it's current MQ context. Returns false if no context
//////////////////////////////
@function breakpoint-get-context($feature) {
  @if map-has-key($private-breakpoint-context-holder, $feature) {
    $get: map-get($private-breakpoint-context-holder, $feature);
    // Special handling of no-query from get side so /false/ prepends aren't returned
    @if $feature == 'no-query' {
      @if type-of($get) == 'list' and length($get) > 1 and nth($get, 1) == false {
        $get: nth($get, length($get));
      }
    }
    @return $get;
  }
  @else {
    @if breakpoint-has-context() and $feature == 'media' {
      @return breakpoint-get('default media');
    }
    @else {
      @return false;
    }
  }
}

//////////////////////////////
// Private function to set context
//////////////////////////////
@function private-breakpoint-set-context($feature, $value) {
  @if $value == 'monochrome' {
    $feature: 'monochrome';
  }

  $current: map-get($private-breakpoint-context-holder, $feature);
  @if $current and length($current) == $private-breakpoint-query-count {
    @warn "You have already queried against `#{$feature}`. Unexpected things may happen if you query against the same feature more than once in the same `and` query. Breakpoint is overwriting the current context with `#{$value}`";
  }

  @if not map-has-key($private-breakpoint-context-holder, $feature) {
    $v-holder: ();
    @for $i from 1 to $private-breakpoint-query-count {
      @if $feature == 'media' {
        $v-holder: append($v-holder, breakpoint-get('default media'));
      }
      @else {
        $v-holder: append($v-holder, false);
      }
    }
    $v-holder: append($v-holder, $value);
    $private-breakpoint-context-holder: map-merge($private-breakpoint-context-holder, ($feature: $v-holder)) !global;
  }
  @else {
    $v-holder: map-get($private-breakpoint-context-holder, $feature);
    $length: length($v-holder);
    @for $i from $length to $private-breakpoint-query-count - 1 {
      @if $feature == 'media' {
        $v-holder: append($v-holder, breakpoint-get('default media'));
      }
      @else {
        $v-holder: append($v-holder, false);
      }
    }
    $v-holder: append($v-holder, $value);
    $private-breakpoint-context-holder: map-merge($private-breakpoint-context-holder, ($feature: $v-holder)) !global;
  }

  @return true;
}

//////////////////////////////
// Private function to reset context
//////////////////////////////
@mixin private-breakpoint-reset-contexts {
  $private-breakpoint-context-holder: () !global;
  $private-breakpoint-query-count: 0 !global;
}
/* scss-combine:breakpoint/helpers */
//////////////////////////////
// Converts the input value to Base EMs
//////////////////////////////
@function breakpoint-to-base-em($value) {
  $value-unit: unit($value);

  // Will convert relative EMs into root EMs.
  @if breakpoint-get('base font size') and type-of(breakpoint-get('base font size')) == 'number' and $value-unit == 'em' {
    $base-unit: unit(breakpoint-get('base font size'));

    @if $base-unit == 'px' or $base-unit == '%' or $base-unit == 'em' or $base-unit == 'pt' {
      @return base-conversion($value) / base-conversion(breakpoint-get('base font size')) * 1em;
    }
    @else {
      @warn '#{breakpoint-get(\'base font size\')} is not set in valid units for font size!';
      @return false;
    }
  }
  @else {
    @return base-conversion($value);
  }
}

@function base-conversion($value) {
  $unit: unit($value);

  @if $unit == 'px' {
    @return $value / 16px * 1em;
  }
  @else if $unit == '%' {
    @return $value / 100% * 1em;
  }
  @else if $unit == 'em' {
    @return $value;
  }
  @else if $unit == 'pt' {
    @return $value / 12pt * 1em;
  }
  @else {
    @return $value;
//    @warn 'Everything is terrible! What have you done?!';
  }
}

//////////////////////////////
// Returns whether the feature can have a min/max pair
//////////////////////////////
$breakpoint-min-max-features: 'color',
                              'color-index',
                              'aspect-ratio',
                              'device-aspect-ratio',
                              'device-height',
                              'device-width',
                              'height',
                              'monochrome',
                              'resolution',
                              'width';

@function breakpoint-min-max($feature) {
  @each $item in $breakpoint-min-max-features {
    @if $feature == $item {
      @return true;
    }
  }
  @return false;
}

//////////////////////////////
// Returns whether the feature can have a string value
//////////////////////////////
$breakpoint-string-features:  'orientation',
                              'scan',
                              'color',
                              'aspect-ratio',
                              'device-aspect-ratio',
                              'pointer',
                              'luminosity';

@function breakpoint-string-value($feature) {
  @each $item in $breakpoint-string-features {
    @if breakpoint-min-max($item) {
      @if $feature == 'min-#{$item}' or $feature == 'max-#{$item}' {
        @return true;
      }
    }
    @else if $feature == $item {
      @return true;
    }
  }
  @return false;
}

//////////////////////////////
// Returns whether the feature is a media type
//////////////////////////////
$breakpoint-media-types:  'all',
                          'braille',
                          'embossed',
                          'handheld',
                          'print',
                          'projection',
                          'screen',
                          'speech',
                          'tty',
                          'tv';

@function breakpoint-is-media($feature) {
  @each $media in $breakpoint-media-types {
    @if ($feature == $media) or ($feature == 'not #{$media}') or ($feature == 'only #{$media}') {
      @return true;
    }
  }

  @return false;
}

//////////////////////////////
// Returns whether the feature can stand alone
//////////////////////////////
$breakpoint-single-string-features: 'color',
                                    'color-index',
                                    'grid',
                                    'monochrome';

@function breakpoint-single-string($feature) {
  @each $item in $breakpoint-single-string-features {
    @if $feature == $item {
      @return true;
    }
  }
  @return false;
}

//////////////////////////////
// Returns whether the feature
//////////////////////////////
@function breakpoint-is-resolution($feature) {
  $resolutions: 'device-pixel-ratio', 'dpr';

  @if breakpoint-get('transform resolutions') {
    $resolutions: append($resolutions, 'resolution');
  }

  @each $reso in $resolutions {
    @if index($feature, $reso) or index($feature, 'min-#{$reso}') or index($feature, 'max-#{$reso}') {
      @return true;
    }
  }

  @return false;
}

/* scss-combine:breakpoint/parsers */
//////////////////////////////
// Import Parser Pieces
//////////////////////////////
/* scss-combine:parsers/query */
@function breakpoint-parse-query($query) {
  // Parse features out of an individual query
  $feature-holder: ();
  $query-holder: ();
  $length: length($query);

  @if $length == 2 {
    // If we've got a string/number, number/string, check to see if it's a valid string/number pair or two singles
    @if (type-of(nth($query, 1)) == 'string' and type-of(nth($query, 2)) == 'number') or (type-of(nth($query, 1)) == 'number' and type-of(nth($query, 2)) == 'string') {

      $number: '';
      $value: '';

      @if type-of(nth($query, 1)) == 'string' {
        $number: nth($query, 2);
        $value: nth($query, 1);
      }
      @else {
        $number: nth($query, 1);
        $value: nth($query, 2);
      }

      // If the string value can be a single value, check to see if the number passed in is a valid input for said single value. Fortunately, all current single-value options only accept unitless numbers, so this check is easy.
      @if breakpoint-single-string($value) {
        @if unitless($number) {
          $feature-holder: append($value, $number, space);
          $query-holder: append($query-holder, $feature-holder, comma);
          @return $query-holder;
        }
      }
      // If the string is a media type, split the query
      @if breakpoint-is-media($value) {
        $query-holder: append($query-holder, nth($query, 1));
        $query-holder: append($query-holder, nth($query, 2));
        @return $query-holder;
      }
      // If it's not a single feature, we're just going to assume it's a proper string/value pair, and roll with it.
      @else {
        $feature-holder: append($value, $number, space);
        $query-holder: append($query-holder, $feature-holder, comma);
        @return $query-holder;
      }

    }
    // If they're both numbers, we assume it's a double and roll with that
    @else if (type-of(nth($query, 1)) == 'number' and type-of(nth($query, 2)) == 'number') {
      $feature-holder: append(nth($query, 1), nth($query, 2), space);
      $query-holder: append($query-holder, $feature-holder, comma);
      @return $query-holder;
    }
    // If they're both strings and neither are singles, we roll with that.
    @else if (type-of(nth($query, 1)) == 'string' and type-of(nth($query, 2)) == 'string') {
      @if not breakpoint-single-string(nth($query, 1)) and not breakpoint-single-string(nth($query, 2)) {
        $feature-holder: append(nth($query, 1), nth($query, 2), space);
        $query-holder: append($query-holder, $feature-holder, comma);
        @return $query-holder;
      }
    }
  }
  @else if $length == 3 {
    // If we've got three items and none is a list, we check to see
    @if type-of(nth($query, 1)) != 'list' and type-of(nth($query, 2)) != 'list' and type-of(nth($query, 3)) != 'list' {
      // If none of the items are single string values and none of the values are media values, we're good.
      @if (not breakpoint-single-string(nth($query, 1)) and not breakpoint-single-string(nth($query, 2)) and not breakpoint-single-string(nth($query, 3))) and  ((not breakpoint-is-media(nth($query, 1)) and not breakpoint-is-media(nth($query, 2)) and not breakpoint-is-media(nth($query, 3)))) {
        $feature-holder: append(nth($query, 1), nth($query, 2), space);
        $feature-holder: append($feature-holder, nth($query, 3), space);
        $query-holder: append($query-holder, $feature-holder, comma);
        @return $query-holder;
      }
      // let's check to see if the first item is a media type
      @else if breakpoint-is-media(nth($query, 1)) {
        $query-holder: append($query-holder, nth($query, 1));
        $feature-holder: append(nth($query, 2), nth($query, 3), space);
        $query-holder: append($query-holder, $feature-holder);
        @return $query-holder;
      }
    }
  }

  // If it's a single item, or if it's not a special case double or triple, we can simply return the query.
  @return $query;
}

/* scss-combine:parsers/single */
//////////////////////////////
// Import Pieces
//////////////////////////////
/* scss-combine:single/default */
@function breakpoint-parse-default($feature) {
  $default: breakpoint-get('default feature');

  // Set Context
  $context-setter: private-breakpoint-set-context($default, $feature);

  @if (breakpoint-get('to ems') == true) and (type-of($feature) == 'number') {
    @return '#{$default}: #{breakpoint-to-base-em($feature)}';
  }
  @else {
    @return '#{$default}: #{$feature}';
  }
}


@function breakpoint-parse-single($feature, $empty-media, $first) {
  $parsed: '';
  $leader: '';
  // If we're forcing
  @if not ($empty-media) or not ($first) {
    $leader: 'and ';
  }

  // If it's a single feature that can stand alone, we let it
  @if (breakpoint-single-string($feature)) {
    $parsed: $feature;
    // Set Context
    $context-setter: private-breakpoint-set-context($feature, $feature);
  }
  // If it's not a stand alone feature, we pass it off to the default handler.
  @else {
    $parsed: breakpoint-parse-default($feature);
  }

  @return $leader + '(' + $parsed + ')';
}

/* scss-combine:parsers/double */
//////////////////////////////
// Import Pieces
//////////////////////////////
/* scss-combine:double/default-pair */
@function breakpoint-parse-default-pair($first, $second) {
  $default: breakpoint-get('default pair');
  $min: '';
  $max: '';

  // Sort into min and max
  $min: min($first, $second);
  $max: max($first, $second);

  // Set Context
  $context-setter: private-breakpoint-set-context(min-#{$default}, $min);
  $context-setter: private-breakpoint-set-context(max-#{$default}, $max);

  // Make them EMs if need be
  @if (breakpoint-get('to ems') == true) {
    $min: breakpoint-to-base-em($min);
    $max: breakpoint-to-base-em($max);
  }

  @return '(min-#{$default}: #{$min}) and (max-#{$default}: #{$max})';
}

/* scss-combine:double/double-string */
@function breakpoint-parse-double-string($first, $second) {
  $feature: '';
  $value: '';

  // Test to see which is the feature and which is the value
  @if (breakpoint-string-value($first) == true) {
    $feature: $first;
    $value: $second;
  }
  @else if (breakpoint-string-value($second) == true) {
    $feature: $second;
    $value: $first;
  }
  @else {
    @warn "Neither #{$first} nor #{$second} is a valid media query name.";
  }

  // Set Context
  $context-setter: private-breakpoint-set-context($feature, $value);

  @return '(#{$feature}: #{$value})';
}
/* scss-combine:double/default */
@function breakpoint-parse-double-default($first, $second) {
  $feature: '';
  $value: '';

  @if type-of($first) == 'string' {
    $feature: $first;
    $value: $second;
  }
  @else {
    $feature: $second;
    $value: $first;
  }

  // Set Context
  $context-setter: private-breakpoint-set-context($feature, $value);

  @if (breakpoint-get('to ems') == true) {
    $value: breakpoint-to-base-em($value);
  }

  @return '(#{$feature}: #{$value})'
}


@function breakpoint-parse-double($feature, $empty-media, $first) {
  $parsed: '';
  $leader: '';
  // If we're forcing
  @if not ($empty-media) or not ($first) {
    $leader: 'and ';
  }

  $first: nth($feature, 1);
  $second: nth($feature, 2);

  // If we've got two numbers, we know we need to use the default pair because there are no media queries that has a media feature that is a number
  @if type-of($first) == 'number' and type-of($second) == 'number' {
    $parsed: breakpoint-parse-default-pair($first, $second);
  }
  // If they are both strings, we send it through the string parser
  @else if type-of($first) == 'string' and type-of($second) == 'string' {
    $parsed: breakpoint-parse-double-string($first, $second);
  }
  // If it's a string/number pair, we parse it as a normal double
  @else {
    $parsed: breakpoint-parse-double-default($first, $second);
  }

  @return $leader + $parsed;
}

/* scss-combine:parsers/triple */
//////////////////////////////
// Import Pieces
//////////////////////////////
/* scss-combine:triple/default */
@function breakpoint-parse-triple-default($feature, $first, $second) {

  // Sort into min and max
  $min: min($first, $second);
  $max: max($first, $second);

  // Set Context
  $context-setter: private-breakpoint-set-context(min-#{$feature}, $min);
  $context-setter: private-breakpoint-set-context(max-#{$feature}, $max);

  // Make them EMs if need be
  @if (breakpoint-get('to ems') == true) {
    $min: breakpoint-to-base-em($min);
    $max: breakpoint-to-base-em($max);
  }

  @return '(min-#{$feature}: #{$min}) and (max-#{$feature}: #{$max})';
}


@function breakpoint-parse-triple($feature, $empty-media, $first) {
  $parsed: '';
  $leader: '';

  // If we're forcing
  @if not ($empty-media) or not ($first) {
    $leader: 'and ';
  }

  // separate the string features from the value numbers
  $string: null;
  $numbers: null;
  @each $val in $feature {
    @if type-of($val) == string {
      $string: $val;
    }
    @else {
      @if type-of($numbers) == 'null' {
        $numbers: $val;
      }
      @else {
        $numbers: append($numbers, $val);
      }
    }
  }

  $parsed: breakpoint-parse-triple-default($string, nth($numbers, 1), nth($numbers, 2));

  @return $leader + $parsed;

}

/* scss-combine:parsers/resolution */
/* scss-combine:resolution/resolution */
@function breakpoint-make-resolutions($resolution) {
  $length: length($resolution);

  $output: ();

  @if $length == 2 {
    $feature: '';
    $value: '';

    // Find which is number
    @if type-of(nth($resolution, 1)) == 'number' {
      $value: nth($resolution, 1);
    }
    @else {
      $value: nth($resolution, 2);
    }

    // Determine min/max/standard
    @if index($resolution, 'min-resolution') {
      $feature: 'min-';
    }
    @else if index($resolution, 'max-resolution') {
      $feature: 'max-';
    }

    $standard: '(#{$feature}resolution: #{$value})';

    // If we're not dealing with dppx,
    @if unit($value) != 'dppx' {
      $base: 96dpi;
      @if unit($value) == 'dpcm' {
        $base: 243.84dpcm;
      }
      // Write out feature tests
      $webkit: '';
      $moz: '';
      $webkit: '(-webkit-#{$feature}device-pixel-ratio: #{$value / $base})';
      $moz: '(#{$feature}-moz-device-pixel-ratio: #{$value / $base})';
      // Append to output
      $output: append($output, $standard, space);
      $output: append($output, $webkit, space);
      $output: append($output, $moz, space);
    }
    @else {
      $webkit: '';
      $moz: '';
      $webkit: '(-webkit-#{$feature}device-pixel-ratio: #{$value / 1dppx})';
      $moz: '(#{$feature}-moz-device-pixel-ratio: #{$value / 1dppx})';
      $fallback: '(#{$feature}resolution: #{$value / 1dppx * 96dpi})';
      // Append to output
      $output: append($output, $standard, space);
      $output: append($output, $webkit, space);
      $output: append($output, $moz, space);
      $output: append($output, $fallback, space);
    }

  }

  @return $output;
}


@function breakpoint-build-resolution($query-print, $query-resolution, $empty-media, $first) {
  $leader: '';
  // If we're forcing
  @if not ($empty-media) or not ($first) {
    $leader: 'and ';
  }

  @if breakpoint-get('transform resolutions') and $query-resolution {
    $resolutions: breakpoint-make-resolutions($query-resolution);
    $length: length($resolutions);
    $query-holder: '';

    @for $i from 1 through $length {
      $query: '#{$query-print} #{$leader}#{nth($resolutions, $i)}';
      @if $i == 1 {
        $query-holder: $query;
      }
      @else {
        $query-holder: '#{$query-holder}, #{$query}';
      }
    }

    @return $query-holder;
  }
  @else {
    // Return with attached resolution
    @return $query-print;
  }
}


$Memo-Exists: function-exists(memo-get) and function-exists(memo-set);

//////////////////////////////
// Breakpoint Function
//////////////////////////////
@function breakpoint($query, $contexts...) {
  $run: true;
  $return: ();

  // Grab the Memo Output if Memoization can be a thing
  @if $Memo-Exists {
    $return: memo-get(breakpoint, breakpoint $query $contexts);

    @if $return != null {
      $run: false;
    }
  }

  @if not $Memo-Exists or $run {
    // Internal Variables
    $query-string: '';
    $query-fallback: false;
    $return: ();

    // Reserve Global Private Breakpoint Context
    $holder-context: $private-breakpoint-context-holder;
    $holder-query-count: $private-breakpoint-query-count;

    // Reset Global Private Breakpoint Context
    $private-breakpoint-context-holder: () !global;
    $private-breakpoint-query-count: 0 !global;


    // Test to see if it's a comma-separated list
    $or-list: if(list-separator($query) == 'comma', true, false);


    @if ($or-list == false and breakpoint-get('legacy syntax') == false) {
      $query-string: breakpoint-parse($query);
    }
    @else {
      $length: length($query);

      $last: nth($query, $length);
      $query-fallback: breakpoint-no-query($last);

      @if ($query-fallback != false) {
        $length: $length - 1;
      }

      @if (breakpoint-get('legacy syntax') == true) {
        $mq: ();

        @for $i from 1 through $length {
          $mq: append($mq, nth($query, $i), comma);
        }

        $query-string: breakpoint-parse($mq);
      }
      @else {
        $query-string: '';
        @for $i from 1 through $length {
          $query-string: $query-string + if($i == 1, '', ', ') + breakpoint-parse(nth($query, $i));
        }
      }
    }

    $return: ('query': $query-string,
        'fallback': $query-fallback,
        'context holder': $private-breakpoint-context-holder,
        'query count': $private-breakpoint-query-count
    );
    @if length($contexts) > 0 and nth($contexts, 1) != false {
      @if $query-fallback != false {
        $context-setter: private-breakpoint-set-context('no-query', $query-fallback);
      }
      $context-map: ();
      @each $context in $contexts {
        $context-map: map-merge($context-map, ($context: breakpoint-get-context($context)));
      }
      $return: map-merge($return, (context: $context-map));
    }

    // Reset Global Private Breakpoint Context
    $private-breakpoint-context-holder: () !global;
    $private-breakpoint-query-count: 0 !global;

    @if $Memo-Exists {
      $holder: memo-set(breakpoint, breakpoint $query $contexts, $return);
    }
  }

  @return $return;
}

//////////////////////////////
// General Breakpoint Parser
//////////////////////////////
@function breakpoint-parse($query) {
  // Increase number of 'and' queries
  $private-breakpoint-query-count: $private-breakpoint-query-count + 1 !global;

  // Set up Media Type
  $query-print: '';

  $force-all: ((breakpoint-get('force all media type') == true) and (breakpoint-get('default media') == 'all'));
  $empty-media: true;
  @if ($force-all == true) or (breakpoint-get('default media') != 'all') {
    // Force the print of the default media type if (force all is true and default media type is all) or (default media type is not all)
    $query-print: breakpoint-get('default media');
    $empty-media: false;
  }


  $query-resolution: false;

  $query-holder: breakpoint-parse-query($query);



  // Loop over each parsed out query and write it to $query-print
  $first: true;

  @each $feature in $query-holder {
    $length: length($feature);

    // Parse a single feature
    @if ($length == 1) {
      // Feature is currently a list, grab the actual value
      $feature: nth($feature, 1);

      // Media Type must by convention be the first item, so it's safe to flat override $query-print, which right now should only be the default media type
      @if (breakpoint-is-media($feature)) {
        @if ($force-all == true) or ($feature != 'all') {
          // Force the print of the default media type if (force all is true and default media type is all) or (default media type is not all)
          $query-print: $feature;
          $empty-media: false;

          // Set Context
          $context-setter: private-breakpoint-set-context(media, $query-print);
        }
      }
      @else {
        $parsed: breakpoint-parse-single($feature, $empty-media, $first);
        $query-print: '#{$query-print} #{$parsed}';
        $first: false;
      }
    }
    // Parse a double feature
    @else if ($length == 2) {
      @if (breakpoint-is-resolution($feature) != false) {
        $query-resolution: $feature;
      }
      @else {
        $parsed: null;
        // If it's a string/number pair,
        // we check to see if one is a single-string value,
        // then we parse it as a normal double
        $alpha: nth($feature, 1);
        $beta: nth($feature, 2);
        @if breakpoint-single-string($alpha) or breakpoint-single-string($beta) {
          $parsed: breakpoint-parse-single($alpha, $empty-media, $first);
          $query-print: '#{$query-print} #{$parsed}';
          $first: false;
          $parsed: breakpoint-parse-single($beta, $empty-media, $first);
          $query-print: '#{$query-print} #{$parsed}';
        }
        @else {
          $parsed: breakpoint-parse-double($feature, $empty-media, $first);
          $query-print: '#{$query-print} #{$parsed}';
          $first: false;
        }
      }
    }
    // Parse a triple feature
    @else if ($length == 3) {
      $parsed: breakpoint-parse-triple($feature, $empty-media, $first);
      $query-print: '#{$query-print} #{$parsed}';
      $first: false;
    }

  }

  @if ($query-resolution != false) {
    $query-print: breakpoint-build-resolution($query-print, $query-resolution, $empty-media, $first);
  }

  // Loop through each feature that's been detected so far and append 'false' to the the value list to increment their counters
  @each $f, $v in $private-breakpoint-context-holder {
    $v-holder: $v;
    $length: length($v-holder);
    @if length($v-holder) < $private-breakpoint-query-count {
      @for $i from $length to $private-breakpoint-query-count {
        @if $f == 'media' {
          $v-holder: append($v-holder, breakpoint-get('default media'));
        }
        @else {
          $v-holder: append($v-holder, false);
        }
      }
    }
    $private-breakpoint-context-holder: map-merge($private-breakpoint-context-holder, ($f: $v-holder)) !global;
  }

  @return $query-print;
}

/* scss-combine:breakpoint/no-query */
@function breakpoint-no-query($query) {
  @if type-of($query) == 'list' {
    $keyword: nth($query, 1);

    @if type-of($keyword) == 'string' and ($keyword == 'no-query' or $keyword == 'no query' or $keyword == 'fallback') {
      @return nth($query, 2);
    }
    @else {
      @return false;
    }
  }
  @else {
    @return false;
  }
}


/* scss-combine:breakpoint/respond-to */
////////////////////////
// Default the Breakpoints variable
////////////////////////
$breakpoints: () !default;
$BREAKPOINTS: () !default;

////////////////////////
// Respond-to API Mixin
////////////////////////
@mixin respond-to($context, $no-query: false) {
  @if length($breakpoints) > 0 and length($BREAKPOINTS) == 0 {
    @warn "In order to avoid variable namespace collisions, we have updated the way to add breakpoints for respond-to. Please change all instances of `$breakpoints: add-breakpoint()` to `@include add-breakpoint()`. The `add-breakpoint()` function will be deprecated in a future release.";
    $BREAKPOINTS: $breakpoints !global;
    $breakpoints: () !global;
  }

  @if type-of($BREAKPOINTS) != 'map' {
    // Just in case someone writes gibberish to the $breakpoints variable.
    @warn "Your breakpoints aren't a map! `respond-to` expects a map. Please check the value of $BREAKPOINTS variable.";
    @content;
  }
  @else if map-has-key($BREAKPOINTS, $context) {
    @include breakpoint(map-get($BREAKPOINTS, $context), $no-query) {
      @content;
    }
  }
  @else if not map-has-key($BREAKPOINTS, $context) {
    @warn "`#{$context}` isn't a defined breakpoint! Please add it using `$breakpoints: add-breakpoint(`#{$context}`, $value);`";
    @content;
  }
  @else {
    @warn "You haven't created any breakpoints yet! Make some already! `@include add-breakpoint($name, $bkpt)`";
    @content;
  }
}

//////////////////////////////
// Add Breakpoint to Breakpoints
// TODO: Remove function in next release
//////////////////////////////
@function add-breakpoint($name, $bkpt, $overwrite: false) {
  $output: ($name: $bkpt);

  @if length($breakpoints) == 0 {
    @return $output;
  }
  @else {
    @if map-has-key($breakpoints, $name) and $overwrite != true {
      @warn "You already have a breakpoint named `#{$name}`, please choose another breakpoint name, or pass in `$overwrite: true` to overwrite the previous breakpoint.";
      @return $breakpoints;
    }
    @else if not map-has-key($breakpoints, $name) or $overwrite == true {
      @return map-merge($breakpoints, $output);
    }
  }
}

@mixin add-breakpoint($name, $bkpt, $overwrite: false) {
  $output: ($name: $bkpt);

  @if length($BREAKPOINTS) == 0 {
    $BREAKPOINTS: $output !global;
  }
  @else {
    @if map-has-key($BREAKPOINTS, $name) and $overwrite != true {
      @warn "You already have a breakpoint named `#{$name}`, please choose another breakpoint name, or pass in `$overwrite: true` to overwrite the previous breakpoint.";
      $BREAKPOINTS: $BREAKPOINTS !global;
    }
    @else if not map-has-key($BREAKPOINTS, $name) or $overwrite == true {
      $BREAKPOINTS: map-merge($BREAKPOINTS, $output) !global;
    }
  }
}

@function get-breakpoint($name: false) {
  @if $name == false {
    @return $BREAKPOINTS;
  }
  @else {
    @return map-get($BREAKPOINTS, $name);
  }
}


/* scss-combine:breakpoint/legacy-settings */
@mixin legacy-settings-warning {
  $legacyVars: (
    'default-media': 'default media',
    'default-feature': 'default feature',
    'force-media-all': 'force all media type',
    'to-ems': 'to ems',
    'resolutions': 'transform resolutions',
    'no-queries': 'no queries',
    'no-query-fallbacks': 'no query fallbacks',
    'base-font-size': 'base font size',
    'legacy-syntax': 'legacy syntax'
  );

  @each $legacy, $new in $legacyVars {
    @if global-variable-exists('breakpoint-' + $legacy) {
      @warn "In order to avoid variable namspace collisions, we have updated the way to change settings for Breakpoint. Please change all instances of `$breakpoint-#{$legacy}: {{setting}}` to `@include breakpoint-set('#{$new}', {{setting}})`. Variable settings, as well as this warning will be deprecated in a future release."
    }
  };

  //////////////////////////////
  // Hand correct each setting
  //////////////////////////////
  @if global-variable-exists('breakpoint-default-media') and $breakpoint-default-media != breakpoint-get('default media') {
    @include breakpoint-set('default media', $breakpoint-default-media);
  }
  @if global-variable-exists('breakpoint-default-feature') and $breakpoint-default-feature != breakpoint-get('default feature') {
    @include breakpoint-set('default feature', $breakpoint-default-feature);
  }
  @if global-variable-exists('breakpoint-force-media-all') and $breakpoint-force-media-all != breakpoint-get('force all media type') {
    @include breakpoint-set('force all media type', $breakpoint-force-media-all);
  }
  @if global-variable-exists('breakpoint-to-ems') and $breakpoint-to-ems != breakpoint-get('to ems') {
    @include breakpoint-set('to ems', $breakpoint-to-ems);
  }
  @if global-variable-exists('breakpoint-resolutions') and $breakpoint-resolutions != breakpoint-get('transform resolutions') {
    @include breakpoint-set('transform resolutions', $breakpoint-resolutions);
  }
  @if global-variable-exists('breakpoint-no-queries') and $breakpoint-no-queries != breakpoint-get('no queries') {
    @include breakpoint-set('no queries', $breakpoint-no-queries);
  }
  @if global-variable-exists('breakpoint-no-query-fallbacks') and $breakpoint-no-query-fallbacks != breakpoint-get('no query fallbacks') {
    @include breakpoint-set('no query fallbacks', $breakpoint-no-query-fallbacks);
  }
  @if global-variable-exists('breakpoint-base-font-size') and $breakpoint-base-font-size != breakpoint-get('base font size') {
    @include breakpoint-set('base font size', $breakpoint-base-font-size);
  }
  @if global-variable-exists('breakpoint-legacy-syntax') and $breakpoint-legacy-syntax != breakpoint-get('legacy syntax') {
    @include breakpoint-set('legacy syntax', $breakpoint-legacy-syntax);
  }
}

//////////////////////////////
// Breakpoint Mixin
//////////////////////////////

@mixin breakpoint($query, $no-query: false) {
  @include legacy-settings-warning;

  // Reset contexts
  @include private-breakpoint-reset-contexts();

  $breakpoint: breakpoint($query, false);

  $query-string: map-get($breakpoint, 'query');
  $query-fallback: map-get($breakpoint, 'fallback');

  $private-breakpoint-context-holder: map-get($breakpoint, 'context holder') !global;
  $private-breakpoint-query-count: map-get($breakpoint, 'query count') !global;

  // Allow for an as-needed override or usage of no query fallback.
  @if $no-query != false {
    $query-fallback: $no-query;
  }

  @if $query-fallback != false {
    $context-setter: private-breakpoint-set-context('no-query', $query-fallback);
  }

  // Print Out Query String
  @if not breakpoint-get('no queries') {
    @media #{$query-string} {
      @content;
    }
  }

  @if breakpoint-get('no query fallbacks') != false or breakpoint-get('no queries') == true {

    $type: type-of(breakpoint-get('no query fallbacks'));
    $print: false;

    @if ($type == 'bool') {
      $print: true;
    }
    @else if ($type == 'string') {
      @if $query-fallback == breakpoint-get('no query fallbacks') {
        $print: true;
      }
    }
    @else if ($type == 'list') {
      @each $wrapper in breakpoint-get('no query fallbacks') {
        @if $query-fallback == $wrapper {
          $print: true;
        }
      }
    }

    // Write Fallback
    @if ($query-fallback != false) and ($print == true) {
      $type-fallback: type-of($query-fallback);

      @if ($type-fallback != 'bool') {
        #{$query-fallback} & {
          @content;
        }
      }
      @else {
        @content;
      }
    }
  }

  @include private-breakpoint-reset-contexts();
}


@mixin mq($query, $no-query: false) {
  @include breakpoint($query, $no-query) {
    @content;
  }
}



/* scss-combine:abstractions/rem-calc */
// ================================================================ */
//  Function to convert px to rem
// from: https://github.com/zurb/foundation/blob/master/scss/foundation/_functions.scss

$rem-base: 16px !default;

@function strip-unit($num) {
  @return $num / ($num * 0 + 1);
}

@function convert-to-rem($value, $base-value: $rem-base) {
  //scss-lint:disable ZeroUnit - unit needed for accurate conditional evaluation
  $value: strip-unit($value) / strip-unit($base-value) * 1rem;
  @if ($value == 0rem) { $value: 0; } // Turn 0rem into 0
  @return $value;
}

@function rem-calc($values, $base-value: $rem-base) {
  $max: length($values);

  @if $max == 1 {
    @return convert-to-rem(nth($values, 1), $base-value);
  }

  $rem-values: ();
  @for $i from 1 through $max {
    $rem-values: append($rem-values, convert-to-rem(nth($values, $i), $base-value));
  }

  @return $rem-values;
}


// ---------------------------------------------------------------- */
// Settings - All the sass variables you might want to change, mapping to config

/* scss-combine:vars/colors */
//scss-lint:disable NameFormat - stencil functions

// ================================================================ */
// Set Colors - Always used the same across themes.

$black: #000;
$white: #fff;

// ---------------------------------------------------------------- */
// Colors used by status messages
// REVIEW: These may need to be changed or removed, depending on where used

$color-problem: #db1b1b;
$color-warning: #feae00;
$color-confirm: #3ca126;

// TODO: Theme settings? Either map to existing or create a setting
$color-banners-marketing: #eff5f6;
$color-banners-discounts: #7c8986;

// ---------------------------------------------------------------- */
// Colors mapped from settings in config

$color-primary: stencilColor("color_primary"); // Sidebar
$color-secondary: stencilColor("color_secondary"); // Buttons
$color-headings: stencilColor("color_headings");
$color-carousel-text: stencilColor("color_carousel_text");
$color-carousel-screen: stencilColor("color_carousel_screen");
$opacity-carousel-screen: stencilNumber("opacity_carousel_screen", "");

$color-dark: $black;
$color-light: $white;

// ---------------------------------------------------------------- */
// Color Dirivitives: Calculated values based on theme colors

$color-text: #565a5e;
$color-text-lighter: #6c6d6f;
$color-text-darker: $black;
$color-text-meta: #8a8a8a;
$color-sale-price: #db1b1b;

$color-borders: #e3e3e3; // applied to all borders / lines


// ---------------------------------------------------------------- */


// ---------------------------------------------------------------- */
// Color function to output one color over another depending on contrast

@function text-contrast($n) {
  $color-brightness: round((red($n) * 299) + (green($n) * 587) + (blue($n) * 114) / 1000);
  $light-color: round((red(#ffffff) * 299) + (green(#ffffff) * 587) + (blue(#ffffff) * 114) / 1000);

  @if abs($color-brightness) < ($light-color/2){
    @return $color-light;
  }

  @else {
    @return $color-dark;
  }
}

// ---------------------------------------------------------------- */

// Sidebar / mobile sticky navbar
$color-sidebar: stencilColor("color_sidebar");
$color-sidebar-text: text-contrast(stencilColor("color_sidebar"));

$color-footer-bg: stencilColor("color_footer_background");
$color-footer-text: stencilColor("color_footer_text");

/* scss-combine:vars/misc */
$ease-out-quad: cubic-bezier(0.250,0.460,0.450,0.940);

// Input heights
$height-input: rem-calc(50);
$height-input-short: rem-calc(40);

// Component heights
$height-list-utils: rem-calc(80);

// image cropping
$grid-item-image-crop: stencilString('image_crop_grid');

/* scss-combine:vars/component-breakpoints */

// Breakpoint where navigation becomes an offcanvas slide
$nav-slide-bp: 960px;
$nav-slide-maxwidth: max-width ($nav-slide-bp - 1px);

// Breakpoint for carousel slides
$carousel-bp: 750px;
$carousel-bp-maxwidth: max-width ($carousel-bp - 1px);

// Breakpoint for things like vw font sizing and grid breakdowns
$desktop-bp: 1200px;
$desktop-bp-maxwidth: max-width ($desktop-bp - 1px);

// Product grid breakpoints
$col-2-bp: 500px;
$col-3-bp: 1000px;
$col-4-bp: 1280px;
$col-6-bp: 1800px;

// ---------------------------------------------------------------- */
// Because of the page sidebar (that gets hidden below a certain point)
// the content area shifts between being too wide or too narrow for some
// of the middle breakpoints. The following mixins help cover those gaps.

// Cart Page Breakpoints Used Below:

@mixin bp-narrower-page {
  // Breakpoint is: Up to 700, and between ~800-1100
  @include breakpoint((max-width 699px, $nav-slide-bp 1099px, screen)) { @content };
}

@mixin bp-wider-page {
  // Breakpoint: ~700-800 and over 1100
  @include breakpoint((700px ($nav-slide-bp - 1), 1100px), screen) { @content };
}

// ---------------------------------------------------------------- */

/* scss-combine:vars/typography */
// Typography mappings from the theme settings.
$font-primary: stencilFontFamily('primary-font');
$font-secondary: stencilFontFamily('secondary-font');

// Return either the primary/secondary/tertiary font, based on settings
@function font-mapper($settings-value) {
  $value: stencilNumber($settings-value, '');

  @if $value == 2 {
    @return $font-secondary;
  } @else {
    @return $font-primary;
  }
}


// ================================================================ */
// Abstractions - Mixins, helpers, extends...

/* scss-combine:abstractions/color-functions */
// ================================================================ */
//  Helpers for working with color variables

@function shade($color, $percent) {
  //scss-lint:disable ColorVariable - need to declare hex to shade properly
  @return mix(#000, $color, $percent);
}

@function contrast($color, $percent: 6%, $threshold: 50) {
  @if (lightness($color) > $threshold) {
    @return shade($color, $percent);
  } @else {
    @return lighten($color, $percent);
  }
}

/* scss-combine:abstractions/text-inputs */
// https://github.com/thoughtbot/bourbon/blob/master/app/assets/stylesheets/addons/_text-inputs.scss

@function assign-inputs($inputs, $pseudo: null) {
  $list: ();

  @each $input in $inputs {
    $input: unquote($input);
    $input: if($pseudo, $input + ":" + $pseudo, $input);
    $list: append($list, $input, comma);
  }

  @return $list;
}


$text-inputs-list: 'input[type="color"]',
                  'input[type="date"]',
                  'input[type="datetime"]',
                  'input[type="datetime-local"]',
                  'input[type="email"]',
                  'input[type="month"]',
                  'input[type="number"]',
                  'input[type="password"]',
                  'input[type="search"]',
                  'input[type="tel"]',
                  'input[type="text"]',
                  'input[type="time"]',
                  'input[type="url"]',
                  'input[type="week"]',
                  'input:not([type])',
                  'textarea';

$all-text-inputs:        assign-inputs($text-inputs-list);
$all-text-inputs-active: assign-inputs($text-inputs-list, active);
$all-text-inputs-focus:  assign-inputs($text-inputs-list, focus);
$all-text-inputs-hover:  assign-inputs($text-inputs-list, hover);

/* scss-combine:abstractions/svg-encode-function */
// ================================================================ */
//  Function to create an optimized svg url
// from: http://codepen.io/jakob-e/pen/doMoML

@function svg-url($svg){
    //
    //  Chunk up string in order to avoid 
    //  "stack level too deep" error
    //
    $encoded:'';
    $slice: 2000;
    $index: 0;
    $loops: ceil(str-length($svg)/$slice);
    @for $i from 1 through $loops {
        $chunk: str-slice($svg, $index, $index + $slice - 1);
        //
        //   Encode (may need a few extra replacements)
        //
        $chunk: str-replace($chunk,'"','\'');
        $chunk: str-replace($chunk,'<','%3C');
        $chunk: str-replace($chunk,'>','%3E');
        $chunk: str-replace($chunk,'&','%26');
        $chunk: str-replace($chunk,'#','%23');
        $encoded: #{$encoded}#{$chunk};
        $index: $index + $slice;
    }
    @return url("data:image/svg+xml;charset=utf8,#{$encoded}");
}

//  Helper function to replace characters in a string
@function str-replace($string, $search, $replace: '') {
    $index: str-index($string, $search);
    @if $index {
        @return str-slice($string, 1, $index - 1) + $replace +
            str-replace(str-slice($string, $index +
            str-length($search)), $search, $replace);
    }
    @return $string;
}

/* scss-combine:abstractions/typographic-styles */
// ================================================================ */
// Style Extends - direct mappings taken from the main design
// these styles are applied in the sketch file and extended throughout theme

// scss-lint:disable Comment --> These are meant to be included in source for identifying styles

%font-section-title {
  color: $color-headings;
  margin-bottom: 2em;
  font-size: rem-calc(24);
  text-align: center;
}

// ---------------------------------------------------------------- */
// Rich text editor styles

%header-text-treatment {
  font-weight: 400;
  color: $color-headings;
}

%font-h1 {
  @extend %header-text-treatment;
  font-family: font-mapper("font_h1-h3");
  @if (font-mapper("font_h1-h3") == "Lato") { font-weight: 300; }

  // Custom font size
  font-size: if(font-mapper("font_h1-h3") == "Karla", rem-calc(72), rem-calc(59));
}

%font-h2 {
  @extend %header-text-treatment;
  font-family: font-mapper("font_h1-h3");
  @if (font-mapper("font_h1-h3") == "Lato") { font-weight: 300; }

  // Custom font size
  font-size: if(font-mapper("font_h1-h3") == "Karla", rem-calc(46), rem-calc(41));
}

%font-h3 {
  @extend %header-text-treatment;
  font-family: font-mapper("font_h1-h3");
  font-size: rem-calc(24);

  @if (font-mapper("font_h1-h3") == "PT Serif") { font-weight: 700; }
  @if (font-mapper("font_h1-h3") == "Lato") { font-weight: 300; }

  // Custom font size
  @if (font-mapper("font_h1-h3") == "Karla") { font-size: rem-calc(34); }
  @elseif (font-mapper("font_h1-h3") == "PT Serif") { font-size: rem-calc(24); }
  @else { font-size: rem-calc(28); }
}

%font-h4 {
  @extend %header-text-treatment;
  font-family: font-mapper("font_h4-h6");

  @if (font-mapper("font_h4-h6") == "Oswald") { text-transform: uppercase; }
  @if (font-mapper("font_h4-h6") == "Lato") { font-weight: 300; }

  // Custom font size
  font-size: if(font-mapper("font_h4-h6") == "Oswald", rem-calc(28), rem-calc(21));
}

%font-h5 {
  @extend %header-text-treatment;
  font-family: font-mapper("font_h4-h6");
  font-size: rem-calc(18);

  @if (font-mapper("font_h4-h6") == "Oswald") { text-transform: uppercase; }
  @if (font-mapper("font_h4-h6") == "Lato") { font-weight: 300; }
}

%font-h6 {
  @extend %header-text-treatment;
  font-family: font-mapper("font_h4-h6");
  // Custom font size
  font-size: if(font-mapper("font_h4-h6") == "Oswald", rem-calc(13), rem-calc(14));
  text-transform: uppercase;

  @if (font-mapper("font_h4-h6") == "PT Serif") { opacity: 0.4; }
  @if (font-mapper("font_h4-h6") == "Lato") { font-weight: 300; }
}

// ---------------------------------------------------------------- */
// Text applications / treatment placehoders (to be mapped)

%block-title {
  // Used for blocks in the footer and...
  font-size: rem-calc(18);
}

%label-text-treatment {
  font-family: $font-secondary;
  font-size: rem-calc(13);
  font-weight: 700;
  color: $color-dark;
  text-transform: uppercase;
}

// As displayed on the blog page
%large-page-title {
  @extend %font-h1;
  margin-top: 1em;
  margin-bottom: 1em;
  text-align: center;
}

%large-page-description {
  margin-top: 1em;
  margin-bottom: 4.5em; // 72px or ~1rem for H1's
  text-align: center;
}

%blog-post-title {
  margin-bottom: rem-calc(24);
  font-size: rem-calc(28);
  font-weight: 400;
  text-align: center;
}

// ---------------------------------------------------------------- */
// Carousel / Hero styles

%carousel-title {
  @extend %font-h1;
  margin-bottom: 0.35em;
  color: $color-carousel-text;

  @include breakpoint($desktop-bp-maxwidth) {
    font-size: rem-calc(36);
  }

  @include breakpoint($desktop-bp) { font-size: 3vw; }
  @include breakpoint($desktop-bp + 100px) { font-size: 4vw; }
  @include breakpoint($desktop-bp + 200px) { font-size: 5vw; }
}

%carousel-text {
  font-family: $font-secondary;
  font-size: rem-calc(13);
  text-transform: uppercase;

  @include breakpoint($carousel-bp) {
    font-size: rem-calc(15);
  }

  @include breakpoint($desktop-bp) {
    font-size: 1.1vw;
  }
}

// ---------------------------------------------------------------- */
// Links

%font-link {
  font-size: rem-calc(16);
  text-decoration: underline;

  &:hover {
    text-decoration: none;
  }
}

// ---------------------------------------------------------------- */
// Miscellaneous

%inputs-text-treatment {
  font-family: $font-secondary;
  font-weight: 300;
}

%timestamp-text-treatment {
  font-family: $font-secondary;
  font-size: rem-calc(14);
  text-transform: uppercase;
}

%sidebar-text-treatment {
  font-family: $font-secondary;
  font-size: rem-calc(14);
  line-height: rem-calc(41);
  @if ($font-secondary == "Lato") {
    font-weight: 300;
  }
}

%product-badge-text-treatment {
  font-family: $font-secondary;
  font-size: rem-calc(10);
  font-weight: bold;
  letter-spacing: 0;
}

%banner-text-treatment {
  font-family: $font-secondary;
  font-size: rem-calc(14);
}

%alert-text-treatment {
  font-family: $font-secondary;
  font-size: rem-calc(15);
}

/* scss-combine:abstractions/extends */

// Beat that clearfix: http://cssmojo.com/latest_new_clearfix_so_far/
%clearfix:after {
  display: table;
  clear: both;
  content: "";
}

%background-cover {
  background: {
    position: center;
    repeat: no-repeat;
    size: cover;
  }
}

%ghost-center {
  display: inline-block;
  width: 0;
  height: 100%;
  margin-right: -0.33333rem;
  vertical-align: middle;
  content: " ";
}

%visually-hidden {
  // scss-lint:disable ImportantRule
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  overflow: hidden;
  clip: rect(1px, 1px, 1px, 1px);
  border: 0 !important;
}

/* scss-combine:abstractions/mixins */
// ================================================================ */
// Table layout
@mixin layout-group($gutter: 0, $gutter_vertical: null) {
  @if $gutter_vertical == null {
    $gutter_vertical: $gutter;
  }

  display: table;

  @if $gutter == 0 {
    width: 100%;
  } @else {
    width: calc(100% + #{$gutter * 2});
    margin-left: $gutter * -1;
    border-spacing: $gutter $gutter_vertical;
  }
}

@mixin layout-group-item($align: middle) {
  display: table-cell;
  vertical-align: $align;
}

// ================================================================ */
// Transparent overlay - used in carousel and hero images

@mixin overlay-screen($color: #000, $opacity: 0.2) {
  position: absolute;
  display: block;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background-color: $color;
  opacity: $opacity;
  content: "";
}

// ================================================================ */
// Maintain Aspect Ratio
// example: @include maintain-ratio(16 9);

@mixin maintain-ratio($ratio: 1 1) {
  @if length($ratio) < 2 or length($ratio) > 2 {
    @warn "$ratio must be a list with two values.";
  }

  $width: 100%;
  $height: percentage(nth($ratio, 2) / nth($ratio, 1));

  width: $width;
  padding-bottom: $height;
}


// ---------------------------------------------------------------- */
// Base - Core page stuff, styling elements, typography

/* scss-combine:base/base */

html {
  font-size: 100%; // 16px base, but respects OS defaults too
}

// Border-Box FTW
*,
*:before,
*:after {
  box-sizing: border-box;
}

body { background-color: $white; }

// ---------------------------------------------------------------- */
// Hiding and Showing Content
// Snippets borrowed from a11yproject:
// http://a11yproject.com/posts/how-to-hide-content/

.visually-hidden,
.sr-only {
  @extend %visually-hidden;
}

body:hover .visually-hidden a,
body:hover .visually-hidden input,
body:hover .visually-hidden button {
  // scss-lint:disable ImportantRule
  display: none !important;
}

.hidden {
  display: none;
  visibility: hidden;
}

.visible { display: block; }

// ---------------------------------------------------------------- */
// svg

svg { fill: currentColor; }

/* scss-combine:base/layout */
// ================================================================ */
// General Page Layout - styles related to sidebar layout

@include bkpt-set('to ems', true);
$nav-sidebar-width: rem-calc(340);

$susy: (
  columns: 12,
  gutters: 0,
  debug: (
    image: hide,
    output: background,
  ),
);
// Default grid padding
$pad-vertical: rem-calc(30);
$pad-horizontal: rem-calc(30);

// The height of the navigation bar (and amount to push down content)
$nav-bar-height: rem-calc(75);

// ---------------------------------------------------------------- */
// General layout helpers

.contained {
  padding-right: rem-calc(20);
  padding-left: rem-calc(20);

  @include breakpoint($col-2-bp) {
    padding-right: $pad-horizontal;
    padding-left: $pad-horizontal;
  }
}

.contained-narrow {
  max-width: rem-calc(720);
  margin-right: auto;
  margin-left: auto;
}

// ---------------------------------------------------------------- */
// Mobile first / Default styles:
// Required to keep sidebar / nav-bar positioned on ios
html {
  overflow-x: hidden;
  overflow-y: scroll;

  //prevent scroll stutter on mobile
  @include breakpoint(max-width ($nav-slide-bp - 1px)) {
    overflow: visible;
  }
}

// Hide content nav-bar, show header navbar
.nav-bar {
  position: relative;
  display: block;
  width: 100%;
  header & { display: none; }
}

.page-wrap {
  position: relative;
  left: 0;
}

.sidebar-nav {
  position: fixed;
  top: 0;
  bottom: 0;
  left: -$nav-sidebar-width;
  width: $nav-sidebar-width;
  max-width: 100%;
}

// ---------------------------------------------------------------- */
// Only applied to smallest widths

@include breakpoint(max-width ($nav-slide-bp - 1px)) {

  .nav-drawer-open {
    .page-wrap {
      position: relative;
      left: $nav-sidebar-width;
    }

    .sidebar-nav {
      left: 0;
    }
  }

  .nav-bar {
    position: fixed;
    top: 0;
    right: 0;
    left: 0;
  }

  .page-wrap,
  .sidebar-nav { padding-top: $nav-bar-height; }

}

// ---------------------------------------------------------------- */
// Wider screens: nav bar fills side of page, header is part of page content

@include breakpoint($nav-slide-bp) {

  // Hide header nav-bar, show content navbar
  .nav-bar {
    display: none;
    header & { display: block; }
  }

  .sidebar-nav { left: 0; }
  .page-wrap { margin-left: $nav-sidebar-width; }
  .drawer-item { display: none; }
  .drawer-nav { display: none; }
  .footer-scripts { margin-left: $nav-sidebar-width; }
}

.main-content {
  @extend %clearfix;
  padding-bottom: $pad-vertical * 4;
}

/* scss-combine:base/typography */


// ================================================================ */
// Headings - Using HTML5 markup with H1's all over the place

// Reset all headings to a standard size / margin
h1,
h2,
h3,
h4,
h5,
h6 {
  margin-top: 0;
  margin-bottom: 0;
  font-size: 1em;
  line-height: 1.25;

  a { color: inherit; }
}

// ---------------------------------------------------------------- */
// Rich text editor / content areas

.user-content {
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin-bottom: 0.5em;
    line-height: 1.25;

    &:first-child { margin-top: 0; }
    &:last-child { margin-bottom: 0; }
  }

  h1 { @extend %font-h1; }
  h2 { @extend %font-h2; }
  h3 { @extend %font-h3; }
  h4 { @extend %font-h4; }
  h5 { @extend %font-h5; }
  h6 { @extend %font-h6; }

  ul,
  ol {
    padding-left: rem-calc(16);
    list-style-position: outside;

    li { padding-left: rem-calc(16); }
  }

  a {
    text-decoration: underline;

    &:hover { text-decoration: none; }
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  p,
  blockquote,
  ul,
  ol,
  img,
  .fluid-width-video-wrapper {
    &:not(:last-child), { margin-bottom: rem-calc(46); }
  }

  blockquote {
    margin-left: 0;
    line-height: rem-calc(39);
    padding-left: rem-calc(32);
    font-size: rem-calc(21);
    color: $color-text-darker;
    border-left: 1px solid $color-borders;
  }
}

// ================================================================ */
// General Body Text

body {
  font-family: $font-primary;
  font-size: rem-calc(16);
  line-height: 1.79;
  color: $color-text;
}

// REVIEW: This relies on content always being within padded regions
// (Which is usually true, but lets see if this causes any problems.)
p:first-child { margin-top: 0; }
p:last-child { margin-bottom: 0; }

// ================================================================ */
// Specific Font Classes

.section-title {
  @extend %font-section-title;
}

.page-title {
  @extend %large-page-title;
}

.page-description {
  @extend %large-page-description;
}

/* scss-combine:base/links */

a {
  color: $color-primary;
  text-decoration: none;
}

.primary-link {
  @extend %font-link;
}

// ---------------------------------------------------------------- */
// Many links have a custom underline (rather than simple text-decoration style)

%link-underlined {
  color: $color-text;
  padding-bottom: 0.25rem;
  border-bottom: 1px solid;
  transition: border-bottom-color 200ms ease;
  border-bottom-color: $color-borders;
}

%underline-hover {
  @extend %link-underlined;
  border-bottom-color: transparent;

  &:hover { border-bottom-color: $color-borders; }
}

/* scss-combine:base/media */
// Content within the page, media, images, embeds.

img,
iframe {
  max-width: 100%;
  height: auto;
}

figure {
  margin: 0;
  text-align: center;
}

.user-content img {
  margin-bottom: rem-calc(9);
}

// ---------------------------------------------------------------- */
// Image ratios

.replaced-image {
  display: block;
  overflow: hidden;
  background-position: center center;
  background-repeat: no-repeat;
  background-size: cover;

  .product-item-image & {
    background-size: $grid-item-image-crop;
  }

  img,
  &.lazy-image img {
    opacity: 0;   // Image is replaced
    vertical-align: middle;  // Avoid baseline / descender padding
  }
}

.lazy-image {
  transition: opacity 500ms ease-in-out;
  opacity: 0;

  &.lazy-loaded {
    opacity: 1;
  }
}

[class*="ratio-"]:not(.ratio-any) {
  img {
    @extend %visually-hidden;
  }
}

.ratio-any {
  img {
    width: 100%;
  }
}

.ratio-16-9 {
  @include maintain-ratio(16 9);
}

.ratio-4-3 {
  @include maintain-ratio(4 3);
}

.ratio-1-1 {
  @include maintain-ratio(1 1);
}

.ratio-3-4 {
  @include maintain-ratio(3 4);
}

.ratio-gold {
  padding-bottom: 61.8%
}

.ratio-2-3 {
  @include maintain-ratio(2 3);
}

.ratio-1-2 {
  @include maintain-ratio(1 2);
}

/* scss-combine:base/navigation */
// ================================================================ */
// List items within nav elements don't need nested padding

nav {
  ul { padding: 0; }
  li { list-style-type: none; }
}

/* scss-combine:base/forms */
// ================================================================ */
// Form Components not specific to any one section or form.

.form-field { margin: 1.333em 0; }

.form-field-title {
  @extend %label-text-treatment;
  display: inline-block;
  margin: 0 1em 0.66em 0;
}

.form-input {
  display: block;

  &::placeholder {
    @extend %font-placeholder;
    opacity: 0.75;
  }

  &:focus {
    outline: none;
  }
}

.form-label { display: block; }

.form-radio,
.form-checkbox {
  display: inline-block;
  vertical-align: middle;

  + .form-label-text {
    display: inline-block;
    margin-bottom: rem-calc(10);
    margin-left: rem-calc(10);
  }
}

.form-label-text {
  @extend %label-text-treatment;
}

// ---------------------------------------------------------------- */

fieldset {
  padding: 0;
  margin: 0;
  border: 0;
}

textarea {
  width: 100%;
  resize: vertical;
}

#{$all-text-inputs} {
  @extend %inputs-text-treatment;
  width: 100%;
  padding: 1em;
  border: {
    color: $color-borders;
    style: solid;
    width: 1px;
  }

  &.form-input { height: $height-input; }
  &.form-input:focus { border-color: $color-dark; }
}

textarea,
textarea.form-input { height: auto; }

.form-field-radio .form-label,
.form-field-checkbox .form-label {
  display: block;
  margin-top: 0.66em;
  margin-bottom: 0.66em;
}

input[type='file'] {
  @extend %inputs-text-treatment;
  min-height: $height-input;
  padding: 1.33em 0.66em;
  border: 1px solid $color-borders;
}

// Remove spinner (up/down arrows) on number inputs (using inc/dec buttons instead)
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  margin: 0;
  appearance: none;
}

input[type=number] {
  -moz-appearance: textfield;
}

input[type=file] {
  max-width: 100%;
}

// ---------------------------------------------------------------- */
// Wrapper around inline inputs for filling *remaining* width

.input-wrap-outer {
  .button { float: right; }
}

.input-wrap {
  overflow: hidden;

  .form-input {
    width: 100%;
    border-right: 0;
  }
}

// ================================================================ */
// Form errors

.form-error {
  color: $color-problem;
  border: 1px solid $color-problem;

  &::placeholder { color: lighten($color-problem,30%); }
}

.form-error-message {
  color: $color-problem;
}

.required-text {
  display: none;
  color: $color-problem;

  .form-required & {
    display: inline-block;
  }
}

// ================================================================ */
// Custom Checkboxes and Radios
// class needs to be applied to an input sibling (same level, after element)

// Style all radios / checkboxes using custom graphics
.form-field-swatch,
.form-field-checkbox,
.form-field-radio {
  input { @extend .visually-hidden; }
  input:focus ~ .form-label-text { outline: 0; }
  input:focus ~ .form-label-text::before {
    border: 1px solid $color-dark;
  }
}


.form-field-checkbox,
.form-field-radio {
  .form-label-text {
    margin-left: 2.333em;
  }
}

// ---------------------------------------------------------------- */
// Custom checkbox - as placeholder classes for easy extending

%custom-checkbox {
  $box-size: 1.333rem;
  display: inline-block;
  width: $box-size;
  height: $box-size;
  line-height: 1em;
  vertical-align: middle;
  background: {
    color: $white;
    position: center center;
    repeat: no-repeat;
  }
  border: 1px solid $color-borders;
  content: "";
}

%custom-checkbox-checked {
  background-image: svg-url('<svg xmlns="http://www.w3.org/2000/svg" width="12" height="9" viewBox="0 0 12 9"><path fill="#{$color-text}" fill-rule="evenodd" d="M3.77 8.34l.5.5.5-.52 6.45-6.84c.27-.28.25-.72-.03-1-.3-.25-.75-.24-1 .04L4.25 6.86 1.5 4.1c-.28-.28-.72-.27-1 0-.27.27-.27.72 0 1l3.27 3.24z"/></svg>');
}

.form-label-text {
  .form-field-checkbox &::before {
    @extend %custom-checkbox;
    margin-right: 1em;
    margin-left: -2.333em;
  }

  .form-field-checkbox :checked ~ &::before {
    @extend %custom-checkbox-checked;
  }
}

// ---------------------------------------------------------------- */
// Custom Radio Buttons

.form-label-text {
  line-height: rem-calc(18);

  .form-field-radio &::before {
    vertical-align: middle;
    display: inline-block;
    $box-size: rem-calc(18);
    width: $box-size;
    height: $box-size;
    margin-right: 1em;
    margin-left: -2.333em;
    line-height: 1em;
    background: {
      color: $white;
      position: center center;
      repeat: no-repeat;
    }
    border: 1px solid $color-borders;
    border-radius: 50%;
    content: "";
  }

  .form-field-radio :checked ~ &::before {
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E %3Crect width='8' height='8' x='6' y='6' fill='%238E969E' fill-rule='evenodd' rx='100' transform='translate(-6 -6)'/%3E %3C/svg%3E");
  }
}

// ================================================================ */
// Select Elements (wrapper) - no js necessary

%form-select {
  @extend %inputs-text-treatment;
  width: calc(100% - 3.25em);
  height: $height-input;
  padding: 0 2.25em 0 1em;
  margin: -1px;
  background-color: transparent;
  border-color: transparent;
  border-radius: 0;
  box-sizing: content-box;
  appearance: none;

  // For IE 10+
  &::-ms-expand { display: none; }

  &:focus {
    border: 1px solid $color-dark;
    outline: 0;
  }
}

.form-select-wrapper {
  display: block;
  max-width: 100%;
  line-height: 1.6;
  cursor: pointer;
  background: {
    // Down arrow on the right side.
    image: svg-url('<svg xmlns="http://www.w3.org/2000/svg" width="8" height="5" viewBox="0 0 8 5"><path fill-rule="evenodd" fill="#{$color-dark}" d="M4.26 4.96l3.6-3.58c.2-.2.2-.52 0-.7-.2-.2-.52-.2-.7 0l-2.9 2.87-2.9-2.9c-.2-.2-.52-.2-.7 0-.2.2-.2.5 0 .7l3.6 3.6z"/></svg>');
    position: right 1em center;
    repeat: no-repeat;
  }
  border: 1px solid $color-borders;

  select {
    @extend %form-select;
  }

  // For Shipping Calculator - select can be swapped with text field
  input[type='text'] {
    position: relative;
    width: calc(100% + 1.5em);
    margin: -1em 0 0 -1em;
    border: 0;
  }
}

// ---------------------------------------------------------------- */
// Validation Messages

.form-inline-message {
  display: block;
  margin: 1em 1em 0.66em;
  color: $color-problem;
}

.form-field-invalid .form-input { border-color: $color-problem; }

// ---------------------------------------------------------------- */

// /* scss-combine:base/tables */
// ================================================================ */
// REVIEW: From BC-Baseline - may not all be appropriate.
// TODO: Remove commented var values, replace with appropriate values

table {
  margin: 1em 0;
  background: transparent;
  border: 1px solid;
  border-collapse: separate;
  border-top: 0;
  border-color: inherit;
  // color: $body-color;
  // border-color: $border-color;

  &.table-clean {
    border: 0;
    border-radius: 0;
  }
}

td,
th {
  @extend %heading-text-treatment;
  padding: 20px;
  // color: $input-color;
  // background: $input-background-color;
  border-top: 1px solid;
  border-top-color: inherit;

  .table-clean & {
    border: 0;
  }
}

th {
  font-weight: bold;
}

td {
  border-left: 1px solid;
  border-left-color: inherit;

  &:first-child {
    border-left: 0;
  }
}

// ---------------------------------------------------------------- */

/* scss-combine:base/buttons */
button {
  background: none;
  border: 0;
}

.button {
  display: inline-block;
  height: $height-input;
  padding: 0 2.6em;
  margin-bottom: 1.333em;
  font-family: $font-secondary;
  font-size: rem-calc(14);
  font-weight: 700;
  line-height: $height-input;
  letter-spacing: 0.12em;
  color: $white;
  text-align: center;
  text-transform: uppercase;
  white-space: nowrap;
  background-color: $color-primary;
  border: 2px solid $color-primary;
  transition: all 0.1s ease-out;

  &:hover:not(:disabled) {
    color: $color-primary;
    text-decoration: none;
    background-color: transparent;
  }

  &.button-inverted {
    color: $color-primary;
    background-color: transparent;

    &:hover:not(:disabled) {
      color: $white;
      background-color: $color-primary;
    }
  }

  &:disabled,
  &.button-disabled,
  &.button-disabled:hover {
    cursor: not-allowed;
    opacity: 0.5;
  }

  & + & {
    margin-left: rem-calc(8);
  }

  svg { vertical-align: middle; }
}

.button-secondary {
  background-color: $color-secondary;
  border-color: $color-secondary;

  &:hover:not(:disabled) {
    color: $color-secondary;
  }

  &.button-inverted {
    color: $color-secondary;
    background-color: transparent;

    &:hover {
      background-color: $color-secondary;
    }
  }
}

.button-square {
  width: $height-input;
  padding: 0;
}


// ---------------------------------------------------------------- */
// Vendor
/* scss-combine:vendor/baguette-box */
/*!
 * baguetteBox.js
 * @author  feimosi
 * @version 1.4.1
 * @url https://github.com/feimosi/baguetteBox.js
 */

// scss-lint:disable QualifyingElement, IdSelector, SelectorFormat

%arrow-button {
  top: calc(50% - 30px);
  width: 44px;
  height: 60px;
}

#baguetteBox-overlay {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 1000000;
  display: none;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background-color: rgba($color-dark, 0.95);
  opacity: 0;
  transition: opacity 0.5s ease;

  &.visible { opacity: 1; }

  .full-image {
    position: relative;
    display: inline-block;
    width: 100%;
    height: 100%;
    text-align: center;

    figure {
      display: inline;
      height: 100%; // Opera 12 image stretching fix
      margin: 0;
    }

    img {
      display: inline-block;
      width: auto;
      height: auto;
      max-width: 100%;
      max-height: 90%;
      vertical-align: middle;
    }

    figcaption {
      position: absolute;
      bottom: 0;
      display: block;
      width: 100%;
      padding-bottom: 16px;
      font-weight: 300;
      line-height: 1.8;
      text-align: center;
      white-space: normal;
    }

    &:before {
      display: inline-block;
      width: 1px;
      height: 50%;
      margin-right: -1px;
      content: "";
    }
  }
}

#baguetteBox-slider {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  white-space: nowrap;
  transition: left 0.4s ease, transform 0.4s ease;

  &.bounce-from-right {
    animation: bounceFromRight 0.4s ease-out;
  }

  &.bounce-from-left {
    animation: bounceFromLeft 0.4s ease-out;
  }
}

@keyframes bounceFromRight{
  0% { margin-left: 0; }
  50% { margin-left: -30px; }
  100% { margin-left: 0; }
}

@keyframes bounceFromLeft{
  0% { margin-left: 0; }
  50% { margin-left: 30px; }
  100% { margin-left: 0; }
}

.baguetteBox-button {
  position: absolute;
  padding: 0;
  margin: 0;
  font-size: 1.6em;
  cursor: pointer;
  background-color: transparent;
  border: 0;
  border-radius: 15%;
  outline: none;
  transition: background-color 0.4s ease;

  &#next-button {
    @extend %arrow-button;
    right: 2%;
  }

  &#previous-button {
    @extend %arrow-button;
    left: 2%;
  }

  &#close-button {
    top: 20px;
    right: 20px;
    width: 30px;
    height: 30px;
  }

  // Firefox fix
  svg {
    position: absolute;
    top: 0;
    left: 0;

    g {
      stroke: contrast($color-dark, 100%);
    }
  }
}

// http://tobiasahlin.com/spinkit/
.spinner:not(.button) {
  position: absolute;
  top: 50%;
  left: 50%;
  display: inline-block;
  width: 40px;
  height: 40px;
  margin-top: -20px;
  margin-left: -20px;
}

.double-bounce1,
.double-bounce2 {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  opacity: 0.6;
  animation: bounce 2s infinite ease-in-out;
}

.double-bounce2 { animation-delay: -1s; }

@keyframes bounce {
  0%, 100% { transform: scale(0); }

  50% { transform: scale(1); }
}


// ---------------------------------------------------------------- */
// Components - At a modular level - styles for individual 'things'

/* scss-combine:core/swatch */
// none swatch value for non-required swatches
.form-field-swatch {
  .swatch-none {
    .swatch {
      overflow: hidden;
      border: 1px solid rgba(#000, 0.15);

      svg {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
    }
  }
}

/* scss-combine:components/svg */

// Hide the sprite sheet included at top of page
.svg-sprite { display: none; }

/* scss-combine:components/nav-bar */

$nav-bar-min-height: 55px;
$nav-bar-max-height: 100px;

$nav-bar-height: rem-calc(75);

// Stacking Elements.
.main-nav-button { z-index: 2; } // On top of svg.page-cover

// ---------------------------------------------------------------- */
// Navigation Bar - Displayed across top of page

.nav-bar {
  @extend %sidebar-text-treatment;
  height: $nav-bar-height;
  color: $color-dark; // TODO: Color applied from theme values.
  text-align: center;
  border-bottom: 1px solid $color-borders;

  a:not(.button) { color: currentColor; }

  .page-default &,
  .page-brand &,
  .page-category & {
    border-bottom: 0;
  }

  .drawer-wrapper & {
    z-index: 4; // On top of fixed sidebar
    color: $color-sidebar-text;
    background-color: $color-sidebar;
  }
}

// Theme setting for all caps in the nav-bar
.navbar-allcaps { text-transform: uppercase; }

.nav-bar-inner {
  display: table;
  width: 100%;
  height: 100%;

  > * {
    display: table-cell;
    vertical-align: middle;
  }
}

.nav-bar-wrapper {
  display: table-cell;
  text-align: center;
  vertical-align: middle;
}


// ---------------------------------------------------------------- */
// Nav bar content (aside from logo) is positioned in a header-component block

.header-components {
  width: 10%;

  // Space each of the components
  > *:not(:last-child) { margin-right: rem-calc(26); }

  // Component boxes in the sticky nav-bar (when no page sidebar)
  &:first-of-type {
    padding-left: $pad-horizontal;
    text-align: left;
  }

  &:last-of-type {
    padding-right: $pad-horizontal;
    text-align: right;
  }

  // Component boxes in the page-content (with page sidebar)
  .main-header &:first-of-type { width: 40%; }
  .main-header &:last-of-type { width: 60%; }

}

// ---------------------------------------------------------------- */
// Hamburger to X - Transition between the two states when nav expanded

.main-nav-button {
  $nav-button-size: 18px;
  $nav-button-line-width: 2px;

  display: inline-block;
  width: $nav-button-size;
  height: $nav-button-size;
  padding: 1em;
  margin-left: -1em;
  vertical-align: middle;
  cursor: pointer;
  outline: 0;
  opacity: 1;
  box-sizing: content-box;
  transition: opacity 200ms ease;

  &:hover { opacity: 0.5; }

  span {
    $x-offset: ($nav-button-size - $nav-button-line-width) / 2;
    position: relative;
    top: 0;
    display: block;
    width: 100%;
    height: $nav-button-line-width;
    margin-bottom: ($nav-button-size - (3 * $nav-button-line-width)) / 2;
    background-color: currentColor;
    border-radius: 2px;
    transition: all 0.2s linear;

    // .inverted & { background-color: $color-light; }

    .nav-drawer-open & {
      // scss-lint:disable NestingDepth -- Using & selector should be fine.
      &:nth-child(even) { opacity: 0; }

      &:nth-child(1) {
        top: $x-offset;
        transform: rotate(45deg) scale(1.4);
      }

      &:nth-child(3) {
        top: -$x-offset;
        transform: rotate(-45deg) scale(1.4);
      }
    }
  }
}

// ---------------------------------------------------------------- */

/* scss-combine:components/nav-multi-level */
.nav-multi-container {
  position: relative;
  overflow: hidden;
}

.nav-multi-breadcrumb {
  font-size: rem-calc(11);
  visibility: hidden;
  display: inline-block;

  .is-active & {
    visibility: visible;
  }

  &:last-child {
    pointer-events: none;
  }

  &:not(:first-child) {
    &:before {
      margin: rem-calc(0 4 0 1);
      content: "/";
    }
  }

  &:not(:last-child) {
    cursor: pointer;
  }
}

.nav-multi-panel {
  width: 100%;
  transition: transform 0.5s ease;

  &.is-active {
    position: relative;
  }

  &.is-right,
  &.is-left {
    position: absolute;
    top: 0;
  }

  &.is-right {
    transform: translateX(100%);
  }

  &.is-left {
    transform: translateX(-100%);
  }

  &.force-state {
    transition: none;
  }
}

/* scss-combine:components/logo-branding */
// ================================================================ */
// Text Logo

.logo-text {
  // TODO: Actually style this, this is wip just to make it prominent
  // Probably include a custom font-setting, etc etc
  font-size: 2em;
  font-weight: bold;
}

// ---------------------------------------------------------------- */
// Image Logos

.sidebar-nav-wrapper {
  .store-logo { margin-bottom: rem-calc(50); }

  .logo-image {
    max-width: 100%;
    max-height: 25vh;
  }

  &.align-top {
    .store-logo { margin-bottom: rem-calc(10); }
  }
}

.nav-bar {
  .store-logo {
    padding-top: rem-calc(5);
    padding-bottom: rem-calc(5);

    @include breakpoint(max-width 500px) {
      padding-right: 30px;
      padding-left: 30px;
    }
  }

  .logo-image {
    a,
    img {
      max-height: rem-calc(65);
      vertical-align: middle;
    }
  }
}

@include breakpoint($nav-slide-maxwidth) {
  .sidebar-nav .store-logo { display: none; }
}

/* scss-combine:components/page-sidebar */

// Nav Drawer Local Variables
$sidebar-nav-transition: all 0.2s $ease-out-quad;

// ---------------------------------------------------------------- */
// Drawer / Page Transitions

// Stops scrolling horizontally when nav drawer is translated
body {
  overflow-x: hidden;
  &.sidebar-nav-open { overflow: hidden; }
}

.sidebar-nav,
.page-wrap { transition: $sidebar-nav-transition; }

// Theme setting for all caps
.sidebar-allcaps { text-transform: uppercase; }

// On mobile: dimmer covers the page contents and triggers the menu closed
.page-cover {
  position: absolute;
  z-index: 1;
  display: block;
  width: 100%;
  height: 100%;
  pointer-events: none;
  background-color: $color-sidebar-text;
  opacity: 0;
  transition: opacity 200ms $ease-out-quad;

  .nav-drawer-open & {
    display: block;
    opacity: 0.7;
  }
}


// ---------------------------------------------------------------- */
// Drawer Styling

.sidebar-nav {
  @extend %sidebar-text-treatment;
  padding-right: 1rem;
  padding-left: 1rem;
  overflow: hidden;
  color: $color-sidebar-text;
  text-align: center;
  background-color: $color-sidebar;

  a { color: $color-sidebar-text; }

  .dropdown {
    margin-bottom: $pad-vertical * 0.5;
    font-weight: 300;
  }

  .search-wrapper {
    color: $color-text;
  }

}

// ---------------------------------------------------------------- */
// Positioning and layout

@include breakpoint(max-width ($nav-slide-bp - 1px)) {
  .sidebar-nav-wrapper {
    max-height: 100%;
    padding-top: $pad-vertical;
    padding-bottom: $pad-vertical;
    overflow-x: hidden;
    overflow-y: auto;
  }
}

// Navigation is vertically centered at bigger breakpoints
@include breakpoint($nav-slide-bp) {
  .sidebar-nav-wrapper {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    display: flex;
    height: 100%;
    max-height: 100%; // Firefox

    &.align-top {
      display: block;
    }
  }

  .drawer-nav {
    display: inline-block; // Firefox
    align-self: center;
    width: 100%;
    max-height: 100%;
    overflow-x: hidden;
    overflow-y: auto;
    vertical-align: middle;
  }
}

.drawer-item {
  padding-top: 1.3333em;
  padding-bottom: 1.3333em;
  margin: 0;

  .align-top & { padding-top: rem-calc(75); }

  &:first-child { padding-top: 0; }
  &:last-child { padding-bottom: 0; }
}

.drawer-extras {
  padding-bottom: 0;

  &:last-child { padding-top: 0; }
  a { display: block; }
}

/* scss-combine:components/page-footer */

.footer-block-title {
  // TODO: Extend typographic style here.
}

.main-footer {
  padding-top: $pad-vertical * 2;
  padding-bottom: $pad-vertical * 2;
  line-height: 2;
  color: $color-footer-text;
  background-color: $color-footer-bg;

  a {
    color: inherit;

    &:hover {
      color: $color-text-darker;
    }
  }
}

.footer-follow-links {
  // TODO: Style a list of links.
}

.payment-gateways {
  text-align: center;

  @include breakpoint(500px) { text-align: right; }

  svg {
    margin-bottom: 1em;
    vertical-align: middle;

    &:not(:last-of-type) { margin-right: 1em; }
  }
}


.footer-block-title {
  @extend %block-title;
  margin-bottom: $pad-vertical;
  color: $color-dark;
}

.footer-finale,
.main-footer nav .block-content { opacity: 0.7; }

// ---------------------------------------------------------------- */
// Footer Layout

.main-footer,
.footer-content { @extend %clearfix; }

@include breakpoint(max-width 499px) {
  .footer-block { margin-bottom: $pad-vertical * 1; }
  .footer-block { width: 100%; }
}

@include breakpoint(500px) {
  .footer-sitemap,
  .footer-follow-links {
    float: left;
    padding-right: 5%;
  }

  .footer-mailinglist { float: left; }
}

@include breakpoint(500px 1099px) {
  .footer-block { margin-bottom: $pad-vertical * 1.5; }

  .footer-sitemap,
  .footer-follow-links { width: 50%; }

  .footer-mailinglist { width: 85%; }
}

@include breakpoint(1100px) {
  .footer-block { margin-bottom: $pad-vertical * 2.5; }

  .footer-sitemap,
  .footer-follow-links { width: 25%; }

  .footer-mailinglist {
    width: 50%;
    max-width: 480px;
  }
}
// ---------------------------------------------------------------- */
// Finale - Payment Logos and footer messages

.footer-finale {
  opacity: 0.4;

  p { margin: 0; }

  .footer-messages {
    font-size: rem-calc(14);
  }
}

.footer-follow-links .social-media-link { display: block; }

@include breakpoint(max-width 1199px) {
  .footer-messages { margin-bottom: $pad-vertical; }
  .payment-gateways { text-align: left; }
}

@include breakpoint(1200px) {
  .footer-finale {
    display: table;
    width: 100%;
  }

  .payment-gateways,
  .footer-messages {
    display: table-cell;
    vertical-align: middle;
  }

  .footer-messages { padding-right: 1em; }
}

/* scss-combine:components/search */
// ================================================================ */
// Global search box that displays in the page drawer
// scss-lint:disable IdSelector -- ID necessary for label targetting

$mini-search-height: rem-calc(50); // Set a uniform height for the form

#mini-search-toggle {
  // Checkbox, visually hidden but toggled by the label below
  display: none;
  .sidebar & { display: none; }

  ~ .search-wrapper {
    position: absolute;
    top: 0;
    right: 0;
    z-index: 1;
    width: rem-calc(18);
    height: $mini-search-height;
    overflow: hidden;
    line-height: $mini-search-height;
    text-align: left;
    transition: width 200ms $ease-out-quad;
  }

  &:checked ~ .search-wrapper {
    width: rem-calc(280);
  }
}

.mini-search-toggle-label {
  // Label that toggles the search box visible or not
  position: absolute;
  top: 0;
  right: 0;
  display: inline-block;
  width: 20px;
  height: $mini-search-height;
  color: transparent;
  transition: color 200ms $ease-out-quad;
  cursor: pointer;

  #mini-search-toggle:checked ~ .search-wrapper & {
    color: $color-text;

    &:hover { color: $color-text-darker; }
  }
}

.mini-search {
  position: relative;
  top: rem-calc(-6);
  display: inline-block;
  width: rem-calc(18);
  height: rem-calc(40);
  vertical-align: middle;

  svg {
    position: relative;
    top: rem-calc(2);
  }

  .nav-bar & .form-input {
    $input-offset: rem-calc(15); // space before the input
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: $input-offset;
    display: none;
    float: left;
    width: calc(100% - #{$input-offset});
    height: $mini-search-height;
    padding-right: rem-calc(28);
    border: 0;
  }

  .button {
    display: none;
  }

  input:focus ~ .button {
    width: rem-calc(50);
  }
}

#mini-search-toggle:checked ~ .search-wrapper .form-input { display: block; }


// ---------------------------------------------------------------- */
// Variant displayed in sidebar, always expanded styling

.sidebar-nav .mini-search {
  position: relative;
  width: 100%;

  .form-input {
    width: 100%;
    height: $mini-search-height;
    padding-right: rem-calc(40);
    font-size: 1rem;
    background-color: $white;
  }

  svg {
    position: absolute;
    top: rem-calc(18);
    right: rem-calc(15);
  }
}

// ---------------------------------------------------------------- */
// Full Page Search - displayed on product lists with no results

.product-list .search {
  .form-input {
    float: left;
    width: calc(100% - #{rem-calc(150)});
  }

  .button {
    width: rem-calc(150);
  }
}

.search-result-title {
  @extend %block-title;
  margin-top: $pad-vertical;
}

.content-result-type {
  @extend %timestamp-text-treatment;
  font-style: italic;
}

.search-results-brands { margin-top: $pad-vertical; }

.search-tabs-nav {
  @extend %sidebar-text-treatment;
  width: 100%;
  margin-bottom: $pad-vertical;
  border-bottom: 1px solid $color-borders;

  @include breakpoint(max-width $nav-slide-bp) { text-align: center; }

  .search-tab-toggle {
    padding: rem-calc(8) rem-calc(20);
    margin-right: 3px;
    margin-bottom: -1px;
    text-transform: uppercase;
    background-color: $color-footer-bg;
    border: {
      color: $color-borders;
      style: solid;
      width: 1px;
    }
    outline: 0;

    &.active {
      background-color: $white;
      border-bottom-color: $white;
    }
  }
}

// ---------------------------------------------------------------- */
// Quick Search

.quick-search {
  @extend .mini-cart-preview;
  display: none;
  text-align: left;

  &.animating,
  &.visible {
    display: block;
  }

  &.animating-in {
    transform: translateY(-10px);
    transition: transform 0.3s ease;
  }

  &.animating-out {
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  &.visible {
    transform: translateY(0);
    opacity: 1;
  }

  .quick-search-list { padding: 0 2rem; }

  .header-components & {
    position: absolute;
    right: rem-calc(30);

    &.visible { top: 100%; }
  }

  .spinner {
    position: static;
    display: block;
    margin: 2rem auto;
    transform: translate(0, 0);
  }
}

.quick-search-inner {
  max-height: calc(100vh - 150px);
  overflow-y: auto;
}

.quick-search-results {
  @extend %font-h5;
  padding: 2rem;
  margin: 0;
}

.quick-search-item {
  @extend %mini-cart-row;
  display: table;
  width: 100%;
}

.quick-search-list li:last-child .quick-search-item { border: 0; }

.quick-search-item-image,
.quick-search-item-info {
  display: table-cell;
  vertical-align: middle;
}

.quick-search-item-info { padding-left: 1em; }

.quick-search-item-image {
  width: rem-calc(100);

  img { display: block; }
}

.quick-search-item-title {
  display: block;
  font-size: rem-calc(16);
  line-height: 1.25;
  color: $color-text-darker;
  text-align: left;
}

/* scss-combine:components/currency-selector */
.currency-selector {
  position: relative;
  z-index: 0;
  display: inline-block;
  opacity: 1;
  transition: opacity 0.2s $ease-out-quad;

  select {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    z-index: 1;
    padding: 10px;
    cursor: pointer;
    opacity: 0;
    appearance: none;
  }

  &::after {
    display: inline-block;
    width: 0;
    height: 0;
    vertical-align: middle;
    border: {
      top: 3px solid currentColor;
      right: 3px solid transparent;
      left: 3px solid transparent;
    }
    content: "";
  }

  .sidebar-nav & {}

  .no-js & { opacity: 0; } // Hide component when JS not available.
}

/* scss-combine:components/mini-cart */
// ================================================================ */
// Cart link and count that displays in the header of the page

// The icon that is displayed in the nav-bar
.mini-cart-link {
  color: currentColor;

  > span {
    position: absolute;
    bottom: rem-calc(17);
    left: rem-calc(15);
    line-height: 0;
  }

  svg { margin-bottom: rem-calc(-3); }
}

.header-mini-cart {
  position: relative;
}

// ================================================================ */
// Bubble showing the number of items in the cart
// Courtesy of: http://codepen.io/bhardy/pen/bEOROB

.cart-count {
  position: relative;
  z-index: 1;
  display: inline-block;
  font-family: Helvetica, Arial, sans-serif; // basic stack for number only
  font-size: rem-calc(10);
  line-height: 0;
  color: $color-sidebar-text;
  vertical-align: top;

  .main-header & {
    color: $color-text;
  }

  // display number
  &::before {
    position: absolute;
    top: 50%;
    left: 50%;
    content: attr(data-cart-preview-count);
    transform: translate(-50%, -50%);
  }

  // stretch horizontally
  &::after {
    display: inline-block;
    min-width: rem-calc(10);
    padding: 5px;
    color: transparent;
    content: attr(data-cart-preview-count);
  }

  // stretch vertically
  .cart-count-circle {
    position: absolute;
    top: 50%;
    z-index: -1;
    display: inline-block;
    width: 100%;
    padding-bottom: 100%;
    transform: translateY(-50%);
  }

  // draw circle
  .cart-count-circle::after {
    position: absolute;
    top: 0;
    left: 0;
    display: block;
    width: 100%;
    height: 100%;
    color: transparent;
    background-color: $color-sidebar;
    border: 1px solid $color-sidebar-text;
    border-radius: 50%;
    content: "";

    .main-header & {
      background-color: $color-light;
      border-color: $color-text;
    }
  }
}

// ================================================================ */
// The cart preview that expands when you click on the mini-cart icon.

.header-mini-cart { position: relative; }

.mini-cart-preview {
  position: absolute;
  top: calc(100% + #{rem-calc(20)});
  right: rem-calc(-58);
  z-index: 1;
  width: rem-calc(430);
  color: $color-dark;
  text-transform: initial;
  background-color: $white;
  border: 1px solid $color-borders;

  ul {
    padding: 0;
    margin: 0;
    list-style-type: none;
  }

  &::before {
    $arrow-size: rem-calc(12);
    position: absolute;
    top: - ($arrow-size / 2);
    right: rem-calc(64);
    display: block;
    width: $arrow-size;
    height: $arrow-size;
    background-color: $white;
    border-top: 1px solid $color-borders;
    border-left: 1px solid $color-borders;
    content: "";
    transform: rotate(45deg);
  }
}

// ---------------------------------------------------------------- */
// Revealer: Show hide transitions

// scss-lint:disable MergeableSelector -- This section keeps the transitions
// all in one place together.

.mini-cart-preview {
  top: 0;
  z-index: 99;
  display: none;

  &.animating {
    display: block;
    opacity: 0;
    transition: all 200ms ease;
  }

  &.visible {
    top: calc(100% + #{rem-calc(20)});
    display: block;
    opacity: 1;
  }

  .loading-wrapper { background-color: transparent; }
  .loading-wrapper ~ .mini-cart-content { opacity: 0.2; }
}

// scss-lint:enable MergeableSelector
// ---------------------------------------------------------------- */
// Mini-cart Line Items

%mini-cart-row {
  padding-bottom: rem-calc(30);
  margin-bottom: rem-calc(30);
  border-bottom: 1px solid $color-borders;
}

.mini-cart-content {
  max-height: calc(100vh - 150px);
  padding: rem-calc(32);
  overflow: auto;

  .mini-cart-item {
    @extend %clearfix;
    @extend %mini-cart-row;
    display: table;
    width: 100%;
  }

  .mini-cart-item-image,
  .mini-cart-item-name {
    display: table-cell;
    vertical-align: middle;
  }

  .mini-cart-item-name {
    padding-left: 1em;
    font-size: rem-calc(16);
    line-height: 1.4375; // ~23px
    color: $color-text-darker;
    text-align: left;

    a { color: inherit; }
  }

  .mini-cart-item-qty-label {
    display: block;
    margin-bottom: 1em;
    font-family: $font-secondary;
    font-size: rem-calc(13);
    text-transform: uppercase;
  }

  .mini-cart-item-remove {
    width: rem-calc(25);
    text-align: right;
    text-transform: uppercase;
  }

  .mini-cart-item-image {
    width: rem-calc(100);
    text-align: left;
    img { max-height: 100%; }
  }

  .mini-cart-item-price { color: $color-text-lighter; }
  .cart-preview-empty { text-align: center; }
}

// ---------------------------------------------------------------- */
// Mini-cart Footer

.mini-cart-footer {
  @extend %clearfix;

  .mini-cart-footer-buttons {
    overflow: hidden;
  }

  .mini-cart-footer-total {
    @extend %mini-cart-row;
    font-size: rem-calc(21);
  }

  .mini-cart-view-cart-link,
  .mini-cart-checkout-button {
    display: inline-block;
    width: 50%;
  }

  .mini-cart-view-cart-link {
    height: $height-input;
    line-height: $height-input;
    text-align: center;

    a { @extend %link-underlined; }
  }

  .mini-cart-checkout-button { float: right; }
  .button { margin-bottom: 0; }

  .mini-cart-footer-total-label,
  .mini-cart-footer-total-value { display: inline-block; }
}

/* scss-combine:components/carousel */
// ================================================================ */
// Carousel - Displayed on the homepage with a few links to features.


// ---------------------------------------------------------------- */
.no-js .carousel-item:not(:first-of-type) { display: none; }

// General styles for carousel container
.carousel {
  position: relative;
  margin-right: $pad-horizontal;
  margin-left: $pad-horizontal;
  overflow: hidden;

  @include breakpoint(max-width $nav-slide-bp - 1) {
    margin-right: 0;
    margin-left: 0;
  }

  .flickity-viewport {
    transition: height 0.2s ease-out;
  }
}

.carousel-item-wrapper {
  position: relative;
  width: 100%;
}

.carousel-item-image {
  background-position: 50%;
  background-size: cover;
  opacity: 0;
  transition: opacity 0.3s ease-out;

  &.flickity-bg-lazyloaded {
    opacity: 1;
  }

  img {
    opacity: 0;
  }

  &:not(.ratio-any) {
    img {
      @extend %visually-hidden;
    }
  }
}

// Heading and text shown within a slide item
.carousel-item-info {
  position: absolute;
  top: 50%;
  display: block;
  width: 100%;
  padding: 0 8%;
  overflow: hidden;
  color: $color-carousel-text;
  transform: translateY(-50%);

  @include breakpoint($carousel-bp) {
    padding-top: 2vw;
    padding-bottom: 2vw;
  }

  .carousel-cta {
    height: auto;
    margin-top: rem-calc(5);
    padding: 0.85em 1.8em 0.75em;
    line-height: 1;

    .carousel-minimal-buttons & {
      color: $color-carousel-text;
      background-color: transparent;
      border-color: $color-carousel-text;
    }

    @include breakpoint(1200px) {
      font-size: 1.1vw;
    }

    &:hover {
      color: $color-carousel-text;
      background-color: transparent;
      border-color: $color-carousel-text;

      .carousel-minimal-buttons & {
        color: $color-carousel-text;
        background-color: transparent;
        border-color: $color-carousel-text;
      }
    }
  }
}

// ---------------------------------------------------------------- */
// Text displayed within the carousel info box.

.carousel-item-title {
  @extend %carousel-title;
}

.carousel-item-text {
  @extend %carousel-text;
}

// ---------------------------------------------------------------- */
// Carousel / Flickity Styling

// Previous / next buttons
.carousel-navigation-item {
  $carousel-nav-size: rem-calc(36);
  position: absolute;
  top: 50%;
  display: block;
  width: $carousel-nav-size;
  height: $carousel-nav-size;
  margin-top: -($carousel-nav-size / 2);
  line-height: $carousel-nav-size;
  text-align: center;
  border-radius: 50%;
  transition: all 200ms $ease-out-quad;

  &:before,
  &:after {
    position: relative;
    top: rem-calc(-1);
    display: inline-block;
    vertical-align: middle;
    content: "";
  }

  &:hover {
    cursor: pointer;
    opacity: 1;
    color: $color-secondary;
    transform: scale(1.2);

    .no-touchevents & {
      box-shadow: 0 0 0 rem-calc(2) $color-carousel-text;
    }
  }

  &.next {
    right: 0;

    @include breakpoint($carousel-bp) {
      right: rem-calc(40);
    }

    &:before {
      width: rem-calc(18);
      height: rem-calc(2);
      background-color: $color-carousel-text;
    }

    &:after {
      display: inline-block;
      border-top: rem-calc(6) solid transparent;
      border-bottom: rem-calc(6) solid transparent;
      border-left: rem-calc(6) solid $color-carousel-text;
    }
  }

  &.previous {
    left: 0;

    @include breakpoint($carousel-bp) {
      left: rem-calc(40);
    }

    &:before {
      display: inline-block;
      border-top: rem-calc(6) solid transparent;
      border-right: rem-calc(6) solid $color-carousel-text;
      border-bottom: rem-calc(6) solid transparent;
    }

    &:after {
      width: rem-calc(18);
      height: rem-calc(2);
      background-color: $color-carousel-text;
    }
  }
}

/* scss-combine:components/collections-cta */
// ================================================================ */
// Collections Call to Action - Displayed on the homepage below the collections grids.

.collections-cta {
  @extend %background-cover;
  position: relative;
  padding-bottom: 56.26%;
  margin-right: $pad-horizontal;
  margin-bottom: $pad-vertical;
  margin-left: $pad-horizontal;

  @include breakpoint(max-width $nav-slide-bp - 1) {
    margin-right: 0;
    margin-left: 0;
  }

  &:before {
    @include overlay-screen($color-carousel-screen, $opacity-carousel-screen);
  }
}

.collections-cta-info {
  @extend .carousel-item-info;
  margin-top: 0;
  height: 100%;


  &:before {
    @extend %ghost-center;
  }

  .inner {
    vertical-align: middle;
    display: inline-block;
    max-width: 95%;

    @include breakpoint($desktop-bp) {
      max-width: 40%;
    }
  }

  .button {
    @extend .carousel-cta;
    margin-top: 1em;
  }
}

.collections-cta-title { @extend %carousel-title; }

.collections-cta-text {
  @extend %carousel-text;
  font-family: $font-primary;
  text-transform: none;
}

/* scss-combine:components/main-navigation */
.main-menu {
  .nav-menu {
    margin: 0;

    ul ul {
      margin-top: rem-calc(-4);
      margin-bottom: rem-calc(10);
      text-transform: none;
    }
  }

  // Wrapper around the children revealed on click.
  .dropdown {
    display: none; // Hidden, to be slideToggled
    font-size: rem-calc(12);
    line-height: 2rem;

    .no-js & { display: block; } // But don't hide nav from folks without js
    a:not(.active) { opacity: 0.6; }
  }

  .active {
    font-weight: bold;
    opacity: 1;
  }
}


/* scss-combine:components/banners */

// Content displayed across the page, typically an offer / promotion
.banner {
  @extend %banner-text-treatment;
  padding: 1em;
  text-align: center;
}

// Banners displayed below title or bottom of page
.banner-marketing {
  $neg-margin: rem-calc(20);
  width: calc(100% + #{$neg-margin * 2});
  margin: 0 #{- $neg-margin};

  background-color: $color-banners-marketing;

  @include breakpoint($col-2-bp) {
    // Adjust for different container padding
    $neg-margin: $pad-horizontal;
    width: calc(100% + #{$neg-margin * 2});
    margin: 0 #{- $neg-margin};
  }

  @include breakpoint($nav-slide-bp) {
    width: 100%;
    margin: 1em 0;

    &:last-child {
      margin-bottom: $pad-horizontal;
    }
  }
}

// Banners that display shipping discounts at very top of page
.banner-discounts {
  background-color: $color-banners-discounts;
  color: $color-light;
  text-align: center;
}

/* scss-combine:components/modals */
// ================================================================ */
// Modals - Content displayed in a "window" above the page.

// All modals include these elements (nested in one another)
// .modal-overlay -- Covers the page, a layer below the modal itself
// .modal-wrapper -- Sibling to the overlay, primarily used for positioning.
// .modal         -- The modal window itself, apply color / padding here
// .modal-content -- Content placed here within the modal

// ---------------------------------------------------------------- */

.modal-overlay {
  background-color: $color-dark;
  color: $color-light;
  opacity: 0;
  height: 100%;
  width: 100%;
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 5;
  transition: all 0.2s ease;

  &.visible { opacity: 0.8; }
}

.modal-wrapper {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 1000;
  display: none;
  overflow: hidden;
  -webkit-overflow-scrolling: touch;
  outline: 0;
  opacity: 0;

  &.animating,
  &.visible {
    display: block;
    transition: opacity 0.2s ease;
  }

  &.animating-in { transition-delay: 0.1s; }

  &.visible {
    overflow-x: hidden;
    overflow-y: auto;
    opacity: 1;
  }
}

.modal {
  background-color: $white;
  margin: 0 auto;
  width: 39em; // 585px
  max-width: 95%;
  max-height: 95%;
  padding: $pad-vertical;
  overflow: auto;

  @include breakpoint(max-width 550px) { padding: 3em; }
  @include breakpoint(max-width 400px) { padding: 2em; }
}

.modal-content {
  position: relative;

  .modal-close {
    position: absolute;
    top: rem-calc(-16);
    right: rem-calc(-16);
    z-index: 1;
    color: $color-text-meta;
    text-decoration: none;
  }

  .icon-x {
    width: rem-calc(20);
    height: rem-calc(20);
  }
}

.modal-body { @extend %clearfix; }

/* scss-combine:components/reviews */
.rating-stars {
  display: block;
  margin: rem-calc(8 0 10);
  color: $color-primary;
}

.review-title {
  @extend %font-h4;
}

// Submission Modal - hidden until "visible" class applied
.review-modal-container {
  display: none;
}

// Star Reviews on products and in lists.
.star {
  width: 14px;
  height: 14px;
}

.button-more-reviews {
  display: block;
  margin: 0 auto;
}
// ---------------------------------------------------------------- */
// Five Stars in a Row / Rating Widget

.input-stars {
  position: relative;
  display: inline-block;
  padding: 0;
  font-size: 14px;
  border: 0;

  label { margin-right: 0.333em; }

  .star,
  .star-full {
    // Default star state.
    float: right;
    width: 14px;
    height: 14px;
    line-height: 1;
    cursor: pointer;

    &:hover,
    &:hover ~ .star {
      // When selecting stars.
      color: $color-primary;
      opacity: 1;
    }
  }

  .star-full { display: none; }

  > input:checked {
    ~ label {
      // Stars that are already selected
      .star { display: none; }
      .star-full { display: inline-block; }
    }
  }
}

// ---------------------------------------------------------------- */
// Extra star related messages

.stars-form-field {
  position: relative;
  display: inline-block;

  .form-field-control {
    display: block;
    padding-top: 0.666em;
  }

  // Position the label data itself, but hidden
  label::after {
    position: absolute;
    right: -8em;
    display: none;
    width: 7em;
    color: $color-text;
    text-transform: uppercase;
    content: attr(title);
  }

  // Show only the currently checked message.
  input:checked + label::after {
    display: block;
  }

  // But if still hovering over stars, hide the message and...
  &:hover input:checked + label::after { display: none; }

  // Still display just the label for the star we're hovering.
  &:hover label:hover::after,
  &:hover input:checked + label:hover::after { display: block; }
}

/* scss-combine:components/prices */
// ================================================================ */
// Default for all price displays
// Price component within other components (such as product templates / lists)

.price-rrp { text-decoration: line-through; }

.price {
  font-size: rem-calc(21);
  line-height: 1.22;
  color: $color-text-meta;

  .price-withtax { display: block; }

  .price-tax-label {
    @extend %font-base;
    margin-left: rem-calc(3);
    font-size: 0.66em;
  }

  .price-saved {
    display: block;
    margin-top: 1em;
    font-size: rem-calc(13);
    font-style: italic;
    color: $color-sale-price;
  }
}


// ---------------------------------------------------------------- */
// Classes applied to price wrapper depending on values present.

.prices-both,
.prices-both-onsale {
  .price-withouttax {
    display: block;
    margin-top: rem-calc(2);
    opacity: 0.6;
  }
}

.prices-both-onsale,
.prices-taxed-onsale,
.prices-notax-onsale {
  .price-value {
    margin-right: rem-calc(5);
    color: $color-sale-price;
  }
}

// ---------------------------------------------------------------- */
// Prices as displayed on the product page.

.product-information {
  .prices-both,
  .prices-both-onsale {
    .price-withouttax { opacity: 0.6; }
  }
}

/* scss-combine:components/pagination */
// ================================================================ */
// Pagination - Previous / Next buttons and a list of links to other pages.
// Used in lists where content spans multiple pages.

.pagination {
  clear: both;
  font-size: 0; // Clear out whitespace between inline-blocks
  text-align: center;
  text-transform: uppercase;
}

.pagination-item {
  $pagination-item-size: rem-calc(36);
  display: inline-block;
  width: $pagination-item-size;
  height: $pagination-item-size;
  font-size: rem-calc(13);
  line-height: $pagination-item-size;
  color: inherit;
  text-align: center;
  border: 1px solid $color-borders;
  border-radius: 1px;

  &:not(.pagination-current):hover { color: $color-dark;}
  &:not(:last-of-type) { margin-right: rem-calc(8); }
}

.pagination-current {
  color: $color-text-darker;
  border-color: $color-text-darker;

  &:hover { color: $color-text-darker; }
}

// ---------------------------------------------------------------- */
// Next and Previous Pages

.pagination-previous::before,
.pagination-next::after {
  display: inline-block;
  width: 7px;
  height: 10px;
  background: {
    // SVG: Arrow pointing-left
    image: svg-url('<svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" viewBox="0 0 6.5 12"><style>.st0{fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}</style><path d="M.5 11.5L6 6 .5.5" class="st0"/></svg>');
    position: center center;
    repeat: no-repeat;
  }
  content: "";
}

.pagination-previous::before {
  margin-right: 0;
  transform: rotate(180deg);
}

/* scss-combine:components/product-lists */
// ================================================================ */
// Product Lists - Any display of a series of products
// Used for: Category / Brands / Search Results

.facet-block-title { @extend %font-h5; }

.product-list {
  position: relative;

  ul {
    padding-right: 0;
    padding-left: 0;
  }

  li { list-style-type: none; }
}

// Sort block at top of product-list
.product-list-sort {
  text-align: right;

  .form-label-text {
    margin-right: rem-calc(12);
    color: $color-secondary;
  }

  .form-select-wrapper {
    display: inline-block;
    max-width: 200px;
    text-align: left;
  }
}

// Each item within the grid.
.product-grid-item { margin-bottom: rem-calc(10); }

.facet-block-title,
.sidebar-title {
  @extend %label-text-treatment;
}

.has-additional-filters {
  margin-top: 0.6667rem; // 10px
  font-size: 1rem; // 15px
}

// ---------------------------------------------------------------- */
// Listing Filters

.product-list-utils {
  position: relative;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  justify-content: center;
  min-height: $height-list-utils;
  margin-top: $pad-vertical;

  @include breakpoint($nav-slide-bp) {
    justify-content: space-between;
  }

  .form-field { margin: 0; }
}

.product-list-results {
  flex-grow: 1;
  font-size: rem-calc(15);
  color: $color-text-meta;
}

.product-list-refine {
  @include breakpoint($nav-slide-maxwidth) {
    order: 3;
    width: 100%;
    margin-top: $pad-vertical;
    text-align: center;
  }
}

.filter-panel-toggle {
  @extend %label-text-treatment;
  padding: rem-calc(2) 0 0;
  margin-right: rem-calc(32);
  transition: border 0.3s ease;

  &:hover {
    color: $color-primary;
  }

  &:focus {
    outline: none;
  }

  &.is-active {
    .icon-x { display: inline-block; }
    .icon-filter { display: none; }
  }

  svg {
    position: relative;
    top: rem-calc(1);
    width: rem-calc(12);
    height: rem-calc(12);
    margin-right: rem-calc(6);
  }

  .icon-x {
    display: none;
  }
}

.active-filter {
  display: inline-block;
  padding: rem-calc(2 6);
  font-size: rem-calc(14);
  background-color: darken($color-light, 5);
  transition: color 0.3s ease;

  &:hover {
    background-color: darken($color-light, 8);
  }

  &:not(:last-child),
  &:only-child { margin-right: rem-calc(8); }

  svg {
    width: rem-calc(8);
    height: rem-calc(8);
    margin-left: rem-calc(4);
  }
}

.product-list-sidebar {
  position: absolute;
  top: 100%;
  right: 0;
  left: 0;
  z-index: 2;
  display: none;
  background-color: rgba($color-light, 0.95);

  @include breakpoint($nav-slide-bp) {
    right: -$pad-horizontal;
    left: -$pad-horizontal;
  }

  &.animating,
  &.visible {
    display: block;
  }

  // initial state for enter transition
  &.animating-in,
  &.animating-out {
    opacity: 0;
    transform: translateY(rem-calc(-20));
    transition: all 0.3s ease;
  }

  // final states for both in and out
  &.visible {
    opacity: 1;
    transform: translateY(0);
  }
}


// ---------------------------------------------------------------- */
// Product List / Grid Layout

.product-list-content,
.product-grid {
  @extend %clearfix;

  .product-grid-item {
    @include breakpoint($col-2-bp) { @include gallery(6 of 12); }
    @include breakpoint($col-3-bp) { @include gallery(4 of 12); }
    @include breakpoint($col-4-bp) { @include gallery(3 of 12); }
    @include breakpoint($col-6-bp) { @include gallery(2 of 12); }
  }
}

.page-search .product-list-sidebar { margin-top: 4.333rem; } // 65px

// ---------------------------------------------------------------- */
// Product lists shown as secondary content on other pages

.products-sidebar {
  @extend %page-bottom-pad;
  padding-top: $pad-vertical * 2;
  text-align: center;

  .page-product & {
    border-top: 1px solid $color-borders;
  }
}

.products-sidebar-grid {
  @extend %clearfix;

  .product-item {
    margin-bottom: $pad-vertical * 1.2;
  }
// ---------------------------------------------------------------- */

  // Quantity Query for less than 4 items
  .product-item:nth-last-child(-n+3):first-child,
  .product-item:nth-last-child(-n+3):first-child ~ .product-item {
    @include breakpoint($desktop-bp) {
      display: inline-block;
      float: none;
      vertical-align: top;
    }
  }

  // Quantity Query for just 2 items
  .product-item:nth-last-child(n+2):nth-last-child(-n+2):first-child,
  .product-item:nth-last-child(n+2):nth-last-child(-n+2):first-child ~ .product-item {
    @include breakpoint(480px) {
      @include gallery(6 of 12);
    }
  }

  // Quantity Query for just three items
  .product-item:nth-last-child(n+3):nth-last-child(-n+3):first-child,
  .product-item:nth-last-child(n+3):nth-last-child(-n+3):first-child ~ .product-item {
    @include breakpoint(480px) {
      @include gallery(4 of 12);
    }
  }

  // Quantity query: we have at least four items
  .product-item:nth-last-child(n+4),
  .product-item:nth-last-child(n+4) ~ .product-item {
    @include breakpoint(480px) {
      @include gallery(6 of 12);
    }

    @include breakpoint($desktop-bp) {
      @include gallery(3 of 12);
    }
  }
}
// ---------------------------------------------------------------- */
// Misc

// Make sure star ratings don't include an underline when hovered.
.facet-rating-link:hover { text-decoration: none; }

// ---------------------------------------------------------------- */
// Category Header
// Category pages show the section image across the header.

.category-header {
  border-top: 1px solid $color-borders;
  border-bottom: 1px solid $color-borders;

  .page-details.has-description {
    .page-title {
      margin-bottom: 0;
    }
  }
}

.category-header-bg {
  display: table;
  width: 100%;
  height: rem-calc(310);
  padding-right: 5%;
  padding-left: 5%;
  background-position: center 37.5%;
  background-size: cover;
  border-top: 0;
  border-bottom: 0;

  // Negative margin to offset container padding
  @include breakpoint(max-width $col-2-bp) {
    $offset-margin: rem-calc(20);
    width: calc(100% + ( #{$offset-margin} * 2 ) );
    margin-right: - $offset-margin;
    margin-left: - $offset-margin;
  }

  @include breakpoint($col-2-bp ($nav-slide-bp - 1)) {
    $offset-margin: $pad-horizontal;
    width: calc(100% + ( #{$offset-margin} * 2 ) );
    margin-right: - $offset-margin;
    margin-left: - $offset-margin;
  }

  .page-details {
    display: table-cell;
  }

  .page-title,
  .page-description {
    color: $color-light;
    text-align: left;
    vertical-align: middle;
  }
}

/* scss-combine:components/sidebar-blocks */
// ================================================================ */
// Blocks that appear in the sidebar when faceted search is enabled

.faceted-search-blocks {
  padding-top: $pad-vertical;
  padding-bottom: $pad-vertical;

  @include breakpoint($col-2-bp) {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
  }

  @include breakpoint($nav-slide-bp) {
    justify-content: flex-start;
  }
}

.sidebar-block {
  margin-bottom: rem-calc(30);

  @include breakpoint($col-2-bp) {
    display: inline-block;
    padding-right: rem-calc(15);
    width: 50%;
  }

  @include breakpoint($nav-slide-bp) {
    width: auto;
    padding-right: $pad-horizontal * 2;
    padding-left: $pad-horizontal;
  }

  &.subcategories-block {
    @include breakpoint($nav-slide-maxwidth) {
      width: 100%;
    }
  }

  &.no-items:not(.facet-price) { display: none; }

  ul,
  .faceted-range {
    margin-top: 1em;
    margin-bottom: 1em;
  }

  a { color: inherit; }

  .hidden {
    @include breakpoint($col-2-bp) {
      display: block;
      visibility: visible;
    }
  }

  &.loading { opacity: 0.3; }
}

.facet-price {
  @include breakpoint($nav-slide-bp) {
    width: rem-calc(240);
  }
}

.facet-remove {
  font-family: $font-secondary;
  font-size: rem-calc(14);
  text-decoration: underline;

  &:hover {
    text-decoration: none;
  }
}

.facet-block-title {
  @include breakpoint($col-2-bp) {
    pointer-events: none;

    span { display: none; }
  }
}

.facet-item,
.sidebar-block a {
  color: $color-text-lighter;

  &:hover,
  &.active {
    color: $color-dark;
  }
}

.facet-item {
  &.active {
    position: relative;

    a::before {
      $size: rem-calc(15);
      position: absolute;
      display: block;
      top: rem-calc(6);
      left: rem-calc(-20);
      width: $size;
      height: $size;
      border-radius: 50%;
      background-color: $color-dark;
      color: $color-light;
      line-height: $size;
      text-align: center;
      content: "\00D7";
    }
  }
}

.sidebar-categories {
  padding-bottom: 2em;
  border-bottom: 1px solid $color-borders;

  @include breakpoint($nav-slide-bp) {
    padding-bottom: 0;
    border-bottom: 0;
  }
}

.faceted-range {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;

  &.hidden {
    @include breakpoint($col-2-bp) {
      display: flex;
    }
  }

  .form-field { width: 46%; }

  .form-actions { margin-top: rem-calc(10); }

  .form-actions,
  .button {
    width: 100%;
  }
}

.facet-rating-link {
  font-size: rem-calc(13);

  .rating-stars {
    position: relative;
    top: rem-calc(2);
    display: inline-block;
    margin-top: 0;
    margin-right: rem-calc(8);
    margin-bottom: 0;
    vertical-align: middle;
  }
}

// Facet option list expand
.facet-option {
  display: block;
}

.faceted-search-option-columns { display: none; }

.facet-list-show-more {
  .toggle-link-text-on { display: none; }
}

/* scss-combine:components/loading */
// ================================================================ */
// Loading overlay that covers the loading region

.scroll-locked { overflow: hidden; }

.loading-wrapper {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 2;
  width: 100%;
  height: 100%;
  color: $color-primary;
  background-color: $color-light;
  opacity: 0;
  transition: all 0.2s ease;
}

body > .loading-wrapper { position: fixed; }

// Used for some loading indicators that transition in / out
.loading-wrapper.visible { opacity: 0.8; }


// ---------------------------------------------------------------- */
// Borrowed with love from
// http://github.danielcardoso.net/load-awesome/animations/ball-clip-rotate.html

/*!
 * Load Awesome v1.1.0 (http://github.danielcardoso.net/load-awesome/)
 * Copyright 2015 Daniel Cardoso <@DanielCardoso>
 * Licensed under MIT
 */
.la-ball-clip-rotate,
.la-ball-clip-rotate > div {
    position: relative;
    -webkit-box-sizing: border-box;
       -moz-box-sizing: border-box;
            box-sizing: border-box;
}
.la-ball-clip-rotate {
    display: block;
    font-size: 0;
    color: currentColor;
}
.la-ball-clip-rotate.la-dark {
    color: #333;
}
.la-ball-clip-rotate > div {
    display: inline-block;
    float: none;
    background-color: currentColor;
    border: 0 solid currentColor;
}
.la-ball-clip-rotate {
    width: 32px;
    height: 32px;

    // Added for positioning
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100px;
    margin: 0 auto;
    text-align: center;
    transform: translate(-50%, -50%);
}
.la-ball-clip-rotate > div {
    width: 32px;
    height: 32px;
    background: transparent;
    border-width: 2px;
    border-bottom-color: transparent;
    border-radius: 100%;
    -webkit-animation: ball-clip-rotate .5s linear infinite;
       -moz-animation: ball-clip-rotate .5s linear infinite;
         -o-animation: ball-clip-rotate .5s linear infinite;
            animation: ball-clip-rotate .5s linear infinite;
}
.la-ball-clip-rotate.la-sm {
    width: 16px;
    height: 16px;
}
.la-ball-clip-rotate.la-sm > div {
    width: 16px;
    height: 16px;
    border-width: 1px;
}
.la-ball-clip-rotate.la-2x {
    width: 64px;
    height: 64px;
}
.la-ball-clip-rotate.la-2x > div {
    width: 64px;
    height: 64px;
    border-width: 3px;
}
.la-ball-clip-rotate.la-3x {
    width: 96px;
    height: 96px;
}
.la-ball-clip-rotate.la-3x > div {
    width: 96px;
    height: 96px;
    border-width: 5px;
}
/*
 * Animation
 */
@-webkit-keyframes ball-clip-rotate {
    0% {
        -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
    }
    50% {
        -webkit-transform: rotate(180deg);
                transform: rotate(180deg);
    }
    100% {
        -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
    }
}
@-moz-keyframes ball-clip-rotate {
    0% {
        -moz-transform: rotate(0deg);
             transform: rotate(0deg);
    }
    50% {
        -moz-transform: rotate(180deg);
             transform: rotate(180deg);
    }
    100% {
        -moz-transform: rotate(360deg);
             transform: rotate(360deg);
    }
}
@-o-keyframes ball-clip-rotate {
    0% {
        -o-transform: rotate(0deg);
           transform: rotate(0deg);
    }
    50% {
        -o-transform: rotate(180deg);
           transform: rotate(180deg);
    }
    100% {
        -o-transform: rotate(360deg);
           transform: rotate(360deg);
    }
}
@keyframes ball-clip-rotate {
    0% {
        -webkit-transform: rotate(0deg);
           -moz-transform: rotate(0deg);
             -o-transform: rotate(0deg);
                transform: rotate(0deg);
    }
    50% {
        -webkit-transform: rotate(180deg);
           -moz-transform: rotate(180deg);
             -o-transform: rotate(180deg);
                transform: rotate(180deg);
    }
    100% {
        -webkit-transform: rotate(360deg);
           -moz-transform: rotate(360deg);
             -o-transform: rotate(360deg);
                transform: rotate(360deg);
    }
}


// ---------------------------------------------------------------- */
// Specific instances of loading indicators

.loading-wrapper {
  // Loading indicator covering the whole page.
  body > & {
    position: fixed;
    background-color: $color-light;
  }

  // Loading indicator shown as part of modal
  .modal-wrapper > & {
    background-color: transparent;
    z-index: -1;
  }

  // Covers the cart product items when updating qty, etc
  .cart-content & { background-color: $color-light; }
  // Shown above the cart footer region when coupons / giftcards updated
  .cart-totals & { background-color: $color-light; }


}

/* scss-combine:components/compare */
// ================================================================ */
// Compare Box sits at bottom of search results and displays
// a list of items selected for comparison.

.compare-items {
  position: fixed;
  right: 1em;
  bottom: 1em;
  z-index: 1;
  display: none;
  width: 400px;
  max-width: calc(100% - 2em);
  background-color: $white;
  box-shadow: 0 0 0.333em 0.066em rgba($black, 0.13);

  // REVIEW: If you want some progressive enhancement, this is one way to it
  // .no-js & { display: block; }

  &.animating,
  &.visible {
    right: -400px;
    display: block;
    opacity: 0;
    transition: all 0.2s $ease-out-quad;
  }

  &.visible {
    right: 1em;
    opacity: 1;
  }
}

.compare-items-header {
  @extend %clearfix;
  font-size: 1.066em; // ~16px
  color: $color-light;
  background-color: $color-dark;

  p {
    display: block;
    float: left;
    height: rem-calc(50);
    padding: 0;
    padding-left: 1.2em;
    margin: 0;
    line-height: 3.2375em;
  }

  .compare-link {
    display: inline-block;
    float: right;
    margin-bottom: 0;
    transition: opacity 0.3s ease;

    &:hover { background-color: $color-primary; }

    &.disabled {
      pointer-events: none;
      cursor: default;
      opacity: 0;
    }
  }
}

.no-js .compare-checkbox-label { display: none; } // Hide compare checkbox without js

// ---------------------------------------------------------------- */
// Preview images that display in the "compare box"

.compare-item {
  &.visible { display: inline-block; }
}

.compare-items-content {
  overflow: auto;
  white-space: nowrap;

  .compare-item-link {
    position: relative;
    display: block;
    height: auto;

    &:hover img { opacity: 0.5; }
    &:hover::after {
      font-size: 1.5em;
      color: $color-dark;
    }
  }
}

.compare-item-wrap {
  display: inline-block;
  padding: 10px 5px;

  .replaced-image {
    width: 90%;
    overflow: visible;
  }
}

.compare-item-remove {
  position: relative;
  display: block;
  height: auto;

  &::after {
    position: absolute;
    top: 0;
    right: 5px;
    z-index: 2;
    display: block;
    line-height: 1;
    content: "\00d7"; // times symbol (x)
    transition: all 0.2s $ease-out-quad;
  }
}

.compare-item-thumb {
  width: 75px;
  padding-bottom: 95px;
  background-position: center center;
  background-repeat: no-repeat;
  background-size: cover;
}

.compare-items-actions {
  margin-bottom: 15px;
  text-align: center;
}

.clear-compare {
  &:hover { color: $color-text-lighter; }
}

// Compare checkboxes
.compare-checkbox-label {
  position: relative;
  padding-top: 5px;
}

.compare-checkbox {
  position: absolute !important;
  width: 1px;
  height: 1px;
  overflow: hidden;
  clip: rect(1px, 1px, 1px, 1px);
}

// ---------------------------------------------------------------- */
// Use the svg-checkbox that we use on forms, with some minor tweaks
input[type=checkbox] + .compare-label-text {
    &::before {
      @extend %custom-checkbox;
      margin-right: rem-calc(8);
    }
  }

  input[type=checkbox]:checked + .compare-label-text::before {
    @extend %custom-checkbox-checked;
  }

/* scss-combine:components/product-items */
// ================================================================ */
// Products as displayed in a list or grid like format.


.product-item {
  position: relative;
  text-align: center;

  .item-title,
  .price {
    @extend %font-h5;
    display: block;
    font-size: rem-calc(16);
  }

  .price {
    margin-top: 0.6667rem;
    color: $color-text-meta;
  }

  .item-title {
    margin-top: 0.4667rem; // 7px
    transition: color 0.3s ease-out;

    &:hover { color: $color-primary; }
  }

  .button {
    padding-right: 4em;
    padding-left: 4em;
  }
}

.product-item {
  display: inline-block;
  width: 100%;
  padding: 0 10px $pad-vertical 15px;
  box-shadow: 0 0 transparent;

  &:hover {
    box-shadow: 0 1px 4px rgba($black, 0.2);
    transition: all .25s cubic-bezier(0.17, 0.605, 0.315, 0.875);

    .button-quickshop {
      opacity: 0.7;
      visibility: visible;
      transform: translateY(0);
    }
  }
}

.button-quickshop {
  display: inline-block;
  margin-top: rem-calc(20);
  font-family: $font-secondary;
  font-size: rem-calc(13);
  font-weight: 700;
  color: $black;
  text-transform: uppercase;
  opacity: 0;
  visibility: hidden;
  transform: translateY(rem-calc(-10));
  transition: all 0.2s cubic-bezier(0.17, 0.605, 0.315, 0.875);

  &:hover {
    .product-item & { opacity: 1; }
  }

  // Reveal it only if there is no-touch events (hover possible) on larger screens
  .touchevents & {
    display: none;
  }

  svg { vertical-align: middle; }
}


// ---------------------------------------------------------------- */

// Image
.product-item-image {
  position: relative;
  padding: 1em 1em 1.5em;
}

/* scss-combine:components/product-badges */
// ================================================================ */
// Display the sale / sold out badges on product listing items.

// Text that displays "sale" on items on sale.
.product-badge {
  @extend %product-badge-text-treatment;
  position: absolute;
  top: 1rem;
  right: 1rem;
  z-index: 1;
  height: rem-calc(21);
  padding: 0 rem-calc(7);
  line-height: rem-calc(21);
  color: $color-primary;
  text-align: center;
  text-transform: uppercase;
  background-color: transparent;
  border: 1px solid $color-primary;
  transition: all 200ms $ease-out-quad;
  pointer-events: none;

  .setting-fill-badges & {
    color: $color-light;
    background-color: $color-primary;
  }

  .setting-fill-badges .product-item:hover & {
    color: $color-primary;
    background-color: $color-light;
    border-color: $color-primary;
  }
}

.badge-sale {
  color: $color-problem;
  border: 1px solid $color-problem;

  .setting-fill-badges & {
    color: $color-light;
    background-color: $color-problem;
  }

  .setting-fill-badges .product-item:hover & {
    color: $color-problem;
    background-color: $color-light;
    border-color: $color-problem;
  }
}

/* scss-combine:components/product-page */
// ================================================================ */
// Product Page - Viewing the full product information page

.product-info-wrapper {
  @extend %clearfix;
  max-width: rem-calc(1800);
  margin-bottom: $pad-vertical * 2;

  &:after {
    visibility: hidden;
    content: "single-column";
    font-size: 0;
  }
}

.product-information {
  padding: ($pad-vertical * 2) rem-calc(20) 0 0;

  @include breakpoint($col-2-bp) {
    padding-right: $pad-horizontal;
  }

  &.sticky {
    @include breakpoint($nav-slide-bp) {
      width: calc(50% - (#{$nav-sidebar-width / 2})); // context is now window, so account for sidebar
    }

    @include breakpoint(2085px) {
      // Minor tweak for the largest screens so info doesn't jump around
      left: rem-calc(1240);
    }
  }
}

.product-inner {
  max-width: rem-calc(540);
  padding-left: rem-calc(20);

  @include breakpoint($col-2-bp) {
    padding-left: $pad-horizontal;
  }
}

.main-product-graphic {
  padding-top: $pad-vertical * 2;
  padding-right: rem-calc(20);
  padding-left: rem-calc(20);

  @include breakpoint($col-2-bp) {
    padding-right: $pad-horizontal;
    padding-left: $pad-horizontal;
  }

  @include breakpoint($nav-slide-bp) {
    padding-right: 0;
  }
}

.product-slides-wrap .product-slide:first-child {
  display: none;
}

// adjust product layout to 2 columns
@include bp-wider-page {
  .product-information {
    float: right;
    width: 50%;
    right: 0;

    &:after {
      @extend %visually-hidden;
      content: "enable-sticky";
    }
  }

  .main-product-graphic {
    float: left;
    width: 50%;
  }

  .first-product-image {
    display: none;
  }

  .product-slides-wrap .product-slide:first-child {
    display: block;
  }
}


// ---------------------------------------------------------------- */
// Info Tabs - Below main product image / details
// shows features, warranty, reviews (etc)

.product-tabs {
  padding: $pad-vertical 0;
}

.product-tabs-navigation {
  ul {
    padding: 0;
    margin: 0;
    border-bottom: 1px solid $color-borders;
  }

  li {
    display: inline-block;
    margin-right: rem-calc(8);

    @include breakpoint($col-2-bp) {
      margin-right: rem-calc(32);
    }
  }

  a {
    position: relative;
    top: 1px;
    display: inline-block;
    padding: rem-calc(16 0);
    font-family: $font-secondary;
    font-size: rem-calc(13);
    line-height: rem-calc(18);
    text-transform: uppercase;
    color: $color-dark;
    border-bottom: 2px solid transparent;

    svg {
      display: inline-block;
      margin-left: 1em;
      vertical-align: middle;
    }
  }

  .active a {
    color: $color-dark;
    font-weight: bold;
    border-bottom-color: $color-dark;
  }
}

.tab-content-panel {
  display: none;

  &.active { display: block; }
}

.product-brand {
  color: $color-headings;

  &:hover { opacity: 0.7; }
}

.product-title {
  @extend %font-h1;
  font-size: if(font-mapper("font_h1-h3") == "Karla", rem-calc(34), rem-calc(28));

  .quick-shop-modal & {
    margin-top: rem-calc(20);
  }
}

.read-more-link {
  @extend %underline-hover;
  color: $color-primary;
}

.product-detail-item:not(:last-child) {
  margin-bottom: 1em;
}

.product-details-title,
.product-details-info:not(:last-child) {
  display: inline;
}

.product-details-title {
  font-weight: bold;

  &.product-details-bulk-pricing {
    display: block;
  }
}

.product-details-info ~ .product-details-info { display: block; }

.form-file-types,
.form-file-size {
  font-size: 75%;
}


// ---------------------------------------------------------------- */
// Product Reviews Displayed

.product-info-reviews {
  padding-top: $pad-vertical * 2;
  padding-bottom: rem-calc(20);
  border-top: 1px solid $color-borders;

  .review-item {
    margin-bottom: rem-calc(50);

    .rating-stars { margin-top: 0.15rem; }
  }

  .review-item-meta {
    margin-top: 1.4rem;
    font-family: $font-secondary;
    font-size: rem-calc(14);
    text-transform: uppercase;
    opacity: 0.75;
  }

  .review-title { font-size: rem-calc(20); }
}

.product-reviews-header {
  text-align: center;
  margin-bottom: rem-calc(40);
}

.reviews-title {
  @extend %font-h3;
}

.product-details-rating {
  margin-bottom: 1em;
}

.page-product,
.quick-shop-modal {
  .price {
    display: block;
    margin-top: rem-calc(16);
    margin-bottom: rem-calc(14);
  }
}

/* scss-combine:components/flickity */
/*! Flickity v1.1.1
http://flickity.metafizzy.co

Stylesheet imported (with some content removed) from Flickity Library.
---------------------------------------------- */

.flickity-enabled {
  position: relative;
}

.flickity-enabled:focus { outline: none; }

.flickity-viewport {
  position: relative;
  height: 100%;
  overflow: hidden;
}

.flickity-slider {
  position: absolute;
  width: 100%;
  height: 100%;
}

/* draggable */

.flickity-enabled.is-draggable {
  user-select: none;
  tap-highlight-color: transparent;
}

.flickity-enabled.is-draggable .flickity-viewport {
  cursor: move;
  cursor: grab;
}

.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down {
  cursor: grabbing;
}

/* ---- previous/next buttons ---- */

.flickity-prev-next-button {
  position: absolute;
  top: 50%;
  width: 44px;
  height: 44px;
  cursor: pointer;
  background: transparent;
  background: hsla(0, 0%, 100%, 0);
  border: 0;
  border-radius: 50%;
  transform: translateY(-50%);
}

.flickity-prev-next-button:hover { background: transparent; }

.flickity-prev-next-button:focus {
  outline: none;
  box-shadow: 0 0 0 5px #09F;
}

.flickity-prev-next-button:active {
  opacity: 0.6;
  filter: alpha(opacity=60); /* IE8 */
}

.flickity-prev-next-button.previous { left: 10px; }
.flickity-prev-next-button.next { right: 10px; }

.flickity-prev-next-button:disabled {
  cursor: auto;
  opacity: 0.3;
  filter: alpha(opacity=30); /* IE8 */
}

.flickity-prev-next-button svg {
  position: absolute;
  top: 20%;
  left: 20%;
  width: 60%;
  height: 60%;
}

.flickity-prev-next-button .arrow {
  fill: $black;
}

/* color & size if no SVG - IE8 and Android 2.3 */
.flickity-prev-next-button.no-svg {
  font-size: 26px;
  color: #333;
}

/* scss-combine:components/product-images */
// ================================================================ */
// Product Images - as displayed on product pages

// Hide additional images when no js (since slides won't open)
.no-js .product-slide:not(:first-of-type) { display: none; }

// ---------------------------------------------------------------- */
// Primary Product Image
@include breakpoint(max-width 500px) {
  .product-slides-wrap {
    &:after {
      @extend %visually-hidden;
      content: "disable-lightbox";
    }
  }
}

.product-slide {
  position: relative;
  display: block;
  width: 100%;
  margin-right: 0.333rem;
  margin-bottom: $pad-vertical;
  text-align: center;
  opacity: 0;
  visibility: hidden;
  transform: translateY(rem-calc(-10));
  transition: all 0.6s ease-out;

  .no-js &,
  &.loaded {
    visibility: visible;
    opacity: 1;
    transform: translateY(0);
  }

  &:last-child { margin-bottom: 0; }
}

// Product images in a modal column
.quick-shop-secondary-image .qs-img-wrapper {
  display: inline-block;
  width: rem-calc(54px);
  border: 1px solid transparent;

  &:not(:last-child) { margin-right: rem-calc(6px); }
  &.active { border: 1px solid $color-dark; }
}

.product-info-wrapper { position: relative;}

/* scss-combine:components/add-to-cart-form */
// ================================================================ */
// The add to cart form - on product pages

// ---------------------------------------------------------------- */
// Responsive styling and grid layout

.add-to-cart-form-full {
  // Large screen - sits within a 6 column region (as defined in product-pages)
  .form-field,
  .form-field-control {
    display: block;
  }

  .form-file-types,
  .form-file-size {
    display: block;
    font-size: rem-calc(12);
  }
}

.form-field-options,
.form-field-customizations {
  width: 100%;
}

.product-cart-messages { clear: both; }

.add-to-cart-buttons .button-square svg { vertical-align: text-top; }

.option-unavailable { opacity: 0.5; }

// ================================================================ */
// Swatch: Set of options displaying color / pattern choices

.swatch-wrap .form-label-text {@extend .visually-hidden; }

.form-field-swatch {
  $swatch-size: 32px;

  .form-field-control { @extend %clearfix; }

  .swatch-wrap {
    float: left;
    padding: 0.2em;
    border-radius: 50%;
    cursor: pointer;

    &:not(:last-child) { margin-right: 0.333em; }

    &:hover {
      .swatch-pattern-expanded {
        z-index: 10;
        opacity: 1;
        visibility: visible;
      }
    }
  }

  .swatch {
    position: relative;
    display: block;
    width: $swatch-size;
    height: $swatch-size;
    overflow: hidden;
    border-radius: 50%;
    transform: translateZ(0); // Fixes issue with flickering in Chrome
  }

  // ------------------ */
  // Multiple Colors

  .swatch-color {
    position: absolute;
    top: 0;
    left: 0;
    display: block;
    width: 100%;
    height: 100%;
    background: {
      position: 50%;
      repeat: no-repeat;
      size: cover;
    }
  }

  .two-colors .secondary {
    left: 50%;
  }

  .three-colors {
    .secondary {
      right: 68%;
      left: auto;
    }

    .tertiary {left: 68%; }
  }

  // ------------------ */
  // Selected States

  .swatch-radio {
    // Selected Swatch Item
    &:checked + .swatch {
      border-color: $color-borders;
      box-shadow: 0 0 0 4px $white, 0 0 0 6px $color-borders;
    }
  }

  .swatch-pattern-expanded {
    position: absolute;
    padding: 5px;
    background-color: $color-light;
    border: 1px solid $color-borders;
    border-radius: 50%;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s $ease-out-quad;

    @include breakpoint(max-width 768px) { display: none; }
  }

  .swatch-pattern-image {
    display: block;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: {
      position: 50%;
      repeat: no-repeat;
      size: cover;
    }
  }
}

// ================================================================ */
// Rectangles - Form options displayed as a series of rectangles with text

.form-field-rectangle {
  @extend %clearfix;

  .rectangle {
    position: relative;
    display: inline-block;
    float: left;
    margin: 0 1.333em 1.333em 0;
  }

  .rectangle-text {
    display: block;
    padding-left: 1.333em;
    padding-right: 1.333em;
    min-width: 2.667em;
    min-height: 3.666em;
    line-height: 3.666em;
    text-align: center;
    border: {
      color: $color-borders;
      style: solid;
      width: rem-calc(1px);
      radius: 0.133em;
    }
  }

  // scss-lint:disable QualifyingElement
  input[type="radio"] {
    position: absolute;
    z-index: 1;
    width: 100%;
    height: 100%;
    cursor: pointer;
    opacity: 0;

    // Selected Item
    &:checked + .rectangle-text { border-color: $color-dark; }
  }
}


/*----------------------------------------------------------------------------*/
// Product picklist items

/* product-picker input type  */

.product-picklist-item {
  position: relative;
  display: block;
  margin-bottom: -1px;
}

.product-picklist-radio {
  position: absolute;
  top: 50%;
  margin-top: -7px;
  line-height: 14px;
}

.product-picklist-item-body {
  position: relative;
  display: table;
  width: 100%;
  min-height: 80px;
  padding: 6px 8px 6px 90px;
  font-size: 13px;
  cursor: pointer;

  &.picklist-none { padding-left: 27px; }

  &:hover {
    z-index: 1;
  }

  [type="radio"]:checked ~ & {
    z-index: 2;
  }
}

.product-picklist-image-wrap {
  position: absolute;
  top: 0;
  bottom: 8px;
  left: 24px;
  width: 60px;
  overflow: hidden;
}

.product-picklist-image {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.product-picklist-label-text {
  display: table-cell;
  line-height: 1.4;
  vertical-align: middle;

  .picklist-none & {
    position: relative;
    top: 2px;
  }
}


/*----------------------------------------------------------------------------*/
// Delivery date

.form-field-date {
  .form-field-control { display: flex; }
  .form-select-wrapper { margin-right: rem-calc(10); }
}

/* scss-combine:components/quantity-widget */
// ================================================================ */
// Quantity control - as seen on product pages and the cart

.form-field-quantity-control .form-field-control {

  $button-pad-position: rem-calc(10);
  position: relative;
  display: block;
  width: rem-calc(120);

  .qty-decrement,
  .qty-increment {
    position: absolute;
    top: 50%;
    font-size: 1.1em;
    cursor: pointer;
    transform: translateY(-50%);
    user-select: none;

    &:hover { color: $color-dark; }
  }

  .qty-decrement { left: $button-pad-position; }
  .qty-increment { right: $button-pad-position; }
  input { text-align: center; }
}

/* scss-combine:components/blog */
// ================================================================ */
// Blog Listing

// scss-lint:disable SelectorFormat -- .page-blog_post is autogenerated
// based on content in the page data json.

// ---------------------------------------------------------------- */

.blog-index {
  margin-top: $pad-vertical;
  margin-bottom: $pad-vertical * 2;

  // Styles specific to blog list display on tablet / mobile
  .blog-item {
    padding-bottom: $pad-vertical * 3;
    margin-bottom: $pad-vertical * 3;
    &:not(:last-child) { border-bottom: 1px solid $color-borders; }
  }

  .button { margin-top: 4rem; } // 60px
}

// ---------------------------------------------------------------- */

// Styling for the items as displayed in blog-index (list of posts)
.blog-item {
  .item-title {
    @extend %blog-post-title;
    margin-bottom: $pad-vertical * 0.8;

    a:hover { color: $color-primary; }
  }

  .timestamp {
    @extend %timestamp-text-treatment;
    display: block;
    padding-bottom: $pad-vertical;
    color: $color-text-lighter;
    text-align: center;
  }

  // Images within <figure> elements with a background
  .blog-item-image {
    margin: 0;
    margin-bottom: rem-calc(46);

    a {
      display: block;
      width: 100%;
    }
  }

  .blog-item-content {
    @include breakpoint(400px) {
      padding-right: $pad-horizontal;
      padding-left: $pad-horizontal;
    }
  }

  .blog-content-summary { margin-bottom: $pad-vertical; }
  .read-more-link { @extend %link-underlined; }
}

// ---------------------------------------------------------------- */
// Individual Blog Posts

.page-blog_post {
  .post-title {
    @extend %blog-post-title;
    margin-top: $pad-vertical * 2;
  }

  .timestamp {
    @extend %timestamp-text-treatment;
    display: block;
    padding-bottom: $pad-vertical;
    color: $color-text-lighter;
    text-align: center;
  }

  .post-meta {
    padding-top: $pad-vertical;
    font-family: $font-secondary;
    border-top: 1px solid $color-borders;

    .timestamp { font-weight: bold; }
  }

  .featured-image-container,
  .blog-content {
    margin-bottom: $pad-vertical * 0.8;
  }

  .blog-content {
    margin-bottom: $pad-vertical * 2;
    line-height: 2;
  }

  .post-author {
    color: $color-text;
    span { color: $color-text-lighter; }
  }

  .main-content { @extend %page-bottom-pad; }
}

// When enabled, display a dropcap for the first letter
.setting-journal-dropcap.blog-content::first-letter {
  float: left;
  padding-right: rem-calc(14);
  padding-left: rem-calc(8);
  margin-bottom: rem-calc(-5);
  font-size: rem-calc(98);
  line-height: 1;
  color: $color-text-lighter;
  vertical-align: top;
}

// ---------------------------------------------------------------- */
// Latest blog posts display on the homepage.

.latest-blog-posts {
  padding: $pad-vertical $pad-horizontal;
  text-align: center;

  .blog-item-image .replaced-image {
    width: rem-calc(165);
    height: rem-calc(165);
    margin: 0 auto rem-calc(40);
    background-color: darken($white, 5);
    border-radius: 50%;

    @include breakpoint($desktop-bp) {
      width: 15vw;
      height: 15vw;
    }
  }

  .latest-blog-posts-items {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
  }

  .blog-item {
    margin-bottom: 3rem;



    .item-title {
      @extend %font-h5;
      margin-bottom: rem-calc(5);
    }
  }

  // Quantity query for just 2 items
  .blog-item:nth-last-child(n+2):nth-last-child(-n+2):first-child,
  .blog-item:nth-last-child(n+2):nth-last-child(-n+2):first-child ~ .blog-item {
    @include breakpoint(480px) {
      width: 50%;
    }
  }

  // Quantity query for just three items
  .blog-item:nth-last-child(n+3):nth-last-child(-n+3):first-child,
  .blog-item:nth-last-child(n+3):nth-last-child(-n+3):first-child ~ .blog-item {
    @include breakpoint(680px) {
      width: 33.333%
    }
  }

  // Quantity query for at least four items
  .blog-item:nth-last-child(n+4),
  .blog-item:nth-last-child(n+4) ~ .blog-item {
    @include breakpoint($carousel-bp) {
      width: 50%;
    }

    @include breakpoint($desktop-bp) {
      width: 24%;
    }
  }
}

/* scss-combine:components/share-links */
// ================================================================ */
// Share Links

.fb-like iframe { max-width: none; }

.share-links-container {
  margin-top: rem-calc(20);
  margin-bottom: rem-calc(20);
  color: $color-text-darker;

  .share-links { padding: 0; }

  .share-link {
    display: inline-block;
    vertical-align: middle;

    svg {
      max-width: 100%;
      margin-left: rem-calc(10);
    }

    a {
      display: inline-block;
      max-width: rem-calc(18);
      max-height: rem-calc(18);
      line-height: rem-calc(18);
      color: inherit;
    }

    &:not(:last-child) { margin-right: 1rem; }
  }

  &.has-like,
  .type-blog-post { text-align: left; }

  .facebook-like { vertical-align: text-bottom; }

  @include breakpoint(max-width 500px) { display: none; }
}

.share-links-label,
.share-links {
  display: inline;
  font-size: rem-calc(14);
  line-height: rem-calc(25);
  text-transform: uppercase;
  cursor: pointer;
}

.share-links-label {
  font-family: $font-secondary;
  font-weight: bold;
  margin-right: rem-calc(25);
}

// ================================================================ */
// Social Media Links (in footer)

.social-media-link {
  display: inline-block;

  &:not(:last-of-type) { margin-right: rem-calc(20); }
  .social-media-name { vertical-align: middle; }

  svg {
    margin-right: rem-calc(8);
    vertical-align: middle;
    width: rem-calc(18);
  }
}

.quick-shop-modal .has-like .share-links {
  display: block;
}

/* scss-combine:components/alerts */
// ================================================================ */
// Alerts - errors and status messages displayed in context.
// ---------------------------------------------------------------- */

.alert {
  @extend %alert-text-treatment;
  display: block;
  padding: 0.666em;
  margin-bottom: 0.66em;

  a {
    font-weight: bold;
    color: inherit;
    text-decoration: underline;
  }
}

.alert-error {
  padding: 0;
  color: $color-problem;
}

.alert-info {
  color: $color-warning;
  background-color: rgba($color-warning, 0.1);
}

.alert-success {
  color: $color-confirm;
  background-color: rgba($color-confirm, 0.1);
}

/* scss-combine:components/giftwrapping */
// ================================================================ */
// Giftwrapping modal displayed on the cart page.

// ---------------------------------------------------------------- */
// Modal

// This modal starts hidden (to show a loading indicator)
// and then transitions in when ready to go
.giftwrap-modal {
  opacity: 0;
  transition: opacity 200ms ease;

  .loaded & { opacity: 1 }
}

/* scss-combine:components/return-shop-link */
// ================================================================ */
// A small link displayed in the page header that sends users back

.return-to-shopping-link a {
  $animate-distance: 0.5rem;
  text-transform: initial;

  &::before {
    display: inline-block;
    width: 0;
    height: 0;
    margin-right: $animate-distance;
    vertical-align: middle;
    border-top: 3px solid transparent;
    border-right: 3px solid currentColor;
    border-bottom: 3px solid transparent;
    content: "";
    transition: all 200ms ease;
  }

  &:hover::before {
    margin-right: $animate-distance * 2;
    margin-left: - $animate-distance;
  }
}

/* scss-combine:components/quick-shop */
// ================================================================ */
// Quick Shop - Displaying a product preview in a modal

// ---------------------------------------------------------------- */

.quick-shop-modal {
  width: rem-calc(900);
  padding: rem-calc(30);
  opacity: 0;
  transition: opacity 200ms ease;

  .loaded & { opacity: 1; }

  @include breakpoint(40em) {
    // Larger screen widths;
    .quick-shop-info-column,
    .quick-shop-image-column { width: 50%; }

    .quick-shop-info-column {
      float: right;
      padding-left: 1.666em;
    }

    .quick-shop-image-column {
      float: left;
      padding-right: 1.666em;
    }
  }

  .flickity-slider img {
    margin: 2px; // Minor spacing to avoid next slide clipping over edge
    width: 100%;
  }

  .quick-shop-primary-image ~ .quick-shop-secondary-image {
    margin-top: 1em;
  }

  .more-link {
    display: none;
    text-decoration: underline;

    &:hover {
      text-decoration: none;
    }
  }

  [data-button-purchase] {
    width: calc(80% - 50px);
  }

  .product-summary {
    display: none;

    &.loaded { display: inline-block; }

    .more-link {
      display: inline-block;
      margin-left: rem-calc(5);
    }
  }
}

.quick-shop-full-details-link {
  display: inline-block;
  padding-bottom: rem-calc(3);
  margin-top: rem-calc(14);
  margin-bottom: rem-calc(28);
  font-family: $font-secondary;
  color: $color-dark;
  text-transform: uppercase;
  border-bottom: 1px solid $color-borders;

  &:hover {
    border-color: transparent;
  }

  &:after {
    margin-left: rem-calc(4);
    font-size: 1.1em;
    content: "\203A";
  }
}

/* scss-combine:components/apple-pay */
.apple-pay-checkout-button {
  display: none;
  height: rem-calc(50);
  background: {
    position: 50% 50%;
    repeat: no-repeat;
    size: 100% 60%;
  }
  border-radius: 5px;
  box-sizing: border-box;

  @if stencilString("style_apple_pay_button") == "white" {
    background-color: white;
    background-image: -webkit-named-image(apple-pay-logo-black);
  } @else if stencilString("style_apple_pay_button") == "white-border" {
    background-color: white;
    background-image: -webkit-named-image(apple-pay-logo-black);
    border: 0.5px solid black;
  } @else {
    background-color: black;
    background-image: -webkit-named-image(apple-pay-logo-white);
  }

  .additional-checkout-buttons & {
    margin-bottom: rem-calc(15);
  }

  .apple-pay-supported & {
    display: block;
  }
}


// Specific Pages
/* scss-combine:components/pages-content */
// ================================================================ */
// Content Pages -

// Contact Form
#form-contact-us {
  .form-actions {
    text-align: center;
    clear: both;
  }
}

// ================================================================ */
// Pages with Sidebars
// Example left here for demonstration purposes - these grids are applied
// individually as needed (since different sections use different widths)

// .page-with-sidebar {
  // Define your sidebar classes as necessary.
  // .page-sidebar { @include span(4 of 12); }
  // .page-main-content { @include span(last 8 of 12); }
// }

/* scss-combine:components/compare-page */
// ================================================================ */
// Compare Page - display a few items to be compared.

// ---------------------------------------------------------------- */

.compare-page {
  @extend %page-bottom-pad;
  overflow: auto;
  white-space: nowrap;

  .compare-column { white-space: normal; }
}

.compare-table-heading {
  padding: 1.5625em 0.5em 1.25em; // 25px 15px 20px
  margin: {
    top: 1.866em;
    bottom: 1.866em; // ~28px
  }
  font-size: 1.066em; // ~16px
  font-weight: bold;
  line-height: 1.5; // 24px
  color: $color-dark;
  border: {
    top: 1px solid $color-borders;
  }
}

.compare-details {
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  padding: 0 0.5em;
  vertical-align: bottom;

  .rating-stars,
  .item-title { margin-bottom: 0.5em; }

  &:nth-child(1) { text-align: center; }

  .item-title { font-size: 1.466em; } // 22px (from 15 base)

  .price {
    @extend %font-h3;
    display: block;
  }

  .button { margin-top: 3em; } // ~33px

  .compare-remove-link {
    display: block;
    font-size: 0.866em; // ~13px
    color: $color-primary;
    text-decoration: underline;
  }
}

.compare-column {
  padding-bottom: 1.8em; // ~27px
  border-bottom: 1px solid $color-borders;

  @include breakpoint(700px) {
    display: inline-block;
    width: 33%;

    &:not(:first-child) {
      .compare-details {
        margin-left: 2em;
      }

      .compare-table-heading {
        color: rgba($color-light, 0);
      }
    }

    // Quantity query for when only two compare items.
    &:nth-last-child(-n+2):first-child,
    &:nth-last-child(-n+2):first-child ~ & {
      width: 50%;
    }

    // Container query for when there's four or more
    &:nth-last-child(n+4),
    &:nth-last-child(n+4) ~ & {
      width: 30%;
    }
  }
}


/* scss-combine:components/page-cart */
// ================================================================ */
// Cart Page - Display the products the customer is ready to buy before checkout

// ---------------------------------------------------------------- */
// General page styles

// Title above coupon codes / giftcards
.cart-block-title {
  @extend %font-h5;
  margin-bottom: rem-calc(5);
  color: $color-dark;
}

// ---------------------------------------------------------------- */
// General Cart Page Layout

.page-cart {
  .cart-totals {
    @extend %clearfix;
    padding: ($pad-vertical * 1.2) 0;
  }

  .cart-totals-extras .cart-totals-block { margin-bottom: 2.5rem; }

  @include bp-wider-page {
    .cart-totals-extras { @include span(5 of 12); }
    .cart-totals-info { @include span(last 5 of 12); }
  }
}

.cart-content {
  margin-bottom: $pad-vertical;
  @include breakpoint(800px) { margin-bottom: $pad-vertical * 2; }
}

.cart-totals-summary { margin-bottom: rem-calc(20); }

// ---------------------------------------------------------------- */
// Cart item components - individual line items as displayed on the cart page.

.cart-item-remove,
.cart-item-price,
.cart-item-title {
  @extend %font-h5;
}

.cart-item-title { margin-bottom: 0.4em; }
.cart-item-price { font-weight: normal; }

.cart-item-price-discounted { text-decoration: line-through; }


// Little dot with an X in it
// (for removing items from the cart)
.cart-item-remove {
  $remove-dot-size: rem-calc(24);
  position: relative;
  display: inline-block;
  width: $remove-dot-size;
  height: $remove-dot-size;
  vertical-align: middle;
  border: 1px solid currentColor;
  border-radius: 50%;
  opacity: 0.3;
  transition: all 200ms $ease-out-quad;

  &:hover { opacity: 0.6; }

  .mini-cart-content & { vertical-align: top; }

  svg {
    position: absolute;
    top: 50%;
    left: 50%;
    display: block;
    width: rem-calc(8);
    height: rem-calc(8);
    margin-top: rem-calc(-4);
    margin-left: rem-calc(-4);
  }
}

// ---------------------------------------------------------------- */
// Cart items as a whole:

.cart-item {
  padding-top: rem-calc(20);
  padding-bottom: rem-calc(20);
  border-top: 1px solid $color-borders;

  .cart-item-image { margin-bottom: 1em; }

  .form-field-quantity-control {
    width: rem-calc(140);
    margin: 0 auto;
  }

  .cart-item-details {
    line-height: 1.5;
  }

  // Smallest widths, or just after the sidebar comes into view
  @include bp-narrower-page {
    display: flex;
    flex-direction: column;
    max-width: rem-calc(320);
    margin: 0 auto;
    text-align: center;

    > * { margin-bottom: rem-calc(20); }
    .cart-item-image { order: 1; }
    .cart-item-price { order: 2; }
    .cart-item-details { order: 3; }
    .cart-item-quantity { order: 4; }
    .cart-item-remove { display: none; }
  }

  // Just before we have the sidebar (wider content) or again for larger screens
  // Breakpoint: ~700-800 and over 1000
  @include bp-wider-page {
    display: table;
    width: 100%;
    max-width: 100%;
    table-layout: fixed;

    > * {
      display: table-cell;
      vertical-align: middle;
    }

    .cart-item-image {
      width: span(2 of 12);
    }

    .cart-item-details {
      padding-left: span(0.5);
      padding-right: span(0.5);
      width: span(5.5 of 12);
    }

    .cart-item-remove-wrapper { width: rem-calc(24); }

    .cart-item-price {
      display: table-cell;
      text-align: center;
    }

    .cart-item-details { text-align: left; }
  }
}


// ---------------------------------------------------------------- */
// Coupon Codes Cart Block

// Inline style buttons next to form fields.
.cart-totals-giftcards,
.cart-totals-coupons {
  .button { float: right; }
  .form { margin-bottom: rem-calc(10); }
}

.cart-totals-checkout {
  @extend %clearfix;
  .button { width: 100%; }
}

// ---------------------------------------------------------------- */
// Cart Totals Summary - displays subtotal and price information

.cart-totals-summary-values {
  @extend %clearfix;
  display: block;
  padding-top: 0.8em;
  padding-bottom: 0.8em;

  &:not(:last-child) { border-bottom: 1px solid $color-borders; }

  &.order-total {
    font-size: rem-calc(18);
    color: $color-headings;

    .cart-total-value { font-weight: bold; }
  }

  .cart-total-value {
    float: right;
    text-align: right;
  }
}

.cart-action-minor {
  cursor: pointer;
}

@include bp-narrower-page {
  .cart-totals-checkout,
  .additional-checkout-buttons {
    width: 60%;
    margin: 0 auto;
  }
}
// ---------------------------------------------------------------- */
// Postage and Packaging (Shipping) Modal

.shipping-calculator {
  h2 { @extend .form-field-title; }

  .button {
    float: left;
    width: calc(50% - 1em);

    // Buttons fill half width
    &:first-child { margin-right: 1em; }
    &:last-child:not(:first-child) { margin-left: 1em; }
  }
}

.shipping-quotes {
  clear: both;
}

.cart-totals-giftcards .button,
.cart-totals-coupons .button { @extend .button-input-wrap; }

.show-calculator {
  text-decoration: underline;
  cursor: pointer;
}

// Paypal icon / link near the footer
.additional-checkout-buttons {
  p {
    //scss-lint:disable ImportantRule -- inline styles on this, we need to override
    float: none !important;
  }

  p,
  form { text-align: center; }
}

/* scss-combine:components/brands-page */
// ================================================================ */
// shows a summary of all the brands on the site.

.brand-item,
.brands-group {
  @include breakpoint($col-2-bp) { @include gallery(6 of 12); }
  @include breakpoint($col-3-bp) { @include gallery(4 of 12); }
  @include breakpoint($col-4-bp) { @include gallery(3 of 12); }
  @include breakpoint($col-6-bp) { @include gallery(2 of 12); }
}

.brand-item {
  padding: 0 rem-calc(35);
  margin-bottom: rem-calc(10);
  text-align: center;
}

.brands-index {
  @extend %clearfix;
  margin-bottom: rem-calc(50);
}

.brands-group {
  margin-bottom: 4rem;

  dt {
    font-family: $font-secondary;
    font-weight: bold;
  }

  dd {
    margin-left: 0;

    a {
      color: inherit;

      &:hover { text-decoration: underline; }
    }
  }
}

.brand-item-title {
  @extend %font-h5;
  margin-top: rem-calc(30);
  font-size: rem-calc(14);
}

.js .brands-list { visibility: hidden; }

/* scss-combine:core/account */
// Default Variables

$account-link-color: #888 !default;
$account-light-color: #fff !default;
$account-accent-color: #5dc5e3 !default;
$account-border-color: #e4e4e4 !default;
$account-gutter: 30px !default;
$account-font-size: 15px !default;
$account-border-radius: 0 !default;
$account-text-color: #5f5f5f !default;

$account-card-background-color: #f5f5f5 !default;

$giftcard-nav-use-default-styles: true !default;

$account-breakpoint-x-small: 400px !default; // the account table columns change to full-width
$account-breakpoint-small: 620px !default; // menu changes from full-width to column
$account-breakpoint-medium: 900px !default; // menu changes from 35% to 25% width

// Internal Variables

$account-font-size-heading: $account-font-size + 2 !default;

$account-text-color-light: lighten($account-text-color,20%) !default;

$account-gutter-inner: $account-gutter / 2 !default;

$auth-gutter: $account-gutter !default;
$auth-font-size: $account-font-size !default;

// Imports

/* scss-combine:account/components/layout */
.account-wrapper {
  @extend %clearfix;
  font-size: $account-font-size;
}

.account-nav,
.account-body {
  vertical-align: top;
}

.account-body {
  @media screen and (min-width: $account-breakpoint-small) {
    float: right;
    width: 65%;
    padding-left: $account-gutter-inner;
  }

  @media screen and (min-width: $account-breakpoint-medium) {
    width: 75%;
  }

  > :first-child {
    margin-top: 0;
  }

  .account-nav-hidden & {
    float: none;
    width: 100%;
    padding-left: 0;
    margin-left: 0;
  }
}

.account-nav {
  @media screen and (max-width: $account-breakpoint-small - 1) {
    margin-bottom: $account-gutter;
  }

  @media screen and (min-width: $account-breakpoint-small) {
    float: left;
    width: 35%;
    padding-right: $account-gutter-inner;
  }

  @media screen and (min-width: $account-breakpoint-medium) {
    width: 25%;
  }
}

/* scss-combine:account/components/forms */
.account-wrapper {
  .form-label-text {
    display: inline-block;
    width: 100%;
    margin-bottom: 5px;
  }

  .form-field-checkbox,
  .form-field-radio {
    .form-label-text { width: auto; }
  }

  .form-field {
    margin-bottom: $account-gutter-inner;
  }

  .form-input {
    width: 100%;

    &.account-form-half {
      width: 50%;
    }
  }

  .form-actions {
    clear: both;
  }
}

.account-form-column-container {
  @extend %clearfix;

  .form-field {
    @media screen and (min-width: 480px) {
      float: left;
      width: 50%;

      &:nth-child(odd) { padding-right: $account-gutter-inner; }
      &:nth-child(even) { padding-left: $account-gutter-inner; }
    }
  }
}

/* scss-combine:account/components/table */
.account-wrapper {
  table {
    width: 100%;
    margin-top: $account-gutter-inner;
    margin-bottom: $account-gutter-inner;
  }

  td,
  th {
    padding: $account-gutter-inner;
  }
}

.account-table-tight {
  th,
  td {
    padding: 10px 0;
    border-bottom: 1px solid $account-border-color;
  }
}

/* scss-combine:account/components/list */
// Layout
// Each list item has 3 sections: thumbnail, body, and badge.

.account-items {
  margin-bottom: $account-gutter;
}

.account-item {
  position: relative;
  display: table;
  width: 100%;
  border-bottom: 1px solid $account-border-color;

  &:first-of-type {
    border-top: 1px solid $account-border-color;
  }
}

.account-item-thumbnail,
.account-item-body,
.account-item-badge,
.account-item-actions {
  padding-top: $account-gutter-inner;
  padding-bottom: $account-gutter-inner;

  @media screen and (min-width: $account-breakpoint-x-small) {
    display: table-cell;
    vertical-align: top;
  }
}

// Link
// Makes the entire item clickable

.account-item-link {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 100;
}

// Thumbnail

.account-item-thumbnail {
  min-width: 100px;

  img {
    height: auto;
    max-width: 100px;
  }
}

// Body

.account-item-body {
  width: 100%;

  @media screen and (min-width: $account-breakpoint-x-small) {
    .account-item-thumbnail + & {
      padding-left: $account-gutter-inner;
    }
  }
}

.account-item-title {
  margin-top: 3px;
  font-size: $account-font-size;

  a {
    color: inherit;
  }
}

.account-item-title-large {
  font-size: $account-font-size * 1.2;
}

.account-item-description {
  margin-top: 0;
  margin-bottom: 5px;
  color: $account-text-color;
}

.account-item-details {
  @extend %clearfix;
  font-size: $account-font-size;
  color: $account-text-color;
}

.account-item-detail {
  float: left;
  margin-top: $account-gutter-inner;
  margin-right: $account-gutter;
}

//scss-lint:disable VariableForProperty
.account-item-detail-title {
  display: block;
  margin-top: 0;
  margin-bottom: 3px;
  font-size: 12px;
  font-weight: normal;
  letter-spacing: 1px;
  color: mix($account-light-color,$account-text-color,60%);
  text-transform: uppercase;
}

// Badge

.account-item-badge,
.account-item-actions {
  white-space: nowrap;
}

/* scss-combine:account/components/header */
.account-header {
  display: table;
  width: 100%;
  margin-bottom: $account-gutter-inner;
}

.account-heading,
.account-toolbar {
  display: table-cell;
  vertical-align: baseline;
}

.account-toolbar {
  text-align: right;

  * {
    display: inline;
  }
}

.account-tool {
  position: relative;
  z-index: 10;
  display: inline-block;
  padding: 0;
  background: transparent;
  margin-left: 10px;
  cursor: pointer;
  color: inherit;
  border: 0;

  &:hover { color: $account-link-color; }

  &:focus { outline: 0; }
}

/* scss-combine:account/components/navigation */
.account-nav-list {
  padding: 0;
  margin-bottom: $account-gutter-inner;
  list-style: none;
  border: 1px solid $account-border-color;
  border-radius: $account-border-radius;
}

.account-nav-item {
  color: $account-link-color;
  border-top: 1px solid $account-border-color;

  &:first-child {
    border-top: 0;
  }

  &.is-active {
    color: $account-accent-color;
    border-left: 3px solid $account-accent-color;
  }
}

.account-nav-link {
  display: block;
  padding: 15px;
  color: inherit;
}

.account-nav-badge {
  float: right;
}

/* scss-combine:account/components/pagination */
.account-wrapper .pagination {
  margin-top: $account-gutter-inner;
}

/* scss-combine:account/components/card */
%account-card-style {
  background: $account-card-background-color;

  .form-input {
    background-color: $account-light-color;
  }
}

.account-card {
  @extend %account-card-style;
  padding: $account-gutter-inner;
  margin: $account-gutter-inner 0;
  border-radius: $account-border-radius;
}

/* scss-combine:account/components/toggle */
// Set the initial toggle state to hidden
.account-toggle-hidden {
  display: none;
}

/* scss-combine:account/components/status */
// Status
// A label used to mark the status of an item

.account-status {
  padding: 6px 10px 5px;
  margin: 0;
  font-size: 12px;
  font-weight: normal;
  line-height: 1;
  letter-spacing: 1px;
  color: $account-light-color;
  text-align: center;
  text-transform: uppercase;
  background: #8e8e8e; // TODO: Colors for each status
}

/* scss-combine:account/components/shipments */
// Shipments
// A list of shipments made for an order. Shown on the Order Details page.

.account-shipments {
  margin-bottom: $account-gutter;
}

.account-shipments-table {
  th,
  td {
    padding: 10px 0;
    text-align: left;
  }

  th {
    padding: $account-gutter-inner 0 0;
    border-top: 1px solid $account-border-color;
  }

  // Override default margins
  .account-wrapper & {
    margin-top: 0;
    margin-bottom: 0;
  }
}


/* scss-combine:account/pages/address */
// Address List

.account-page-add-address {
  .account-content {
    padding-top: $account-gutter-inner;
    border-top: 1px solid $account-border-color;
  }
}

.account-address-detail {
  display: block;
}

// Add Address

.account-address-form {
  padding-top: $account-gutter-inner;

  @media screen and (min-width: $account-breakpoint-medium) {
    .form-field {
      float: left;
      width: 50%;
      padding-right: $account-gutter-inner;

      &:nth-of-type(2n) {
        padding-right: 0;
        padding-left: $account-gutter-inner;
      }

      &:nth-of-type(2n + 1){
        clear: left;
      }
    }
  }

  .form-actions {
    padding-top: $account-gutter-inner;
  }
}

/* scss-combine:account/pages/orders-receipt */
.account-page-orders-receipt .account-content {
  padding-top: $account-gutter-inner;
  border-top: 1px solid $account-border-color;
}

// Summary

.account-receipt-summaries {
  @extend %clearfix;
}

.account-receipt-summary {
  float: left;
  width: 33%;
  padding-right: $account-gutter;
}

.account-receipt-summary-title {
  margin-top: 5px;
  margin-bottom: 10px;
  font-size: $account-font-size;
}

.account-receipt-summary-address {
  line-height: 1.5;
}

.account-receipt-detail {
  margin-bottom: 5px;
}

.account-receipt-detail-title {
  color: $account-text-color-light;
}

// Comments

.account-receipt-comments {
  white-space: pre-line;
}

// Receipt Items (products)

.account-receipt-items {
  padding-top: $account-gutter-inner;
}

.account-receipt-download {
  margin: 10px 0;
}

// Totals

.account-receipt-totals {
  display: table;
  width: 50%;
  margin-left: 50%;
}

.account-receipt-total {
  display: table-row;
  margin-bottom: $account-gutter-inner;
}

.account-receipt-total-title,
.account-receipt-total-value {
  display: table-cell;
  padding-top: $account-gutter-inner;
  padding-bottom: $account-gutter-inner;
  border-top: 1px solid $account-border-color;

  .account-receipt-total:first-of-type & {
    border-top: 0;
  }
}

.account-receipt-total-title {
  font-weight: normal;
  letter-spacing: 1px;
  color: $account-text-color-light;
}

.account-receipt-total-value {
  text-align: right;
}

/* scss-combine:account/pages/recent-items */

/* scss-combine:account/pages/returns */
// Return form

.account-return-table {
  th {
    text-align: left;

    &:last-of-type {
      text-align: right;
    }
  }

  .form-field {
    margin-bottom: 0;
  }
}

.account-return-fields {
  margin-top: $account-gutter;

  .form-field-select {
    width: 50%;
  }
}

/* scss-combine:account/pages/wishlists */
.account-wishlists {
  margin-bottom: 30px;
}

/* scss-combine:account/pages/messages */
// Listing

.account-messages-table.table-clean {
  border-bottom: 1px solid $account-border-color;

  td {
    padding-right: 0;
    padding-left: 0;
    vertical-align: top;
    border-top: 1px solid $account-border-color;
  }
}

.account-messages-table-date {
  width: 22%;
  text-align: right;
}

.account-message-subject {
  margin-top: 0;
  margin-bottom: 10px;
  font-size: $account-font-size-heading;
  font-weight: 500;

  .account-message-is-reply &:before {
    padding-right: 5px;
    content: "\21c9";
  }

  .account-message-is-read & {
    color: $account-text-color-light;
  }
}

.account-message-content {
  padding-right: $account-gutter;
  font-size: $account-font-size;
  line-height: 1.5;
  color: $account-text-color;
  white-space: pre-line;

  .account-message-is-read & {
    color: lighten($account-text-color-light,10%);
  }
}

.account-message-date {
  color: $account-text-color-light;
}

// Form

.account-messages-form-subject {
  width: 50%;
}

/* scss-combine:account/pages/download */
// List

.account-download {
  padding: $account-gutter-inner 0 0;
  margin: $account-gutter-inner 0;
  border-top: 1px solid $account-border-color;
}

.account-download-title {
  margin: 0;
  font-size: 1em;
}

.account-download-link {
  color: inherit;
  text-decoration: underline;
}

.account-download-filename {
  font-size: 1.2em;
}

.account-download-filesize {
  padding-left: 5px;
  font-weight: normal;
  color: $account-text-color-light;
}

.account-download-description {
  padding-top: 10px;
  padding-bottom: 10px;
}

.account-download-expiry {
  font-size: 0.9em;
  color: $account-text-color-light;
}

.account-download-expiry-item {
  display: block;
  padding-bottom: 5px;

  &:last-of-type {
    padding-bottom: 0;
  }
}

// Gallery

.account-downloads-gallery-image {
  text-align: center;
}

.account-downloads-gallery-thumbs {
  @extend %clearfix;
  text-align: center;
}

.account-downloads-gallery-thumb {
  display: inline-block;
  width: 10%;
  height: 10%;
  padding: 0 2px;
  vertical-align: middle;
  cursor: pointer;

  img {
    width: 100%;
    height: auto;
  }
}

/* scss-combine:account/pages/invoice */
.account-invoice-date {
  margin-top: -20px;
  font-size: $account-font-size;
}

// Address

.account-invoice-addresses {
  @extend %clearfix;
  margin-top: $account-gutter;
  margin-bottom: $account-gutter;
}

.account-invoice-address {
  float: left;
  margin-right: $account-gutter;
}

.account-invoice-address-title {
  margin-top: 5px;
  margin-bottom: 10px;
  font-size: $account-font-size;
}

.account-invoice-address-body {
  line-height: 1.5;
}

// List

.account-invoice-table {
  .account-wrapper & {
    margin-bottom: 0;
  }

  th,
  td {
    padding-right: $account-gutter-inner;
    text-align: left;
    vertical-align: top;

    &:nth-of-type(0n+3) {
      width: 10%;
    }

    &:last-of-type {
      width: 160px;
      padding-right: 0;
      text-align: right;
    }
  }

  td:first-of-type {
    width: 60px + 25px;
  }
}

.account-invoice-item-thumbnail {
  width: 60px;
  height: auto;
}

.account-invoice-item-name {
  margin-bottom: 5px;
  font-weight: bold;
}

.account-invoice-total-title {
  font-weight: bold;
}

// Totals

.account-invoice-totals {
  .account-wrapper & {
    width: auto;
    margin-top: 0;
    margin-left: auto;
  }

  th,
  td {
    padding-right: $account-gutter-inner;

    &:last-of-type {
      width: 160px;
      padding-right: 0;
      text-align: right;
    }
  }
}

/* scss-combine:account/pages/settings */
.account-page-settings {
  .alert:first-of-type {
    margin-top: 0;
  }

  .account-content {
    padding-top: $account-gutter-inner;
    border-top: 1px solid $account-border-color;
  }
}

.account-settings-form {
  @extend %clearfix;
  padding-top: $account-gutter-inner;

  .form-field {
    float: left;
    width: 50%;
    padding-right: $account-gutter-inner / 2;
    vertical-align: top;

    &:nth-of-type(2n+0) {
      padding-right: 0;
      padding-left: $account-gutter-inner / 2;
    }
  }

  .form-actions {
    padding-top: $account-gutter-inner;
  }
}


/* scss-combine:account/pages/auth-login */

.account-page-login .alert {
  max-width: 860px;
  margin-top: 0;
  margin-right: auto;
  margin-bottom: $account-gutter;
  margin-left: auto;
}

.account-login-wrapper {
  max-width: 860px;
  margin-right: auto;
  margin-left: auto;

  @media screen and (min-width: $account-breakpoint-small) {
    display: table;
    width: 100%;
    table-layout: fixed;
  }
}

.account-page-login .account-sub-heading {
  margin: 0 0 20px;
}

.account-login,
.account-create {
  @media screen and (min-width: $account-breakpoint-small) {
    display: table-cell;
    vertical-align: top;
  }
}

// Login Form

.account-login {
  @media screen and (max-width: $account-breakpoint-small - 1) {
    margin-bottom: $account-gutter;
  }

  @media screen and (min-width: $account-breakpoint-small) {
    padding: $account-gutter-inner (30px + $account-gutter-inner) $account-gutter-inner 0;
  }
}

.account-login-button {
  margin-right: $account-gutter-inner;
}

// New Account

.account-create {
  padding: $account-gutter-inner;
  background: $account-card-background-color;
}

.account-create-intro {
  &:empty {
    display: none;
  }
}

.account-create-facts {
  padding-left: 20px;
  margin-bottom: 30px;
  list-style: disc;

  li:empty {
    display: none;
  }
}

/* scss-combine:account/pages/auth-forgot */
.account-page-forgot .account-body {
  width: 100%;
  max-width: 600px;
  margin-right: auto;
  margin-left: auto;
  text-align: center;
  float: none;
}

.account-forgot-form {
  display: table;
  width: 100%;
  margin-top: $account-gutter;

  .form-field,
  .form-actions {
    display: table-cell;
    text-align: left;
    vertical-align: bottom;
  }

  .form-actions {
    width: 1px;
    padding-left: 10px;
  }
}

/* scss-combine:account/pages/auth-create */
.account-page-create {
  .account-header {
    padding-bottom: $account-gutter-inner;
    margin-bottom: $account-gutter;
    border-bottom: 1px solid $account-border-color;
  }

  .account-body {
    max-width: 860px;
    margin-right: auto;
    margin-left: auto;
  }
}

.account-create-form {
  .g-recaptcha > div {
    margin: 0 auto;
  }

  @media screen and (min-width: $account-breakpoint-small) {
    .form-field {
      float: left;
      width: 50%;
      padding-right: $account-gutter-inner;

      &:nth-of-type(2n) {
        padding-right: 0;
        padding-left: $account-gutter-inner;
      }

      &:nth-of-type(2n + 1) {
        clear: left;
      }
    }
  }
}

.account-create-details,
.account-create-address {
  @extend %clearfix;
  padding-bottom: $account-gutter-inner;
  margin-bottom: $account-gutter;
  border-bottom: 1px solid $account-border-color;
}

.account-create-form-actions {
  text-align: center;
}

.account-create-captcha {
  display: inline-block;
  vertical-align: middle;

  @media screen and (max-width: $account-breakpoint-small - 1) {
    margin-bottom: $account-gutter-inner;
  }

  @media screen and (min-width: $account-breakpoint-small) {
    margin-right: $account-gutter-inner;
  }
}

/* scss-combine:account/pages/auth-created */
.account-page-created .account-body {
  float: none;
  width: 100%;
  max-width: 600px;
  margin-right: auto;
  margin-left: auto;
  text-align: center;

  p {
    margin-bottom: $account-gutter;
    line-height: 1.5;
  }

  em {
    font-family: monospace;
    font-style: normal;
    font-weight: bold;
    background: $account-card-background-color;
  }
}

/* scss-combine:account/pages/auth-new-password */
.account-page-new-password .account-content {
  width: 100%;
  max-width: 400px;
  margin-right: auto;
  margin-left: auto;
}

.new-password-requirements {
  margin-bottom: $account-gutter;
  text-align: center;
}


/* scss-combine:account/pages/gift-certificate */
// (optional) gift card nav

@if ($giftcard-nav-use-default-styles) {
  .giftcard-nav {
    padding: $account-gutter * 2;
    margin-bottom: $account-gutter * 2;
    text-align: center;
  }

  .giftcard-nav-item {
    display: inline-block;
    margin: 0 1em;
    color: $account-link-color;

    &.is-active { color: $account-text-color; }
  }
}

.giftcard-heading-container {
  margin-bottom: $account-gutter * 2;
  text-align: center;
}


// Purchase

.giftcard-form-help-message {
  display: block;
  margin-top: 6px;
}

.giftcard-form-preview {
  iframe { width: 100%; }
}

.giftcard-single-theme {
  display: none;
}


// Check balance

.giftcard-balance-container {
  max-width: 600px;
  margin: 0 auto;
}

.form-giftcard-balance {
  position: relative;

  .form-field-title {
    position: absolute;
    left: -9999px;
  }

  .form-field-control {
    display: block;

    @media screen and (min-width: 600px + ($account-gutter-inner * 2)) {
      margin-right: calc(30% + #{$account-gutter-inner});
    }
  }

  .form-actions {
    @media screen and (min-width: 600px + ($account-gutter-inner * 2)) {
      position: absolute;
      top: 0;
      right: 0;
      width: 30%;
    }
  }

  .button {
    width: 100%;
  }
}


// Redeem

.giftcard-redeem-steps {
  line-height: 1.5;

  li { margin-bottom: 0.75em; }
}


/* scss-combine:components/pages-account-auth */
// ================================================================ */
// Global Core Overrides:

// Remove any select wrapper extras
[class*='account'] .form-selected-text { display: none; }

.account-header .account-heading {
  @extend .page-title;
  display: block;
}

.account-wrapper select.form-input {
  @extend %form-select;
}

.account-pages { margin-top: $pad-vertical * 2; }

.account-sub-heading {
  @extend .footer-block-title;
}

// ================================================================ */
// Auth Pages Overrides

.auth-pages {
  @extend %clearfix;
  padding-bottom: 6.667rem;  // 100px
}

.account-forgot-form .button { margin-bottom: 0; }

// ---------------------------------------------------------------- */
// Create account page:

.auth-pages {
  max-width: rem-calc(860);
  margin: 0 auto;
}

.account-create {
  padding: $pad-vertical;

  .button { margin-bottom: 0; }
}

.account-page-create {
  .account-header { display: none; }
  .account-body { max-width: inherit; }
}

// ================================================================ */
// Account Pages Overrides

.account-nav-list {
  margin-top: 0;
  margin-bottom: 4rem; // 60px;
}

.account-body { margin-bottom: 6.6667rem; } // 100px;
.account-empty { margin-bottom: 1em; }

@include breakpoint(max-width 500px) {
  .account-item-title-large { margin-top: 1.333rem; }
  .account-item-body { display: table-row; }
}

// Buttons like add/edit on addresses page
.account-item-actions {
  vertical-align: middle;
  .button { margin-bottom: 0; }
}

// Addresses are displayed as list items for now, so remove default styling
.account-pages ul {
  list-style-type: none;
  padding: 0;
}

// ---------------------------------------------------------------- */
// Account settings form - some responsive styling:

.account-settings-form {
  @include breakpoint(max-width 500px) {
    .form-field {
      display: block;
      width: 100%;
      padding: 0;
    }
    .form-field:nth-of-type(2n+0) { padding: 0; }
  }
}
// ---------------------------------------------------------------- */
// Account product lists.

// Recently Viewed
.account-product-wrapper {
  .account-product-item {
    position: relative;
    padding: 1em;
    margin-bottom: 4rem;
    text-align: center;

    @include breakpoint(875px) { @include gallery(6); }
    @include breakpoint(1250px) { @include gallery(4); }
    @include breakpoint(1600px) { @include gallery(3); }
  }

  .account-product-item-title { @extend .item-title; }
  .account-product-item-brand { display: none; }
}

.account-product-item-details { @extend %product-item-prices; }
.account-share-wishlist-url { margin-bottom: 4rem; }

// ---------------------------------------------------------------- */
// Return request form:

.account-return-table {
  .form-field { margin-top: 0; }
  .form-field-title { display: none; }
}


/* scss-combine:components/gift-certificates */
// ================================================================ */
// Gift Certificate Pages

.page-giftcard {
  .post-title { display: none; }

  .page-sidebar {
    text-align: center;

    li {
      display: inline-block;

      &:not(:first-of-type) { margin-left: 1em; }
    }
  }

  .giftcard-heading { @extend %large-page-title; }
}

@include breakpoint(max-width 849px) {
  .form-giftcard-balance .form-actions,
  .form-giftcard-balance .form-field-control {
    position: relative;
    display: block;
    width: 100%;
  }
}

@include breakpoint(850px) {
  .form-giftcard-balance .form-actions { width: 40%; }
  .form-giftcard-balance .form-field-control { margin-right: calc(40%); }
}

// ---------------------------------------------------------------- */
// Purchase page

.page-giftcard { @extend %page-bottom-pad; }

.giftcard-nav { display: none; } // Using components/giftcards/navigation instead

.page-giftcertificates {
  .giftcard-body {
    padding-top: $pad-vertical;
    padding-bottom: $pad-vertical;
  }
}

.giftcard-form-preview iframe { width: 100%; }


/* scss-combine:base/print */
@media print {
  //scss-lint:disable ImportantRule
  // Important required in many instances to override js / inline style

  .add-to-cart-form-full,
  .share-links-container,
  .products-sidebar,
  .sidebar-nav,
  .main-footer,
  .nav-bar,
  .review-link {
    display: none !important;
  }

  .page-wrap {
    margin-left: 0 !important;
  }

  .drawer-wrapper {
    .header-components {
      display: none !important;
    }

    .store-logo {
    }
  }

  .product-information,
  .product-inner {
    width: 100% !important;
    max-width: 100% !important;
  }

  .main-content {
    padding-bottom: 0;
    margin-bottom: 0;
  }

  // Override the sticky business on product pages:
  .product-information {
    position: static !important;
  }

  .page-wrap {
    left: 0 !important;
  }
}

// ================================================================ */
